!function(e){var t={};function r(n){if(t[n])return t[n].exports;var s=t[n]={i:n,l:!1,exports:{}};return e[n].call(s.exports,s,s.exports,r),s.l=!0,s.exports}r.m=e,r.c=t,r.d=function(e,t,n){r.o(e,t)||Object.defineProperty(e,t,{enumerable:!0,get:n})},r.r=function(e){"undefined"!=typeof Symbol&&Symbol.toStringTag&&Object.defineProperty(e,Symbol.toStringTag,{value:"Module"}),Object.defineProperty(e,"__esModule",{value:!0})},r.t=function(e,t){if(1&t&&(e=r(e)),8&t)return e;if(4&t&&"object"==typeof e&&e&&e.__esModule)return e;var n=Object.create(null);if(r.r(n),Object.defineProperty(n,"default",{enumerable:!0,value:e}),2&t&&"string"!=typeof e)for(var s in e)r.d(n,s,function(t){return e[t]}.bind(null,s));return n},r.n=function(e){var t=e&&e.__esModule?function(){return e.default}:function(){return e};return r.d(t,"a",t),t},r.o=function(e,t){return Object.prototype.hasOwnProperty.call(e,t)},r.p="",r(r.s=7)}([function(e,t,r){"use strict";t.decode=t.parse=r(3),t.encode=t.stringify=r(4)},function(e,t,r){"use strict";var n=/[|\\{}()[\]^$+*?.]/g;e.exports=function(e){if("string"!=typeof e)throw new TypeError("Expected a string");return e.replace(n,"\\$&")}},function(e,t,r){"use strict";e.exports=function(e){return"object"==typeof e?function e(t,r){var n;n=Array.isArray(t)?[]:{};r.push(t),Object.keys(t).forEach((function(s){var i=t[s];"function"!=typeof i&&(i&&"object"==typeof i?-1!==r.indexOf(t[s])?n[s]="[Circular]":n[s]=e(t[s],r.slice(0)):n[s]=i)})),"string"==typeof t.name&&(n.name=t.name);"string"==typeof t.message&&(n.message=t.message);"string"==typeof t.stack&&(n.stack=t.stack);return n}(e,[]):"function"==typeof e?"[Function: "+(e.name||"anonymous")+"]":e}},function(e,t,r){"use strict";function n(e,t){return Object.prototype.hasOwnProperty.call(e,t)}e.exports=function(e,t,r,i){t=t||"&",r=r||"=";var o={};if("string"!=typeof e||0===e.length)return o;var a=/\+/g;e=e.split(t);var u=1e3;i&&"number"==typeof i.maxKeys&&(u=i.maxKeys);var l=e.length;u>0&&l>u&&(l=u);for(var c=0;c<l;++c){var d,h,m,p,f=e[c].replace(a,"%20"),g=f.indexOf(r);g>=0?(d=f.substr(0,g),h=f.substr(g+1)):(d=f,h=""),m=decodeURIComponent(d),p=decodeURIComponent(h),n(o,m)?s(o[m])?o[m].push(p):o[m]=[o[m],p]:o[m]=p}return o};var s=Array.isArray||function(e){return"[object Array]"===Object.prototype.toString.call(e)}},function(e,t,r){"use strict";var n=function(e){switch(typeof e){case"string":return e;case"boolean":return e?"true":"false";case"number":return isFinite(e)?e:"";default:return""}};e.exports=function(e,t,r,a){return t=t||"&",r=r||"=",null===e&&(e=void 0),"object"==typeof e?i(o(e),(function(o){var a=encodeURIComponent(n(o))+r;return s(e[o])?i(e[o],(function(e){return a+encodeURIComponent(n(e))})).join(t):a+encodeURIComponent(n(e[o]))})).join(t):a?encodeURIComponent(n(a))+r+encodeURIComponent(n(e)):""};var s=Array.isArray||function(e){return"[object Array]"===Object.prototype.toString.call(e)};function i(e,t){if(e.map)return e.map(t);for(var r=[],n=0;n<e.length;n++)r.push(t(e[n],n));return r}var o=Object.keys||function(e){var t=[];for(var r in e)Object.prototype.hasOwnProperty.call(e,r)&&t.push(r);return t}},function(e,t,r){const n=r(1),s=(e,t,r)=>"^"+(e=>e&&"*:"!==e?n(e.toLowerCase())+"//":"(?:https?|file|ftp)://")(e)+n(t.toLowerCase()).replace(/\\\*/g,"[^\\/]*")+(e=>e?n(e.toLowerCase()).replace(/\\\*/g,".*"):"/.*")(r)+"$";e.exports=e=>{const t=[];"<all_urls>"===e&&(e="*://*/*");const r=/^(?:([^:\/]+:)\/\/)?([^\/]*)(?:(\/[^?#]*))?/.exec(e);if(r){const e=r[1],n=r[2],i=r[3],o=[n];return/^\*\./.test(n)&&o.push(n.substr(2)),o.forEach(r=>{t.push(s(e,r,i))}),t}throw new Error("Match pattern error")}},function(e,t,r){const n=r(1),s=(e,t,r)=>"^"+(e=>n(e.toLowerCase()).replace(/\\\*/g,"[^:]*")+"//")(e)+n(t.toLowerCase()).replace(/\\\*/g,"[^\\/]*")+(e=>n(e.toLowerCase()).replace(/\\\*/g,".*"))(r)+"$";e.exports=e=>{const t=/^([^:\/]+:)\/\/([^\/]*)(\/.*)/.exec(e);if(t){const e=t[1],r=t[2],n=t[3];return[s(e,r,n).replace(/\\\?/g,".{1}")]}{let t=n(e);return["^"+(t=(t=t.replace(/\\\*/g,".*")).replace(/\\\?/g,".{1}"))+"$"]}}},function(e,t,r){"use strict";r.r(t);var n=class{constructor(e){this.mono=e,this.onChanged={addListener:e=>{chrome.storage.onChanged.addListener(e)},hasListener:e=>chrome.storage.onChanged.hasListener(e),hasListeners:()=>chrome.storage.onChanged.hasListeners(),removeListener:e=>{chrome.storage.onChanged.removeListener(e)}}}callback(e,t,r){this.mono.lastError=chrome.runtime.lastError,(r||e)&&e(t),this.mono.clearLastError()}get(e,t){chrome.storage.local.get(e,e=>this.callback(t,e,!0))}set(e,t){chrome.storage.local.set(e,()=>this.callback(t))}remove(e,t){chrome.storage.local.remove(e,()=>this.callback(t))}clear(e){chrome.storage.local.clear(()=>this.callback(e))}};var s=e=>(class extends e{initI18n(){this.i18n={getMessage:chrome.i18n.getMessage.bind(chrome.i18n)}}initMessages(){this.transport={sendMessage:(e,t)=>{t?chrome.runtime.sendMessage(e,e=>{this.lastError=chrome.runtime.lastError,t(e),this.clearLastError()}):chrome.runtime.sendMessage(e)},sendMessageToActiveTab:(e,t)=>{chrome.tabs.query({active:!0,currentWindow:!0},r=>{const n=r[0];n&&n.id>=0?t?chrome.tabs.sendMessage(n.id,e,e=>{this.lastError=chrome.runtime.lastError,t(e),this.clearLastError()}):chrome.tabs.sendMessage(n.id,e):(this.lastError=new Error("Active tab is not found"),t&&t(),this.clearLastError())})},addListener:e=>{chrome.runtime.onMessage.addListener(e)},hasListener:e=>chrome.runtime.onMessage.hasListener(e),hasListeners:()=>chrome.runtime.onMessage.hasListeners(),removeListener:e=>{chrome.runtime.onMessage.removeListener(e)}},super.initMessages()}initStorage(){this.storage=new n(this)}});var i=class{constructor(){this.listeners=[]}addListener(e){-1===this.listeners.indexOf(e)&&this.listeners.push(e)}dispatch(...e){this.listeners.forEach(t=>{t(...e)})}hasListener(e){return-1!==this.listeners.indexOf(e)}hasListeners(){return this.listeners.length>0}removeListener(e){const t=this.listeners.indexOf(e);-1!==t&&this.listeners.splice(t,1)}};var o=e=>{let t=null;return(t=()=>{}).t=t.log=t.info=t.warn=t.error=t.debug=t,t};const a=o("mono");var u=class{constructor(){this.onDestroy=new i,this._lastErrorFired=!1,this._lastError=null}get lastError(){return this._lastErrorFired=!0,this._lastError}set lastError(e){this._lastErrorFired=!e,this._lastError=e}clearLastError(){this._lastError&&!this._lastErrorFired&&a.error("Unhandled mono.lastError error:",this.lastError),this._lastError=null}unimplemented(){throw new Error("Unimplemented")}destroy(){this.onDestroy.dispatch()}};var l=e=>(class extends e{initMessages(){this.sendMessage=this.transport.sendMessage.bind(this.transport),this.sendMessageToActiveTab=this.transport.sendMessageToActiveTab.bind(this.transport),this.onMessage={addListener:this.transport.addListener.bind(this.transport),hasListener:this.transport.hasListener.bind(this.transport),hasListeners:this.transport.hasListeners.bind(this.transport),removeListener:this.transport.removeListener.bind(this.transport)}}});var c=(e,t)=>{const r=t.split("."),n=r.pop();for(;r.length;)e=e[r.shift()];return{scope:e,endPoint:n}};const d=r(2),h=o("mono:callFnListener");var m=e=>(class extends e{constructor(){super(),this.remote={mono:this},this.callFnListener=this.callFnListener.bind(this)}initMessages(){super.initMessages(),this.onMessage.addListener(this.callFnListener)}responseFn(e,t){const r=Promise.resolve().then(()=>{const{scope:t,endPoint:r}=c(this.remote,e.fn),n=e.args||[];return t[r].apply(t,n)});return this.responsePromise(r,t)}responsePromise(e,t){return e.then(e=>{t({result:e})},e=>{t({err:d(e)})}).catch((function(e){h.error("responsePromise error",e)})),!0}callFnListener(e,t,r){switch(e&&e.action){case"callFn":return this.responseFn(e,r),!0}}destroy(){this.onMessage.removeListener(this.callFnListener),super.destroy()}});var p=e=>(class extends e{});var f=e=>(class extends(p(e)){openTab(e,t){this.unimplemented()}});class g extends(f(m(l(u)))){}var v=g;var b=e=>(class extends e{constructor(){super(),this.isChrome=!0}get isChromeMobile(){return/Mobile Safari\/(\d+)|Android (\d+)/.test(navigator.userAgent)}get isOperaNext(){return/OPR\/(\d+)/.test(navigator.userAgent)}});var y=e=>(class extends(b(e)){openTab(e,t){t=void 0===t||!!t,chrome.tabs.create({url:e,active:t})}executeScript(e,t){chrome.tabs.executeScript(e.id,t)}getActiveTab(e){chrome.tabs.query({active:!0,currentWindow:!0},t=>e(t[0]))}});class w extends(y(s(v))){constructor(){super(),this.initMessages(),this.initStorage(),this.initI18n()}}var x=new w;var k=function(e,t){t&&!Array.isArray(t)&&(t=[t]);const r=[];return e.replace(/<script(?:\s*|\s[^>]+[^\/])>/g,(function(n,s){s+=n.length;const i=e.indexOf("<\/script>",s);if(-1!==i){const n=e.substr(s,i-s);t?t.every((function(e){return e.test(n)}))&&r.push(n):r.push(n)}})),r};var L=function(e,t=[]){t&&!Array.isArray(t)&&(t=[t]);const r=[],n={"{":0,"[":0},s={"}":"{","]":"["},i=/[{}\]\[":0-9.,-]/,o=/[\r\n\s\t]/;let a="";for(let t,u=0;t=e[u];u++)if('"'!==t)i.test(t)?(a+=t,"{"===t||"["===t?(n["{"]||n["["]||(a=t),n[t]++):"}"!==t&&"]"!==t||(n[s[t]]--,n["{"]||n["["]||r.push(a))):"t"===t&&"true"===e.substr(u,4)?(a+="true",u+=3):"f"===t&&"false"===e.substr(u,5)?(a+="false",u+=4):"n"===t&&"null"===e.substr(u,4)?(a+="null",u+=3):o.test(t)||(n["{"]=0,n["["]=0,a="");else{let t=u;for(;-1!==t&&(t===u||"\\"===e[t-1]);)t=e.indexOf('"',t+1);-1===t&&(t=e.length-1),a+=e.substr(u,t-u+1),u=t,n["{"]||n["["]||r.push(a)}const u=[];for(let e=0,n=r.length;e<n;e++){const n=r[e];if("{}"!==n&&"[]"!==n)try{t.every((function(e){return e.test(n)}))&&u.push(JSON.parse(n))}catch(e){}}return u};const C=o("webRequest");var R=function(){const e=/^sf-\d+_/,t={urls:["<all_urls>"],types:["xmlhttprequest"]};let r=!1;const n={},s={},i=function(e){for(let t in e)return!1;return!0},o=function(e){delete s[e.requestId],i(n)&&i(s)&&l()},a=function(t){const r=s[t.requestId],o=t.requestHeaders||[];let a=[],u=[];const l=[];if(r)u=r.changes,a=r.filtered;else if(!i(n)){let t,r;for(let s,i=0;s=o[i];i++)t=s.name,e.test(t)&&(r=n[t])&&(s.name=r.name,s.value=r.value,u.push(s),a.push(r.name.toLowerCase()),a.push(t.toLowerCase()),/cookie/i.test(s.name)&&l.push("set-cookie"),clearTimeout(r.timer),delete n[t])}if(u.length){return r||(s[t.requestId]={changes:u,filtered:a,filterResponseHeaders:l}),{requestHeaders:o.filter((function(e){return-1===a.indexOf(e.name.toLowerCase())})).concat(u)}}},u=function(e){const t=s[e.requestId],r=e.responseHeaders;if(t&&r){const e=t.filterResponseHeaders;return{responseHeaders:r.filter((function(t){return-1===e.indexOf(t.name.toLowerCase())}))}}},l=function(){r&&(r=!1,chrome.webRequest.onBeforeSendHeaders.removeListener(a,t,["blocking","requestHeaders"]),chrome.webRequest.onHeadersReceived.removeListener(u,t,["blocking","responseHeaders"]),chrome.webRequest.onResponseStarted.removeListener(o,t),chrome.webRequest.onErrorOccurred.removeListener(o,t),C.debug("webRequest","rm listener"))};let c=10,d=!1;let h=null;const m=function(e){return(null===h||e)&&(h=!!(chrome.webRequest&&chrome.webRequest.onBeforeSendHeaders&&chrome.webRequest.onResponseStarted&&chrome.webRequest.onErrorOccurred)),h},p=/^user-agent$|^origin$|^cookie$/i;return{wrapHeaderKey:function(e,s){if(m()){let i,l=100;for(;l-- >0&&(i="sf-"+parseInt(1e5*Math.random())+"_"+e,n[i]););return n[i]={name:e,value:s,timer:setTimeout((function(){delete n[i]}),3e3)},r||(r=!0,chrome.webRequest.onBeforeSendHeaders.addListener(a,t,["blocking","requestHeaders"]),chrome.webRequest.onHeadersReceived.addListener(u,t,["blocking","responseHeaders"]),chrome.webRequest.onResponseStarted.addListener(o,t),chrome.webRequest.onErrorOccurred.addListener(o,t),C.debug("webRequest","add listener")),i}return e},isSpecialHeader:function(e){return p.test(e)},requestPermission:function(e){m()||d?e(h):chrome.permissions&&chrome.permissions.request?chrome.permissions.request({permissions:["webRequest","webRequestBlocking"]},(function(t){(t||c--<=0)&&(d=!0),t&&m(!0),e(h)})):(d=!0,e(h))}}}();const I=r(0),O=function(e){e=e.split(/\r?\n/);const t={};return e.forEach((function(e){const r=e.indexOf(":");if(-1===r)return;const n=e.substr(0,r).trim().toLowerCase(),s=e.substr(r+1).trim();t[n]=s})),t};var E=function(e,t){const r={};let n=function(e,r){n=null,u.timeoutTimer&&clearTimeout(u.timeoutTimer);let i=null;e&&(i=String(e.message||e)||"ERROR"),t&&t(i,s(r),r)};const s=function(e){const t={};t.statusCode=c.status,t.statusText=c.statusText;let r=null;const n=c.getAllResponseHeaders();return"string"==typeof n&&(r=O(n)),t.headers=r||{},t.body=e,t.responseURL=c.responseURL,t};"object"!=typeof e&&(e={url:e});let i=e.url,o=e.method||e.type||"GET";o=o.toUpperCase();let a=e.data;"string"!=typeof a&&(a=I.stringify(a)),a&&"GET"===o&&(i+=(/\?/.test(i)?"&":"?")+a,a=void 0),!1===e.cache&&-1!==["GET","HEAD"].indexOf(o)&&(i+=(/\?/.test(i)?"&":"?")+"_="+Date.now()),e.headers=e.headers||{},a&&(e.headers["Content-Type"]=e.contentType||e.headers["Content-Type"]||"application/x-www-form-urlencoded; charset=UTF-8");const u={};u.url=i,u.method=o,a&&(u.data=a),e.json&&(u.json=!0),e.xml&&(u.xml=!0),e.timeout&&(u.timeout=e.timeout),e.mimeType&&(u.mimeType=e.mimeType),e.withCredentials&&(u.withCredentials=!0),Object.keys(e.headers).length&&(u.headers=e.headers),u.timeout>0&&(u.timeoutTimer=setTimeout((function(){n&&n(new Error("ETIMEDOUT")),c.abort()}),u.timeout));const l={0:200,1223:204},c=(e.localXHR,new XMLHttpRequest);c.open(u.method,u.url,!0),u.mimeType&&c.overrideMimeType(u.mimeType),u.withCredentials&&(c.withCredentials=!0);const d=[];for(let e in u.headers)R&&R.isSpecialHeader(e)&&d.push({key:e,value:u.headers[e]}),c.setRequestHeader(e,u.headers[e]);c.onload=function(){const e=l[c.status]||c.status;try{if(e>=200&&e<300||304===e){let e=c.responseText;if(u.json)e=JSON.parse(e);else if(u.xml)e=(new DOMParser).parseFromString(e,"text/xml");else if("string"!=typeof e)throw console.error("Response is not string!",e),new Error("Response is not string!");return n&&n(null,e)}throw new Error(c.status+" "+c.statusText)}catch(e){return n&&n(e)}};const h=c.onerror=function(){n&&n(new Error(c.status+" "+c.statusText))};let m=null;void 0!==c.onabort?c.onabort=h:m=function(){4===c.readyState&&n&&setTimeout((function(){return h()}))},m&&(c.onreadystatechange=m);const p=function(){try{c.send(u.data||null)}catch(e){setTimeout((function(){n&&n(e)}))}};if(R&&d.length){const e=function(){for(let e,t=0;e=d[t];t++)c.setRequestHeader(R.wrapHeaderKey(e.key,e.value),e.value)};R.requestPermission((function(t){t&&e(),n&&p()}))}else p();return r.abort=function(){n=null,c.abort()},r};const T=o("VimeoComEmbed");var A=class{constructor(e){this.engine=e}getVimeoLinks(e,t){return this._getVimeoLinks(e.extVideoId,e.url,(function(r,n,s){var i={action:e.action,extVideoId:e.extVideoId,links:r,title:n,thumb:s};t(i)})),!0}_getVimeoLinks(e,t,r){this.getVimeoNoEmbedLinks(e,t,(t,n,s)=>{if(t)return r(t,n,s);this.getVimeoEmbedLinks(e,r)})}getVimeoEmbedLinks(e,t){var r=function(){return t(null,"","")};if(!e)return r();E({url:"https://player.vimeo.com/video/"+e},(e,n,s)=>{if(e||!s)return r();var i=L(s,[/"files":/]),o=null;return i.some((function(e){if(e.video&&e.request&&e.request.files)return o=e,!0})),(s=this.getLinksFromConfig(o))?t(s.links,s.title,s.thumb):r()})}getVimeoConfig(e,t){var r=function(){return t(null,"","")};E({url:e},(e,n,s)=>e||!s?r():(s=this.getVimeoDataFromConfig(s))?t(s.links,s.title,s.thumb):r())}getVimeoLinksFromConfigAction(e,t){return new Promise((t,r)=>{const n=this.getLinksFromConfig(e.config);n?t(n):r(new Error("Get links from config error"))}).then(t,e=>{T.error("getVimeoLinksFromConfigAction error",e),t(null)}),!0}getClipPageConfig(e,t){var r=null;return k(e,/['"]config_url['"]\s*:\s*/).some((function(e){return L(e,/['"]config_url['"]\s*:\s*/).some((function(e){if(e.player&&(r=e.player.config_url))return!0}))})),r?this.getVimeoConfig(r,t):t(null,"","")}getVimeoNoEmbedLinks(e,t,r){if(e&&t){var n=/vimeo\.com\/[^\/]+\/review\/\d+/i.test(t),s=/vimeo\.com\/\d+\/\w+/i.test(t);n||s||(t=null)}E({url:t||"https://vimeo.com/"+e},(e,t,n)=>{if(e||!n)return r(null,"","");var s=n.match(/data-config-url=["']([^\s"'<>]+)/i);return(s=s&&s[1].replace(/&amp;/gi,"&"))?this.getVimeoConfig(s,r):this.getClipPageConfig(n,r)})}getVimeoLinksFromConfig(e,t){var r=this.getLinksFromConfig(e.config);return t(r||null)}getLinksFromConfig(e){if(!(e&&e.video&&e.request&&e.request.files))return null;var t=e.video,r=e.request.files,n={};n.title=t.title||"";var s=null;for(var i in t.thumbs)(null===s||s<i)&&(s=i,n.thumb=t.thumbs[i]);for(var o in n.links=[],r)Array.isArray(r[o])&&r[o].forEach((function(e){if(e&&e.url&&e.mime){var t=e.mime.split("/")[1];t||(t=(t=e.url.match(/\.(\w{2,4})(?:\?|#|$)/i))&&t[1]||"mp4");var r=t.toUpperCase(),s=e.quality;/^\d+p$/.test(s)&&(s=s.replace(/p$/,""));var i=r+" "+s;n.links.push({url:e.url,name:i,height:s,type:r,format:r,ext:t})}}));return n.links.length||(n=null),n}getVimeoDataFromConfig(e){e=e.replace(/(\{|,)\s*(\w+)\s*:/gi,'$1"$2":').replace(/(:\s+)\'/g,'$1"').replace(/\'([,\]\}])/g,'"$1');try{e=JSON.parse(e)}catch(e){return null}return this.getLinksFromConfig(e)}};var q=e=>new Promise((t,r)=>{E(e,(e,n)=>{e?r(e):t(n)})});const S=e=>{if("string"!=typeof e){const t=new Error("Value is not String");throw t.value=e,t}return e},M=e=>{if(!Number.isFinite(e)){const t=new Error("Value is not Finite Number");throw t.value=e,t}return e};function _(e,t){const r=[];let n;for(;null!==(n=t.exec(e));)n.index===t.lastIndex&&t.lastIndex++,r.push(n);return r}const F=o("DailymotionComEmbed");var H=class{constructor(e){this.engine=e}getDailymotionLinks(e,t){return this.getEmbedVideoInfo(e.extVideoId,e.metadata,r=>{r||(r={}),this.addUmmyLinks(r.links,e.extVideoId);var n={action:e.action,extVideoId:e.extVideoId,links:r.links,title:r.title,duration:r.duration};t(n)}),!0}addUmmyLinks(e,t){}getMetadata(e){return q({url:`https://www.dailymotion.com/player/metadata/video/${encodeURIComponent(e)}`,json:!0}).then(e=>e.body)}getInfoFromMetadata(e){const t={title:S(e.title),duration:M(e.duration),links:[]};if(e.qualities&&e.qualities.auto&&e.qualities.auto.length){let r=e.qualities.auto.pop();if("application/x-mpegURL"===r.type)return q({url:r.url}).then(e=>{const r=_(e.body,/CODECS="(?<codecs>.*?)",RESOLUTION=(?<resolution>.*?),NAME="(?<quality>.*?)",PROGRESSIVE-URI="(?<url>.*?)"/gm);for(let e of r){let{quality:r,codecs:n,resolution:s,url:i}=e.groups,o=s,a=/\.(.{0,7})#cell/.exec(i);a[1]&&(o=a[1]),t.links.find(e=>e.height===parseInt(r))||t.links.push({name:`${n}-${s}`,ext:o,height:parseInt(r),url:S(i)})}return t.links.sort((e,t)=>e.height>t.height?-1:1),t})}return Promise.resolve(t)}getEmbedVideoInfo(e,t,r){return Promise.resolve().then(()=>t||this.getMetadata(e)).then(e=>this.getInfoFromMetadata(e)).then(e=>{r(e)},t=>{F.error("getEmbedVideoInfo error",e,t),r()})}};class V{constructor(e){this.urls=void 0;const t=_(e,/#EXTINF:.*?,\n(?<url>.*?)$/gms);this.urls=[];for(let e of t)e.groups&&e.groups.url?this.urls.push(e.groups.url):e[1]&&this.urls.push(e[1])}static async createFromURL(e){const t=await q(e);return new V(t.body)}changeURLs(e){this.urls=this.urls.map(e)}async _downloadTask(e){const t=await fetch(e);return await t.blob()}download(){const e=this.urls.map(e=>this._downloadTask(e));return Promise.all(e).then(e=>{const t=new Blob(e,{type:e[0].type});return URL.createObjectURL(t)})}async fetchMimeType(){return(await fetch(this.urls[0],{method:"head"})).headers.get("Content-Type")}destroy(){}_emit(e,t){const r=new CustomEvent("hlsDownloader."+e,{detail:t});document.dispatchEvent(r)}}var P=function(e){const t=function(e){const t=e[0];let r=0;for(;;){if(-1===(r=e.indexOf(t,r+1))){r=e.length;break}if("\\"!==e[r-1])break}let n="";try{n='"'===t?JSON.parse('"'+e.substr(1,r-1)+'"'):JSON.parse('"'+e.substr(1,r-1).replace(/\\'/g,"'").replace(/"/g,'\\"')+'"')}catch(e){}return{data:n,i:r}},r={"[":function(e){const t=[];let n,s,i,o,a,u="";for(o=1;i=e[o];o++)if(s=r[i])n=s(e.substr(o)),u=JSON.stringify(n.data),o+=n.i;else{if("]"===i)break;","===i?(u&&t.push(u),u=""):u+=i}u&&t.push(u);try{a=JSON.parse("["+t.join(",")+"]")}catch(e){}return{data:a||[],i:o}},"{":function(e){const t=[];let n,s,i,o,a,u=["",""],l=0;for(o=1;i=e[o];o++)if(s=r[i])n=s(e.substr(o)),u[l]=0===l?n.data:JSON.stringify(n.data),o+=n.i;else{if("}"===i)break;":"===i?l=1:","===i?(t.push(JSON.stringify(u[0])+":"+u[1]),u=["",""],l=0):u[l]=(u[l]+i).trim()}u[1]&&t.push(JSON.stringify(u[0])+":"+u[1]);try{a=JSON.parse("{"+t.join(",")+"}")}catch(e){}return{data:a||{},i:o}},'"':t,"'":t};return{some:function(t){return function(e,t){let n;for(let s,i=0;s=e[i];i++)if(("["===s||"{"===s)&&(i+=(n=r[s](e.substr(i))).i,t(n.data)))return!0}(e,t)}}};class D{constructor(e){this.engine=e}async soundcloudFetchPageInfo({songEndpoint:e,retry:t=3}){try{const t="https://w.soundcloud.com/player/?url="+e,r=await q(t);let n;return P(r.body).some(e=>{Array.isArray(e)&&e.length&&Array.isArray(e[0].data)&&(n=e[0].data[0])}),n}catch(r){if(t)return t--,this.soundcloudFetchPageInfo({songEndpoint:e,retry:t});throw r}}async soundcloudFetchSongsOfPlaylist({clientID:e,playlist:t}){const r=t.tracks.map(e=>e.id),n=[],s=[];if(r.length>=30)for(let e=0;e<r.length;e+=30)n.push(r.slice(e,e+30));else n.push(r);for(let t of n){const r=`https://api-v2.soundcloud.com/tracks?ids=${t.join(",")}&client_id=${e}`,n=await q({url:r,json:!0});s.push(...n.body)}return s}async soundcloudSearchBestDownloadURL({song:e,clientID:t}){if(!e.media||!e.media.transcodings||!e.media.transcodings.length)return;const{transcodings:r}=e.media,n=await this._searchProgressiveTranscoding(t,r);return n||this._searchHlsTranscoding(t,r)}async _searchProgressiveTranscoding(e,t){const r=t.find(e=>"progressive"===e.format.protocol);if(r)return(await q({url:r.url+"?client_id="+e,json:!0})).body.url}async _searchHlsTranscoding(e,t){const r=t.find(e=>"hls"===e.format.protocol),n=await q({url:r.url+"?client_id="+e,json:!0}),s=(await q(n.body.url)).body;return new V(s).download()}}var U=function(e,t){let r=null;r=!(t=t||{}).params&&/\?/.test(e)?e.match(/[^?]*\?(.*)/)[1]:e;const n=t.sep||"&",s=r.split(n),i={};for(let e=0,r=s.length;e<r;e++){const r=s[e].split("=");let n=r[0];const o=r[1]||"";if(t.noDecode)i[n]=o;else{try{n=decodeURIComponent(n)}catch(e){n=unescape(n)}try{i[n]=decodeURIComponent(o)}catch(e){i[n]=unescape(o)}}}return i};const j=/\\(\\u[0-9a-f]{4})/g;var N=function(e){try{return JSON.parse(JSON.stringify(e).replace(j,"$1"))}catch(t){return e}};var $=function(e,t){t&&!Array.isArray(t)&&(t=[t]);const r=[];let n=-1,s=-1;do{if(-1!==(s=e.indexOf('"',s+1))){if("\\"===e[s-1])continue;-1!==n?(r.push(e.substr(n,s+1-n)),n=-1):n=s}else n=s}while(-1!==s);const i=[];for(let e,n=0;e=r[n];n++)if('""'!==e)try{t?t.every((function(t){return t.test(e)}))&&i.push(JSON.parse(e)):i.push(JSON.parse(e))}catch(e){}return i};var B=function(e,t,r){r=r||[],Array.isArray(r)||(r=[r]);const n=[],s=new RegExp("(<"+e+"[^>]*>)","i"),i=new RegExp("(</"+e+">)","i");let o=null,a="",u="",l="",c=-1;for(;(o=s.exec(t))&&(a=o[1],-1!==(c=t.indexOf(a)));)t=t.substr(c+a.length),(o=i.exec(t))&&(u=o[1],l=t.substr(0,t.indexOf(u)),n.push(a+l+u));return n.filter((function(e){return r.every((function(t){return t.test(e)}))}))};var J=function(e,t){const r=(new DOMParser).parseFromString("<html><body>"+e+"</body></html>","text/html");if(t){let e=r.head.querySelector("base");e||((e=r.createElement("base")).href=t,r.head.appendChild(e))}return r};var W={maxLength:80,rtrim:/^[\s\uFEFF\xA0]+|[\s\uFEFF\xA0]+$/g,illegalRe:/[\/?<>\\:*|"~\u202B]/g,controlRe:/[\x00-\x1f\x80-\x9f]/g,zeroWidthJoinerRe:/\u200D/g,reservedRe:/^\.+/,trim:function(e){return e.replace(this.rtrim,"")},partsRe:/^(.+)\.([a-z0-9]{1,4})$/i,getParts:function(e){return e.match(this.partsRe)},specialChars:"nbsp,iexcl,cent,pound,curren,yen,brvbar,sect,uml,copy,ordf,laquo,not,shy,reg,macr,deg,plusmn,sup2,sup3,acute,micro,para,middot,cedil,sup1,ordm,raquo,frac14,frac12,frac34,iquest,Agrave,Aacute,Acirc,Atilde,Auml,Aring,AElig,Ccedil,Egrave,Eacute,Ecirc,Euml,Igrave,Iacute,Icirc,Iuml,ETH,Ntilde,Ograve,Oacute,Ocirc,Otilde,Ouml,times,Oslash,Ugrave,Uacute,Ucirc,Uuml,Yacute,THORN,szlig,agrave,aacute,acirc,atilde,auml,aring,aelig,ccedil,egrave,eacute,ecirc,euml,igrave,iacute,icirc,iuml,eth,ntilde,ograve,oacute,ocirc,otilde,ouml,divide,oslash,ugrave,uacute,ucirc,uuml,yacute,thorn,yuml".split(","),specialCharsList:[["amp","quot","lt","gt"],[38,34,60,62]],specialCharsRe:/&([^;]{2,6});/g,decodeSpecialChars:function(e){const t=this;return e.replace(this.specialCharsRe,(function(e,r){let n=null;if("#"===r[0])return n=parseInt(r.substr(1)),isNaN(n)?"":String.fromCharCode(n);let s=t.specialCharsList[0].indexOf(r);return-1!==s?(n=t.specialCharsList[1][s],String.fromCharCode(n)):-1!==(s=t.specialChars.indexOf(r))?(n=s+160,String.fromCharCode(n)):""}))},decodeHexChars:function(e){return e.replace(/(\\x[a-zA-Z0-9]{2})/g,(function(e,t){let r=t;try{r=String.fromCharCode(parseInt("0x"+r.substr(2),16))}catch(e){}return r}))},rnRe:/\r?\n/g,re1:/[*?"]/g,re2:/</g,re3:/>/g,spaceRe:/[\s\t\uFEFF\xA0]+/g,dblRe:/(\.|!|\?|_|,|-|:|\+){2,}/g,re4:/[.,:;\/\-_+=']$/g,modify:function(e){if(!e)return"";e=N(e);try{e=decodeURIComponent(e)}catch(t){e=unescape(e)}if(e=(e=this.decodeSpecialChars(e)).replace(this.rnRe," "),(e=(e=this.trim(e)).replace(this.zeroWidthJoinerRe,"").replace(this.re1,"").replace(this.re2,"(").replace(this.re2,"(").replace(this.re3,")").replace(this.spaceRe," ").replace(this.dblRe,"$1").replace(this.illegalRe,"_").replace(this.controlRe,"").replace(this.reservedRe,"").replace(this.re4,"")).length>this.maxLength){const t=this.getParts(e);t&&3==t.length&&(t[1]=t[1].substr(0,this.maxLength),e=t[1]+"."+t[2])}return this.trim(e)}};var G=class{constructor(e){this.engine=e}getVKLinks(e,t){var r=this;return this._getVKLinks(e.extVideoId,(n,s,i,o,a,u,l)=>{if(l)return l.origRequest=e,void r.engine.onMessage(l,{},t);var c={action:e.action,extVideoId:n||e.extVideoId,links:s,title:i,duration:o,thumb:a,data:u,checkLinks:null};e.checkLinks&&s&&s.length>0?this.checkVkLinks(s,(function(e,r){c.checkLinks=r,t(c)})):t(c)}),!0}preparePladformLinks(e){var t,r={links:t=[]};return e.forEach((function(e){r.title=e.title,r.duration=e.duration,r.thumb=e.cover;var n=e.url.match(/[\w]+\.(mp4|flv)(?:\?|$)/i);n=n?n[1]:"flv",t.push({url:e.url,name:n.toUpperCase(),subname:e.quality.toUpperCase(),type:n.toLowerCase()})})),r}_getVKLinks(e,t){var r=this,n=[],s=e,i=null,o="",a="",u=e,l=null,c=null,d=null,h=/^video(-?\d+)_(\d+)/i;if(h.test(u))l=u.match(h),c=parseInt(l[1]),d=parseInt(l[2]);else{l=u.match(/(?:^|&)oid=(-?\d+)/i),c=l&&parseInt(l[1]),l=u.match(/(?:^|&)id=(-?\d+)/i),d=l&&parseInt(l[1]),u="",c&&d&&(u="video"+c+"_"+d)}return u?(s=u,E({url:"https://vk.com/"+u},(e,l,h)=>{if(e||!h)return t(u,n,s,a,o,null,i);var m=null;if(L(h,[/"vid":/,/"oid":/,/"md_title":/]).some((function(e){var t=e&&e[4]&&e[4].player&&e[4].player.params&&e[4].player.params[0];if(t&&t.vid===d&&t.oid===c)return m=t,!0})),m){var p=this.getVkLinksFromJson(m);if(n=p.links,s=p.title,o=p.thumb,a=p.duration,n.length)return t(u,n,s,a,o,m,i)}var f=null;L(h,[/"player"/]).some((function(e){var t=e&&e[4]&&e[4].player&&e[4].player.params&&e[4].player.params[0];if("string"==typeof t)return f=t,!0}));var g,v=!1;f&&((g=/dailymotion.com\/(?:swf\/)?video\/([\w\d]+)/i.exec(f))&&(i={action:"getDailymotionLinks",extVideoId:g[1]},v=!0));if(v)return t(u,n,s,a,o,null,i);var b=!1;return $(h,/video_box_wrap/).some(e=>{var l=null,c=/<iframe([^>]+)>/i.exec(e);if(c){var d=c[1];if(l=/youtube.com\\?\/embed\\?\/([\w\-]+)/i.exec(d))return i={action:"getYoutubeLinks",extVideoId:l[1]},!0;if(l=/vimeo.com\\?\/video\\?\/(\d+)/i.exec(d))return i={action:"getVimeoLinks",extVideoId:l[1]},!0;if(l=/src="([^"]*pladform\.ru[^"]+)"/i.exec(d)){b=!0;var m=U(l[1]);return r.engine.modules.odnoklassniki.getPladformVideo({extVideoId:{playerId:m.pl,videoId:m.videoid}},e=>{e&&"getRutubeLinks"===e.action&&(e.links=null);var r=e&&e.links;if(!Array.isArray(r))return t(u,n,s,a,o,null,i);var l=this.preparePladformLinks(r);return t(u,l.links,l.title,l.duration,l.thumb,null,i)}),!0}}return!!B("video",e).some((function(e){var t=J(e,"https://vk.com/"),r=!1;return[].slice.call(t.querySelectorAll("source")).forEach((function(e){var t=!1,i=e.src;t||/^(.*cdninstagram\.com.+mp4)/i.exec(i)&&(t=!0,r=!0,n.push({url:i,subname:"SD",name:"MP4",type:"mp4"}));if(!t){var o=/\.(\d+)\.mp4(?:$|\?)/.exec(i);if(o){t=!0,r=!0;var a=i,u=o[1],l=a.indexOf("?");-1!==l&&(a=a.substr(0,l)),$(h,/mv_title/).some((function(e){var t=/id="mv_title"[^>]*>([^<]+)/.exec(e);if(t)return s=W.decodeSpecialChars(N(t[1])),!0})),n.push({url:a,subname:u,name:"MP4",type:"mp4"})}}})),r}))||(/var\sopts\s*=\s*/.test(e)&&(l=/url:\s*'(?:[^']+)dailymotion.com\/(?:swf\/)?video\/([\w\d]+)/.exec(e))?(i={action:"getDailymotionLinks",extVideoId:l[1]},!0):void 0)}),!b&&t(u,n,s,a,o,null,i)})):t(u,n,s)}checkVkLinks(e,t){var r="";e&&e.length>0&&(r="mp4"==e[0].type?e[0].url:e.length>1?e[1].url:e[0].url),r?E({url:r,type:"HEAD"},(function(e,n){t(r,!e)})):t()}getVkLinksFromJsonMsg(e,t){return t(this.getVkLinksFromJson(e.json))}getVkLinksFromJson(e){var t=[],r=e.vid,n=e.md_title||e.vid,s="";e.thumb?s=e.thumb:e.jpg&&(s=e.jpg);var i=/\.flv(\?|$)]/,o=/url([0-9]+)/;Object.keys(e).forEach((function(r){var n="",s="mp4",a=null;"extra_data"===r&&"99"===e.extra?(n="",e.live_mp4?n=e.live_mp4:e.postlive_mp4&&(n=e.postlive_mp4),n&&(a=e.hd?"HD":"SD",t.push({url:n,subname:a,name:s.toUpperCase(),type:s}))):"extra_data"===r&&"52"===e.extra?(a=e.hd?"HD":"SD",n=e.extra_data,i.test(n)&&(s="flv"),t.push({url:n,subname:a,name:s.toUpperCase(),type:s})):null!==(a=(a=r.match(o))&&a[1])&&(n=e[r],i.test(n)&&(s="flv"),t.push({url:n,subname:a,name:s.toUpperCase(),type:s}))}));var a=e.duration;return{action:"getVKLinks",extVideoId:r,links:t,title:n,duration:a,thumb:s,data:e,checkLinks:null}}getVkLinksFromData(e,t){var r=e.data,n=null;return L(r,[/"vid":/,/"oid":/,/"md_title":/]).some((function(e){if(e=e.player&&e.player.params&&e.player.params[0])return n=e,!0})),n?t(this.getVkLinksFromJson(n)):t()}};var z=()=>"Mozilla/5.0 (Windows NT 10.0; WOW64) AppleWebKit/537.36 (KHTML, like Gecko) Chrome/56.0.2924.87 Safari/537.36";const K=r(0);var Z=class{constructor(e){this.engine=e}async getOkVideoUrlFromMobile({videoUrl:e,videoId:t}){e=e.replace("/ok.ru","/m.ok.ru");const r=(await q(e)).body.match(/data-video=".*?"/g);if(!Array.isArray(r))return;const n=r.map(e=>{try{const t=e.replace(/data-video="(.*?)"/,"$1").replace(/&quot;/g,'"');return JSON.parse(t)}catch(e){return!1}}).filter(Boolean).find(e=>parseInt(e.movieId)===parseInt(t));return n&&n.videoSrc}getOdnoklassnikiLinks(e,t){return this._getOdnoklassnikiLinks(e.extVideoId,(function(r){var n={action:e.action,extVideoId:e.extVideoId,links:r,title:e.title};t(n)})),!0}getOdnoklassnikiAudioLinks(e,t){return this._getOdnoklassnikiAudioLinks(e.url,e.trackId,e.jsessionId,(function(r){var n={action:e.action,trackId:e.trackId,jsessionId:e.jsessionId,data:r};t(n)})),!0}_getOdnoklassnikiLinks(e,t){e?E({url:"http://in.video.mail.ru/cgi-bin/video/oklite?eid="+e},(function(r,n,s){if(r||!s)return t(null);var i="http://www.okcontent.video.mail.ru/media/",o=s.match(/\$vcontentHost=([^\s"'<>]+)/i);o&&o.length>1&&(i="http://"+o[1]+"/media/"),i+=e;var a=[],u="",l=s.match(/\$height=([0-9]+)/);l&&l.length>1&&(u=l[1]),a.push({url:i+"-v.mp4",name:"SD",ext:"FLV",subname:u}),s.search(/\$HDexist=1/i)>-1&&(u="",(l=s.match(/\$HDheight=([0-9]+)/))&&l.length>1&&(u=l[1]),a.push({url:i+"-hv.mp4",name:"HD",ext:"MP4",subname:u})),a&&t(a)})):t(null)}_getOdnoklassnikiAudioLinks(e,t,r,n){if(!t||!r)return n(null);E({url:"http://wmf1.ok.ru/play;jsessionid="+r+"?tid="+t,json:!0},(function(e,t,r){if(e||!r)return n(null);n(r)}))}getOkAudioListLinks(e,t){var r=[],n=e.trackIdArr,s=e.jsessionId;if(!Array.isArray(n)||"string"!=typeof s||!n.length)return t(r);for(var i,o=n.length,a=0,u=function(e){e&&r.push(e),function(){if(++a===o)t(r)}()},l=0;i=n[l];l++)this._getOdnoklassnikiAudioLinks(void 0,i,s,u);return!0}getClipyouLinks(e,t,r,n,s){E({url:"http://media.clipyou.ru/api/player/secure_link?record_id="+e+"&type=mp4&resource_hash="+t,json:!0},(function(e,t,i){if(e||!i||!Array.isArray(i.data)||!i.data.length)return s();var o=[];i.data.forEach((function(e){o.push({quality:r,url:e,title:n})})),s(o)}))}getClipyouHash(e,t){E({url:"http://media.clipyou.ru/api/player_data.json?id="+e},(function(e,r,n){if(e||!n)return t();if(!(n=n.match('resource_hash".?:.?"([^"]*)"'))||n.length<2)return t();var s=n[1];t(s)}))}getPladformVideo(e,t){var r={action:e.action,extVideoId:e.extVideoId,links:[],title:e.title},n=function(){t(r)},s=e.extVideoId.playerId,i=e.extVideoId.videoId;return E({url:"http://out.pladform.ru/getVideo?pl="+s+"&videoid="+i,xml:!0},(e,t,s)=>{if(e||!s)return n();var i=s.querySelectorAll("src");if(0===i.length)return n();var o=s.querySelector("cover")||void 0;o&&(o=o.textContent)&&"//"===o.substr(0,2)&&(o="http:"+o);var a=s.querySelector("time")||void 0;a=a&&a.textContent;var u=s.querySelector("title");(u=u&&u.textContent)&&(r.title=u);var l=i[0],c=l.getAttribute("type"),d=l.textContent||"",h=l.getAttribute("quality");if(l){if("clipyou"===c)return this.getClipyouHash(d,e=>{if(!e)return n();this.getClipyouLinks(d,e,h,u,(function(e){r.links=e,n()}))});if("rutube"===c){var m=s.querySelector("external_embed");return(m=m&&m.textContent)&&(r.action="getRutubeLinks",r.links=[m]),n()}}for(var p,f=["ld","sd"],g=["360","720"],v=0;p=i[v];v++){d=p.textContent||"",h=p.getAttribute("quality"),/^\d+p$/.test(h)&&(h=h.match(/^(\d+)p$/)[1]);var b=f.indexOf(h);-1!==b&&(h=g[b]),"video"===(c=p.getAttribute("type"))&&r.links.push({url:d,quality:h,title:u,cover:o,duration:a})}return n()}),!0}getOkMetadata(e,t){var r=e.url;return r?(E({method:"POST",url:r,json:!0},(function(e,r,n){if(e||!n)return t();t(n)})),!0):t()}getOkViaMobile(e,t){var r=e.metadata,n={"st.cmd":"movieLayer","st.mvId":e.mvId},s="http://m.ok.ru/dk?"+K.stringify(n),i={action:e.action,links:null,title:r.movie.title};return E({url:s},(function(n,s,o){if(n||!o)return t();var a=new RegExp('href="([^"]+st\\.cmd=moviePlaybackRedirect[^"]+st\\.mvid='+e.mvId+'[^"]+)"'),u=o.match(a);if(!(u=u&&u[1]))return t();if(u=W.decodeSpecialChars(u),i.links=[{url:u}],!/st.mq=\d+/.test(u))return t(i);var l=r.videos;if(!l||!l.length)return t(i);l.forEach((function(e){if(e.url){var t=U(e.url);t.type&&(e.url=u.replace(/(st.mq=)\d+/,"$1"+t.type))}})),i.links=l,t(i)})),!0}okDirectOrMobile(e,t){var r=e.metadata,n=null;r.videos&&r.videos.some((function(e){if(e.url)return n=e.url,!0}));var s=()=>{e.action="getOkViaMobile",this.getOkViaMobile(e,t)};return n?(E({url:n,type:"HEAD"},(function(n){return n?s():(e.action="getOkViaMobileNoWrap",e.links=r.videos,t(e))})),!0):(s(),!0)}okRequestVideoPage({videoId:e}){return q({url:`https://ok.ru/video/${e}`,headers:{"user-agent":z()}}).then(e=>e.body)}};var Q=class{constructor(e){this.engine=e}getFacebookLinks(e,t){return this._getFacebookLinks(e.extVideoId,(function(r,n,s,i){var o={action:e.action,extVideoId:e.extVideoId,links:r||null,title:n||"",thumb:s||"",duration:i||""};t(o)})),!0}getFacebookLinksFromData(e,t){var r=e.data,n=e.extVideoId;return this.getLinksFromData2(r,n,!0,(function(r,n,s,i){var o={action:"getFacebookLinksFromData",extVideoId:e.extVideoId,links:r||null,title:n||"",thumb:s||"",duration:i||""};t(o)}))}_getFacebookLinks(e,t){E({type:"GET",url:"https://www.facebook.com/video.php?v="+e,headers:{Cookie:""}},(r,n,s)=>{if(r||!s)return t();this.getLinksFromData(s,e,t)})}getLinksFromData(e,t,r){var n=e.match(/\["params","([^"]*)"\]/im);if(!n)return this.getLinksFromData2(e,t,!1,r);var s=null;try{if((s=JSON.parse(decodeURIComponent(JSON.parse('"'+n[1]+'"'))).video_data).progressive&&(s=s.progressive),!s)return r()}catch(e){return r()}var i=null,o=null,a=[],u={sd_src:"SD",hd_src:"HD"};Array.isArray(s)||(s=[s]);for(var l,c=0;l=s[c];c++)["sd_src","hd_src"].forEach(e=>{if(l.thumbnail_src&&(i=l.thumbnail_src),l.video_duration&&(o=l.video_duration),l[e]){var t=this.getFileExtension(l[e],"mp4");a.push({url:l[e],name:u[e],type:t,ext:t.toUpperCase()})}});r(a,"",i,o)}getLinksFromData2(e,t,r,n){var s=null,i=function(e){return e.split(/"?videoData"?:\[/).some((function(e){return P(e).some((function(e){if((e.sd_src||e.hd_src)&&String(e.video_id)===String(t))return s=e,!0}))}))};if(r?i(e):k(e,[/"?videoData"?:\[/]).some(i),!s)return n();var o,a=[];return s.sd_src&&(o=this.getFileExtension(s.sd_src,"mp4"),a.push({url:s.sd_src,name:"SD",type:o,ext:o.toUpperCase()})),s.hd_src&&(o=this.getFileExtension(s.hd_src,"mp4"),a.push({url:s.hd_src,name:"HD",type:o,ext:o.toUpperCase()})),n(a,"",s.thumbnail_src,s.video_duration)}getFileExtension(e,t){var r=e.match(/\.([a-z0-9]{3,4})(\?|$)/i);return r?(r=r[1]).toLowerCase():t||""}getFacebookPhotoUrl(e,t){return e.fbid?(E({url:"https://www.facebook.com/photo.php?fbid="+e.fbid},(function(e,r,n){if(e||!n)return t();if(i=n.match(/<a[^>]+fbPhotosPhotoActionsItem[^>]+href="([^">]+dl=1)"[^>]+>/i)){var s=i[1].replace(/&amp;/g,"&");return t([s])}var i,o=[],a={};return(i=n.match(/(<a[^>]+rel="theater"[^>]+>)/gi))&&i.forEach((function(e){var t=e.match(/data-pl[os]i="[^"]+"/gi);t&&t.forEach((function(e){var t=e.indexOf("=");if(-1!==t){var r=e.substr(0,t),n=e.substr(t+1);n=n.substr(1,n.length-2).replace(/&amp;/g,"&"),a[r]=n,o.push(n)}}))})),a["data-ploi"]?t([a["data-ploi"]]):t(o)})),!0):t()}};var X=class{constructor(e){this.engine=e}getMailruLinks(e,t){return this._getMailruLinks(e.extVideoId,(function(r,n,s,i,o){var a={action:e.action,extVideoId:i||e.extVideoId,links:r,title:n,thumb:s,duration:o};t(a)})),!0}_getMailruLinks(e,t){var r,n=e,s=e.match(/\/([^\/]+)\/([^\/]+)\/video\/(.+).html/);if(s||(s=e.match(/embed\/([^\/]+)\/([^\/]+)\/(.+).html/)),s&&(r="http://api.video.mail.ru/videos/"+s[1]+"/"+s[2]+"/"+s[3]+".json",n=s[1]+"/"+s[2]+"/video/"+s[3]+".html"),r)return this.onGetMailruMetadataUrl(r,n,t);E({url:"http://my.mail.ru/"+e},(e,s,i)=>{if(e||!i)return t();var o=/"metaUrl":/,a=null;if(k(i,o).some((function(e){return L(e,o).some((function(e){if(e.metaUrl)return a=e,!0}))})),a)return r=a.metaUrl,void this.onGetMailruMetadataUrl(r,n,t);if(!(i=i.match(/<meta\s+content="[^"]+(videoapi\.my\.mail[^&]+)&[^"]+"[^>]+\/>/)))return t();var u=(i=decodeURIComponent(i[1])).substr(i.lastIndexOf("/")+1);r="http://videoapi.my.mail.ru/videos/"+u+".json",this.onGetMailruMetadataUrl(r,n,t)})}onGetMailruMetadataUrl(e,t,r){this.getMailruMetadata(e,e=>{if(!e||"string"==typeof e)return r();this.readMailruMetadata(e,(e,n,s,i)=>{r(this.prepMailruLinks(e),n,s,t,i)})})}prepMailruLinks(e){if(e){for(var t,r=[],n=0;t=e[n];n++){var s=t.url,i="FLV";-1!==s.indexOf(".mp4")&&(i="MP4"),-1!==s.indexOf(".mov")&&(i="MOV"),-1!==s.indexOf(".mpg")&&(i="MPG"),t.quality||(t.quality="-?-");var o=t.quality.toUpperCase(),a=["1080P","720P","480P","360P","272P"].indexOf(o);-1!==a&&(o=["1080","720","480","360","272"][a]);var u=i.toLowerCase();r.push({url:s,subname:o,name:i,ext:u})}return r.sort((function(e,t){return"HD"===e.subname?1:e.subname>t.subname})),r}}getMailruMetadata(e,t){if(!e)return t();E({url:e,json:!0},(function(e,r,n){if(e||!n)return t();t(n)}))}readMailruMetadata(e,t){var r,n=[],s=void 0,i=void 0;if(e.meta&&(i=e.meta.poster,s=e.meta.duration),"UPLOADED"===e.provider){if(r=e.movie?e.movie.title:void 0,!e.videos)return t();e.videos.forEach((function(e){n.push({quality:e.name,url:e.url,title:r})}))}else if("ugc"===e.provider){if(r=e.meta?e.meta.title:void 0,!e.videos)return t();e.videos.forEach((function(e){n.push({quality:e.key,url:e.url,title:r})}))}else if("pladform"===e.provider){return r=e.meta?e.meta.title:void 0,void this.engine.modules.odnoklassniki.getPladformVideo({extVideoId:{playerId:e.meta.playerId,videoId:e.meta.videoId}},(function(e){if(!e)return t();"getRutubeLinks"===e.action&&(e.links=null);var n=e.links;if(!n)return t();n.forEach((function(e){void 0===e.title&&(e.title=r)})),t(n,r,i,s)}))}return 0===n.length?t():t(n,r,i,s)}};const Y=o("utils");let ee=null;var te={getFileSize:function(e,t){const{url:r,requestOptions:n={}}=e;var s={fileSize:0,fileType:"",status:0,error:!1};return E({url:r,type:"HEAD",...n},(function(e,r){if(e)return s.error=!0,t(s);s.status=r.statusCode,s.fileSize=parseInt(r.headers["content-length"])||0;var n=r.headers["content-type"];n&&(s.fileType=n),t(s)})),!0},ChromeDl:function(){var e={},t=!1,r=function(r){e[r]&&delete e[r],0===Object.keys(e).length&&(t=!1,chrome.downloads.onChanged.removeListener(n))},n=function(t){var n=e[t.id];if(n){var s=!1;n.fixNetworkFiled&&(s=function(e,t){var r=parseInt(Date.now()/1e3),n=!1;e.lastFix||(e.lastFix=0),e.lastFix+5<r&&(e.lastFix=r,n=!0);var s=t.state&&"interrupted"===t.state.current,i=t.error&&"NETWORK_FAILED"===t.error.current,o=t.canResume&&t.canResume.current;return s&&i&&o||(n=!1),n}(n,t)),s?chrome.downloads.resume(t.id):t.state&&-1!==["interrupted","complete"].indexOf(t.state.current)&&r(t.id)}};this.download=function(r){var s=r.url,i=r.filename;r.fixNetworkFiled=/(vk\.me|userapi\.com)\/.+\.mp4/i.test(s);var o={url:s,filename:i},a=ee.preferences||ee.storage||{};x.isFirefox&&a.saveAsDialog&&(o.saveAs=!0),chrome.downloads.download(o,(function(s){r.fixNetworkFiled&&(!function(t,r){e[t]||(e[t]=r)}(s,r),t||(t=!0,chrome.downloads.onChanged.addListener(n)))}))}},chromeDownload:null,downloadFile:function(e){const{sortDownloads:t}=ee.preferences;if(t&&t.isEnabled){const r=e.options.filename.slice(e.options.filename.lastIndexOf(".")+1),n=t.groups.find(e=>e.formats.some(e=>-1!==e.indexOf(r)));n&&n.dir&&(e.options.filename=`${n.dir}/${e.options.filename}`)}var r=te;if(x.isChrome||x.isFirefox){r.chromeDownload||(r.chromeDownload=new r.ChromeDl);var n=function(){return r.chromeDownload.download(e.options)};if(chrome.downloads&&chrome.downloads.download)return n();chrome.permissions&&chrome.permissions.request?chrome.permissions.request({permissions:["downloads"]},(function(e){if(e)return n();Y.error("Permissions not granted!")})):Y.error("Method in not supported!")}else x.isGM&&GM_download(e.options.url,e.options.filename)},chromeListDownload:function(e,t){var r=null;e=e.map((function(e){return{url:e.url,filename:t+e.filename}}));var n=function(e){if(e.id===r&&e.state)return-1!==["interrupted","complete"].indexOf(e.state.current)?(r=null,i()):void 0};chrome.downloads.onChanged.addListener(n);var s=-1,i=function(){s++;var t=e[s];if(t)return chrome.downloads.download({url:t.url,filename:t.filename},(function(e){r=e}));chrome.downloads.onChanged.removeListener(n)};return i()},downloadList:function(e){var t=this,r=e.fileList,n=e.folder;(x.isChrome||x.isFirefox)&&chrome.downloads&&chrome.downloads.download?t.chromeListDownload(r,n):r.forEach((function(e){t.downloadFile({options:{url:e.url,filename:n+e.filename}})}))},getUmmyIcon:function(e,t){t("data:image/png;base64,iVBORw0KGgoAAAANSUhEUgAAABAAAAAQCAYAAAAf8/9hAAAB90lEQVQ4EcVSy2oUURCtqm7HcYgmYDTiYxEEERdZGP0B0UVwEcSv8LHIb4gbQcjGlVtB40YhfkAWuhs0uFOIgjJomiEzztzue4+n7rTgH6SaoqpPnao6fW+LHLapC9hdPHMbKT1UTcsQWxDBnAAdFkuvQ6QR1cD0QAUVoF+0kKdXBoO32j959maK8V1LVDaBDXkwm9q32atz/hmRpIZb5STqPaDIjP/oFAS5Xu1l/MPCBZhxt09uSRykCn1QhmQr1MiSQ3TPGYdIMtwfZPh3MjkhlvOWOcuTrJQB5VJeR0g5HlzjMSSVpp7mtQGFBJjXwJp69AlqtlTW0bpQ6nNLbTdjSCIxNhkOqUBwBconZYWZr1G6RgXcRoI782k0rO681vVq15o6SGyCrFefbHVnS6eNkmcSyMlOvr48ernimjlf5WcUuP1zr7C7W090/twiMcjw+y95dWcjXRr7Sn6Ba8mmB1RQ/MwqOK2mg356FPFi4xGm4z8I40nOT434OanElDdWM2aH/eAtHOlz98XZRBch0uPnHPu4J9uPn+dNzNGTLho/Kj+D1gza12fl1RuEtlmaaWPiGkOK8k0mecB5Nnes8DZvdiwPgRVrmbAp19aI8Fe2ZSDN86aOk9OpkfiHqfKoap9JfMTWfcavvNXN+/H9G596uPYX83AWUVC6/FsAAAAASUVORK5CYII=")},getWarningIcon:function(e,t){var r,n=e.color||"#c2c2c2";r="audio"===e.type?'<svg width="21px" height="24px" viewBox="0 0 21 24" version="1.1" xmlns="http://www.w3.org/2000/svg" xmlns:xlink="http://www.w3.org/1999/xlink"><path d="M21,2.76923077 L21,17.6487288 C21,17.6487288 21,17.6487288 21,17.6487288 L21,18.4615385 L20.9068729,18.4615385 C20.723595,19.2712249 20.2716013,20.0865791 19.5669296,20.7680198 C17.9203537,22.360313 15.5176896,22.6184747 14.2004289,21.3446402 C12.8831682,20.0708056 13.1501309,17.7473503 14.7967068,16.1550571 C16.0602516,14.9331676 17.7690324,14.4969051 19.0909091,14.9356816 L19.0909091,14.9356816 L19.0909091,4.15384615 L7.63636364,6.92307692 L7.63636364,19.4948826 C7.63636364,19.4948826 7.63636364,19.4948826 7.63636364,19.4948826 L7.63636364,20.3076923 L7.5432365,20.3076923 C7.35995859,21.1173788 6.90796493,21.9327329 6.20329323,22.6141737 C4.55671732,24.2064669 2.15405328,24.4646286 0.836792552,23.190794 C-0.480468173,21.9169595 -0.213505501,19.5935041 1.43307041,18.0012109 C2.69661523,16.7793214 4.40539601,16.343059 5.72727273,16.7818354 L5.72727273,16.7818354 L5.72727273,6.46153846 L5.72727273,3.69230769 L21,0 L21,2.76923077 Z" fill="'+n+'"></path></svg>':"playlist"===e.type?'<svg width="24px" height="18px" viewBox="0 0 24 18" version="1.1" xmlns="http://www.w3.org/2000/svg" xmlns:xlink="http://www.w3.org/1999/xlink"><path d="M0,0 L0,3.6 L3.42857143,3.6 L3.42857143,0 L0,0 Z M0,7.2 L0,10.8 L3.42857143,10.8 L3.42857143,7.2 L0,7.2 Z M5.14285714,0 L5.14285714,3.6 L24,3.6 L24,0 L5.14285714,0 Z M5.14285714,7.2 L5.14285714,10.8 L20.5714286,10.8 L20.5714286,7.2 L5.14285714,7.2 Z M0,14.4 L0,18 L3.42857143,18 L3.42857143,14.4 L0,14.4 Z M5.14285714,14.4 L5.14285714,18 L22.2857143,18 L22.2857143,14.4 L5.14285714,14.4 Z" fill="'+n+'"></path></svg>':'<svg width="24px" height="18px" viewBox="0 0 24 18" version="1.1" xmlns="http://www.w3.org/2000/svg" xmlns:xlink="http://www.w3.org/1999/xlink"><path d="M19.5,3 L21.0089096,3 C22.6582294,3 24,4.34288718 24,5.99942248 L24,15.0005775 C24,16.6556493 22.6608432,18 21.0089096,18 L2.99109042,18 C1.34177063,18 0,16.6571128 0,15.0005775 L0,5.99942248 C0,4.34435073 1.33915679,3 2.99109042,3 L7.5,3 C7.5,1.34651712 8.84187067,0 10.497152,0 L16.502848,0 C18.1583772,0 19.5,1.34314575 19.5,3 L19.5,3 Z M13.5,16.5 C16.8137087,16.5 19.5,13.8137087 19.5,10.5 C19.5,7.18629134 16.8137087,4.5 13.5,4.5 C10.1862913,4.5 7.5,7.18629134 7.5,10.5 C7.5,13.8137087 10.1862913,16.5 13.5,16.5 Z M13.5,15 C15.9852815,15 18,12.9852815 18,10.5 C18,8.0147185 15.9852815,6 13.5,6 C11.0147185,6 9,8.0147185 9,10.5 C9,12.9852815 11.0147185,15 13.5,15 Z" fill="'+n+'"></path></svg>',t("data:image/svg+xml;utf8,"+encodeURIComponent(r))},checkUrlsOfOpenTabs:function(e,t){(x.isGM?function(e){e([location.href])}:x.isChrome?function(e){var t=[];chrome.tabs.query({},(function(r){r.forEach((function(e){t.push(e.url)})),e(t)}))}:x.isFirefox?function(e){var t=[];if(x.isFirefoxMobile)return e(t);chrome.tabs.query({},(function(r){r.forEach((function(e){t.push(e.url)})),e(t)}))}:x.isSafari?function(e){var t=[];safari.application&&safari.application.activeBrowserWindow&&safari.application.activeBrowserWindow.tabs&&safari.application.activeBrowserWindow.tabs.forEach((function(e){if(!e.url)return 1;t.push(e.url)})),e(t)}:function(e){e([])})((function(r){var n=[];r.forEach((function(t){e.forEach((function(e){-1!==t.search(e)&&n.push(t)}))})),t(n)}))},getData:function(e,t){var r=e.url;return r?(E({url:r},(function(e,r,n){if(e)return t();t(n)})),!0):t()}};var re=e=>(ee=e,te);const ne=/\\(\\u[0-9a-f]{4})/g;var se=function(e){try{return JSON.parse(JSON.stringify(e).replace(ne,"$1"))}catch(t){return e}};var ie={maxLength:80,rtrim:/^[\s\uFEFF\xA0]+|[\s\uFEFF\xA0]+$/g,illegalRe:/[\/?<>\\:*|"~\u202B]/g,controlRe:/[\x00-\x1f\x80-\x9f]/g,zeroWidthJoinerRe:/\u200D/g,reservedRe:/^\.+/,trim:function(e){return e.replace(this.rtrim,"")},partsRe:/^(.+)\.([a-z0-9]{1,4})$/i,getParts:function(e){return e.match(this.partsRe)},specialChars:"nbsp,iexcl,cent,pound,curren,yen,brvbar,sect,uml,copy,ordf,laquo,not,shy,reg,macr,deg,plusmn,sup2,sup3,acute,micro,para,middot,cedil,sup1,ordm,raquo,frac14,frac12,frac34,iquest,Agrave,Aacute,Acirc,Atilde,Auml,Aring,AElig,Ccedil,Egrave,Eacute,Ecirc,Euml,Igrave,Iacute,Icirc,Iuml,ETH,Ntilde,Ograve,Oacute,Ocirc,Otilde,Ouml,times,Oslash,Ugrave,Uacute,Ucirc,Uuml,Yacute,THORN,szlig,agrave,aacute,acirc,atilde,auml,aring,aelig,ccedil,egrave,eacute,ecirc,euml,igrave,iacute,icirc,iuml,eth,ntilde,ograve,oacute,ocirc,otilde,ouml,divide,oslash,ugrave,uacute,ucirc,uuml,yacute,thorn,yuml".split(","),specialCharsList:[["amp","quot","lt","gt"],[38,34,60,62]],specialCharsRe:/&([^;]{2,6});/g,decodeSpecialChars:function(e){const t=this;return e.replace(this.specialCharsRe,(function(e,r){let n=null;if("#"===r[0])return n=parseInt(r.substr(1)),isNaN(n)?"":String.fromCharCode(n);let s=t.specialCharsList[0].indexOf(r);return-1!==s?(n=t.specialCharsList[1][s],String.fromCharCode(n)):-1!==(s=t.specialChars.indexOf(r))?(n=s+160,String.fromCharCode(n)):""}))},decodeHexChars:function(e){return e.replace(/(\\x[a-zA-Z0-9]{2})/g,(function(e,t){let r=t;try{r=String.fromCharCode(parseInt("0x"+r.substr(2),16))}catch(e){}return r}))},rnRe:/\r?\n/g,re1:/[*?"]/g,re2:/</g,re3:/>/g,spaceRe:/[\s\t\uFEFF\xA0]+/g,dblRe:/(\.|!|\?|_|,|-|:|\+){2,}/g,re4:/[.,:;\/\-_+=']$/g,modify:function(e){if(!e)return"";e=se(e);try{e=decodeURIComponent(e)}catch(t){e=unescape(e)}if(e=(e=this.decodeSpecialChars(e)).replace(this.rnRe," "),(e=(e=this.trim(e)).replace(this.zeroWidthJoinerRe,"").replace(this.re1,"").replace(this.re2,"(").replace(this.re2,"(").replace(this.re3,")").replace(this.spaceRe," ").replace(this.dblRe,"$1").replace(this.illegalRe,"_").replace(this.controlRe,"").replace(this.reservedRe,"").replace(this.re4,"")).length>this.maxLength){const t=this.getParts(e);t&&3==t.length&&(t[1]=t[1].substr(0,this.maxLength),e=t[1]+"."+t[2])}return this.trim(e)}};var oe=e=>{let t=null;return(t=()=>{}).log=t.info=t.warn=t.error=t.debug=t,t};const ae=oe("webRequest");var ue=function(){const e=/^sf-\d+_/,t={urls:["<all_urls>"],types:["xmlhttprequest"]};let r=!1;const n={},s={},i=function(e){for(let t in e)return!1;return!0},o=function(e){delete s[e.requestId],i(n)&&i(s)&&l()},a=function(t){const r=s[t.requestId],o=t.requestHeaders||[];let a=[],u=[];const l=[];if(r)u=r.changes,a=r.filtered;else if(!i(n)){let t,r;for(let s,i=0;s=o[i];i++)t=s.name,e.test(t)&&(r=n[t])&&(s.name=r.name,s.value=r.value,u.push(s),a.push(r.name.toLowerCase()),a.push(t.toLowerCase()),/cookie/i.test(s.name)&&l.push("set-cookie"),clearTimeout(r.timer),delete n[t])}if(u.length){return r||(s[t.requestId]={changes:u,filtered:a,filterResponseHeaders:l}),{requestHeaders:o.filter((function(e){return-1===a.indexOf(e.name.toLowerCase())})).concat(u)}}},u=function(e){const t=s[e.requestId],r=e.responseHeaders;if(t&&r){const e=t.filterResponseHeaders;return{responseHeaders:r.filter((function(t){return-1===e.indexOf(t.name.toLowerCase())}))}}},l=function(){r&&(r=!1,chrome.webRequest.onBeforeSendHeaders.removeListener(a,t,["blocking","requestHeaders"]),chrome.webRequest.onHeadersReceived.removeListener(u,t,["blocking","responseHeaders"]),chrome.webRequest.onResponseStarted.removeListener(o,t),chrome.webRequest.onErrorOccurred.removeListener(o,t),ae.debug("webRequest","rm listener"))};let c=10,d=!1;const h=function(){return!0};let m=null;const p=function(e){return(null===m||e)&&(m=!!(chrome.webRequest&&chrome.webRequest.onBeforeSendHeaders&&chrome.webRequest.onResponseStarted&&chrome.webRequest.onErrorOccurred)),m},f=/^user-agent$|^origin$|^cookie$/i;return{wrapHeaderKey:function(e,s){if(p()){let i,l=100;for(;l-- >0&&(i="sf-"+parseInt(1e5*Math.random())+"_"+e,n[i]););return n[i]={name:e,value:s,timer:setTimeout((function(){delete n[i]}),3e3)},r||(r=!0,chrome.webRequest.onBeforeSendHeaders.addListener(a,t,["blocking","requestHeaders"]),chrome.webRequest.onHeadersReceived.addListener(u,t,["blocking","responseHeaders"]),chrome.webRequest.onResponseStarted.addListener(o,t),chrome.webRequest.onErrorOccurred.addListener(o,t),ae.debug("webRequest","add listener")),i}return e},isSpecialHeader:function(e){return f.test(e)},isSupported:h,requestPermission:function(e){p()||d?e(m):chrome.permissions&&chrome.permissions.request?chrome.permissions.request({permissions:["webRequest","webRequestBlocking"]},(function(t){(t||c--<=0)&&(d=!0),t&&p(!0),e(m)})):(d=!0,e(m))}}}();const le=r(0);var ce=function(e,t){const r={};let n=function(e,r){n=null,u.timeoutTimer&&clearTimeout(u.timeoutTimer);let i=null;e&&(i=String(e.message||e)||"ERROR"),t&&t(i,s(r),r)};const s=function(e){const t={};t.statusCode=c.status,t.statusText=c.statusText;let r=null;const n=c.getAllResponseHeaders();return"string"==typeof n&&(r=function(e){e=e.split(/\r?\n/);const t={};return e.forEach((function(e){const r=e.indexOf(":");if(-1===r)return;const n=e.substr(0,r).trim().toLowerCase(),s=e.substr(r+1).trim();t[n]=s})),t}(n)),t.headers=r||{},t.body=e,t};"object"!=typeof e&&(e={url:e});let i=e.url,o=e.method||e.type||"GET";o=o.toUpperCase();let a=e.data;"string"!=typeof a&&(a=le.stringify(a)),a&&"GET"===o&&(i+=(/\?/.test(i)?"&":"?")+a,a=void 0),!1===e.cache&&-1!==["GET","HEAD"].indexOf(o)&&(i+=(/\?/.test(i)?"&":"?")+"_="+Date.now()),e.headers=e.headers||{},a&&(e.headers["Content-Type"]=e.contentType||e.headers["Content-Type"]||"application/x-www-form-urlencoded; charset=UTF-8");const u={};u.url=i,u.method=o,a&&(u.data=a),e.json&&(u.json=!0),e.xml&&(u.xml=!0),e.timeout&&(u.timeout=e.timeout),e.mimeType&&(u.mimeType=e.mimeType),e.withCredentials&&(u.withCredentials=!0),Object.keys(e.headers).length&&(u.headers=e.headers),u.timeout>0&&(u.timeoutTimer=setTimeout((function(){n&&n(new Error("ETIMEDOUT")),c.abort()}),u.timeout));const l={0:200,1223:204};var c=new XMLHttpRequest;c.open(u.method,u.url,!0),u.mimeType&&c.overrideMimeType(u.mimeType),u.withCredentials&&(c.withCredentials=!0);const d=[];for(let e in u.headers)ue.isSpecialHeader(e)&&d.push({key:e,value:u.headers[e]}),c.setRequestHeader(e,u.headers[e]);c.onload=function(){const e=l[c.status]||c.status;try{if(e>=200&&e<300||304===e){let e=c.responseText;if(u.json)e=JSON.parse(e);else if(u.xml)e=(new DOMParser).parseFromString(e,"text/xml");else if("string"!=typeof e)throw console.error("Response is not string!",e),new Error("Response is not string!");return n&&n(null,e)}throw new Error(c.status+" "+c.statusText)}catch(e){return n&&n(e)}};const h=c.onerror=function(){n&&n(new Error(c.status+" "+c.statusText))};let m=null;void 0!==c.onabort?c.onabort=h:m=function(){4===c.readyState&&n&&setTimeout((function(){return h()}))},m&&(c.onreadystatechange=m);const p=function(){try{c.send(u.data||null)}catch(e){setTimeout((function(){n&&n(e)}))}};if(d.length&&ue.isSupported()){const e=function(){for(let e,t=0;e=d[t];t++)c.setRequestHeader(ue.wrapHeaderKey(e.key,e.value),e.value)};ue.requestPermission((function(t){t&&e(),n&&p()}))}else p();return r.abort=function(){n=null,c.abort()},r};var de=()=>"y2mate-chrome";var he=function(e,t){var r,n;return t=t||250,function(){var s=Date.now(),i=arguments;r&&s<r+t?(clearTimeout(n),n=setTimeout((function(){r=s,e.apply(null,i)}),t)):(r=s,e.apply(null,i))}};var me=function(){return"xxxxxxxx-xxxx-4xxx-yxxx-xxxxxxxxxxxx".replace(/[xy]/g,(function(e){var t=16*Math.random()|0;return("x"==e?t:3&t|8).toString(16)}))};var pe=e=>t=>e.some(e=>((e,t)=>{let r=e.matches.test(t);return r&&e.exclude_matches&&(r=!e.exclude_matches.test(t)),r&&e.include_globs&&(r=e.include_globs.test(t)),r&&e.exclude_globs&&(r=!e.exclude_globs.test(t)),r})(e,t));const fe=r(5),ge=r(6),ve=e=>new RegExp(e,"i");var be=e=>e.map(e=>({matches:ve([].concat(...e.matches.map(e=>fe(e))).join("|")),exclude_matches:e.exclude_matches&&ve([].concat(...e.exclude_matches.map(e=>fe(e))).join("|")),include_globs:e.include_globs&&ve([].concat(...e.include_globs.map(e=>ge(e))).join("|")),exclude_globs:e.exclude_globs&&ve([].concat(...e.exclude_globs.map(e=>ge(e))).join("|"))}));const ye=r(0),we=oe("background");const xe=new class{constructor(){this.onMessage=this.onMessage.bind(this),this.onTabActivated=this.onTabActivated.bind(this),this.onWindowCreate=this.onWindowCreate.bind(this),this.onWindowRemoved=this.onWindowRemoved.bind(this),this.onTabRemoved=this.onTabRemoved.bind(this),this.onTabUpdate=this.onTabUpdate.bind(this),this.onHeadersReceived=this.onHeadersReceived.bind(this),this.readRequestList=this.readRequestList.bind(this),this.preferences={softDownloads:0},this.rulesObj={},this.rulesArr=[{name:"block",rules:[{key:"url",re:/^[^/]+\/\/([^/]+\.)?googlevideo\.|^[^/]+\/\/([^/]+\.)?youtube\./}]},{name:"block",rules:[{key:"url",re:/mradx\.net|vk\.com|\.vkuseraudio\.|\.vkuservideo\.|mycdn\.me/}]},{name:"block",rules:[{key:"url",re:/^https?:\/\/.+\.fbcdn\.net\/.+\?.+&bytestart=\d+&byteend=\d+$|^https?:\/\/.+\.(?:vimeocdn\.com|akamaihd|akamaized\.net)\/.+\/chop\/segment-\d+\.m4s$|^https?:\/\/.+\.(?:dailymotion\.net|dailymotion\.com)\/.+\/frag\(\d+\)\/.+\/\d+_[^\/]+\.ts$|^https?:\/\/.+\.akamaihd\.net\/.+\/[^\/]+_chunk_\d+_[^\/]+\.flv$|^https?:\/\/.+\.ttvnw\.net\/.+\/segment\/.+$|^https?:\/\/hls\.goodgame\.ru\/.+\/([^\/]+\.(ts|m4a)|\d+\.m3u8\?.+)$/}]},{name:"videoAudio",rules:[{key:"headers",item:"content-type",re:/^(video|audio)\//}]},{name:"m3u8",rules:[{key:"headers",item:"content-type",re:/application\/vnd\.apple\.mpegurl/}]}],this.matchContentTypeRe=/^([^\/]+)\/(.+)$/,this.matchFileNameRe=/\/([^?#\/]+)(?:\?|#|$)/,this.matchHeaderFileNameRe=/filename="(.+)"$/,this.matchDomainRe=/:\/\/(?:[^@\/?#]+@)?([^\/?:#]+)/,this.typesRe=/^(?:stylesheet|script|image|sub_frame)$/,this.tabs={},this.visibleTabs=[],this.winTabMap={},this.storage={},this.extra={},this.isFirstRun=!1,this.isReady=!1,this.modules={vimeo:new A(this),dailymotion:new H(this),soundcloud:new D(this),vkontakte:new G(this),odnoklassniki:new Z(this),facebook:new Q(this),mail_ru:new X(this)},this.utils=re(this),this.readyPromise=new Promise(e=>{this.readyHandler=e}).then(()=>{this.isReady=!0}),this.tabListener=function(){let e=!1;const t=pe(be([{matches:["*://*.vimeo.com/*","*://*.youtube.com/*","*://*.soundcloud.com/*","*://*.vk.com/*","*://*.vkontakte.ru/*","*://*.ok.ru/*","*://*.odnoklassniki.ru/*","*://my.mail.ru/*","*://*.facebook.com/*","*://*.savefrom.net/*","*://*.instagram.com/*","*://*.rutube.ru/*","*://*.tiktok.com/*"]},{matches:["<all_urls>"],include_globs:["*://dailymotion.*/*","*://*.dailymotion.*/*"]}])),r={},n=function(){e=!1,we.debug("tabListener",e)};return{enable:function(){e||(e=!0,we.debug("tabListener",e))},disable:function(){n()},openPage:s=>{e&&function(e,s){if(!e||!e.id||!s)return;const i=t(s),o=[];let a=!0;for(let e in r){a=!1;const t=r[e];if(!i||t.noBlackList){const e=t.getScriptList(s)||[];o.push(...e)}}if(a)n();else if(o.length){const t=o.filter((e,t,r)=>r.indexOf(e)===t);we.debug("Inject",s,t),t.forEach(t=>{chrome.tabs.executeScript(e.id,{file:t})})}}(s.tab,s.url)},extendJsList:r}}(),this.actionList={openPage:(e,t)=>{this.isReady?xe.tabListener.openPage(t):this.readyPromise.then(()=>{xe.tabListener.openPage(t)})},getResList:(e,t,r)=>{const n=this.tabs[e.tabId],s=n&&n.res||[];return r({tabId:e.tabId,resList:s})},clear:(e,t,r)=>{const n=this.tabs[e.tabId];return n&&(n.clear(),this.updateBadge(n)),r()},download:e=>{const t=e.info,r=t.dlUrl||t.url,n=t.filename,s=t.pageDomain;for(let e in this.tabs){const r=this.tabs[e],n=r&&r.res;n&&n.forEach(e=>{e.url===t.url&&(e.downloaded=!0)})}chrome.downloads.download({url:r,filename:n||void 0}),s&&this.sendStatsInfo({ec:"download",ea:"hostname",el:s,t:"event"})},getPreferences:(e,t,r)=>{r(this.storage)},updateOption:e=>{const t=this.storage,r=e.key,n=e.value;t[r]=n;const s={};s[r]=n,chrome.storage.local.set(s)}}}getDomain(e){if("string"!=typeof e)return null;let t=e.match(this.matchDomainRe);return t=t&&t[1]}getFileNameInfo(e,t){const r={};let n,s;if((s=t["content-disposition"])&&(n=(n=s.match(this.matchHeaderFileNameRe))&&n[1]),n||(n=(n=e.url.match(this.matchFileNameRe))&&n[1]),n){const e=(n=ie.modify(n)).lastIndexOf(".");-1!==e&&(r.ext=n.substr(e+1))}return r.filename=n,r}readHeader(e){const t={};for(let r,n=0;r=e[n];n++)t[r.name.toLowerCase()]=r.value;return t}updateBadge(e){const t=e.res.length;let r="";t>99?r="99+":t&&(r=t.toString()),chrome.browserAction.setBadgeText({text:r,tabId:e.id},()=>{const e=chrome.runtime.lastError;e&&we.debug("Update badge error",e)})}readTabRequestList(e,t){const r=t.raw,n=t.res,s=t.ddBl;let i;if(!r.length)return void this.updateBadge(t);let o=null,a=null;const u=()=>{o=this.readHeader(i.responseHeaders)},l=e=>{const t=e.re,r=e.key;return"headers"===r?(!o&&u(),t.test(o[e.item])):t.test(i[r])},c=e=>{if(e.rules.every(l))return a=e.name,!0};for(;i=r.shift();){if(o=null,a=null,this.rulesArr.some(c),!a||"block"===a)continue;!o&&u();const t=(o["content-type"]||"").toLowerCase().match(this.matchContentTypeRe);if(!t)continue;const r=this.getFileNameInfo(i,o),l={tabId:i.tabId,statusCode:i.statusCode,method:i.method,url:i.url,headers:o,filename:r.filename||"",type:t[1],ext:r.ext||"",format:t[2],count:1,pageUrl:i.pageUrl,pageDomain:this.getDomain(i.pageUrl),timeStamp:i.timeStamp,rule:a},d=this.rulesObj[a]||{};d.prepare&&d.prepare(l),l.url&&(void 0===s[l.url]?(s[l.url]=l,e.push(l),n.push(l)):(s[l.url].count++,e.push(s[l.url])))}this.updateBadge(t)}readRequestList(e){const t=[];if(e)for(let r,n=0;r=e[n];n++)this.readTabRequestList(t,r);else{e=this.tabs;for(let r in e)this.readTabRequestList(t,e[r])}t.length&&chrome.runtime.sendMessage({action:"update",diff:t})}onMessage(e,t,r){if(!e||"object"!=typeof e)return void debug.debug("Skip message",e);const n=(t,n)=>{const s=n.call(t,e,r);return s instanceof Promise?(s.then(r),!0):s},s=e.action;let i=this.actionList[s];if(i)return i.call(this,e,t,r);for(let e in this.modules){const t=this.modules[e],r=t[s];if(r)return n(t,r)}return(i=this.utils[s])?i.call(this,e,r):void 0}getTabItem(e){let t=this.tabs[e];return t||(t={id:e,raw:[],res:[],ddBl:{},throttle:he(this.readRequestList,500),url:"<unknown>",clear:()=>{for(let e in t.ddBl)delete t.ddBl[e];t.raw.splice(0),t.res.splice(0)}},this.tabs[e]=t)}onHeadersReceived(e){if(this.typesRe.test(e.type))return;const t=e.tabId;if(-1===t)return;const r=this.getTabItem(t);"main_frame"===e.type&&this.setTabUrl(r,e.url),e.statusCode<200||e.statusCode>400||204===e.statusCode||(e.pageUrl=r.url,r.raw.push(e),-1!==this.visibleTabs.indexOf(t)&&r.throttle([r]))}updateActiveTabList(){const e=this.visibleTabs;chrome.tabs.query({active:!0},t=>{let r,n=[];const s=t.map(t=>{const s=t.id;return this.winTabMap[t.windowId]=s,-1===e.indexOf(s)&&(r=this.tabs[s])&&n.push(r),s});e.splice(0),e.push.apply(e,s),n.length&&this.readRequestList(n)})}onTabActivated(e){const t=e.tabId,r=this.winTabMap[e.windowId];this.winTabMap[e.windowId]=t;const n=this.visibleTabs.indexOf(r);-1!==n&&this.visibleTabs.splice(n,1),this.visibleTabs.push(t);const s=this.tabs[t];s&&this.readRequestList([s])}onTabRemoved(e){delete this.tabs[e]}setTabUrl(e,t){if("<unknown>"===e.url)return void(e.url=t);if(e.url===t)return;const r=this.getDomain(e.url),n=this.getDomain(t);e.url=t,r!==n&&(e.clear(),this.updateBadge(e),chrome.runtime.sendMessage({action:"clearPopup",tabId:e.id}))}onTabUpdate(e,t){if(!t.url)return;const r=this.tabs[e];r&&this.setTabUrl(r,t.url)}onWindowCreate(){this.updateActiveTabList()}onWindowRemoved(e){delete this.winTabMap[e],this.updateActiveTabList()}loadSettings(e){let t=!1;x.isChrome&&(chrome.downloads&&chrome.downloads.download||chrome.permissions&&chrome.permissions.request)&&(t=!0),x.isFirefox&&(t=!0),chrome.storage.local.get({downloads:t,saveAsDialog:!0,lc:null,uuid:null,luxinsEnabled:1,goalEnabled:1,moduleVimeo:1,moduleDailymotion:1,moduleSoundcloud:1,moduleYoutube:!1,moduleVkontakte:1,moduleOdnoklassniki:1,moduleMailru:1,moduleFacebook:1,moduleInstagram:1,moduleRutube:1,moduleTiktok:1,ffmpegEnabled:!1,ytHideFLV:0,ytHideMP4:0,ytHideWebM:1,ytHide3GP:1,ytHide3D:1,sortDownloads:0},t=>{this.isFirstRun=null===t.uuid,this.storage=t,e&&e()})}saveSettings(e){chrome.storage.local.set(this.storage,e)}init(){this.updateActiveTabList(),chrome.runtime.onMessage.addListener(this.onMessage),chrome.tabs.onActivated.addListener(this.onTabActivated),chrome.windows.onCreated.addListener(this.onWindowCreate),chrome.windows.onRemoved.addListener(this.onWindowRemoved),chrome.tabs.onRemoved.addListener(this.onTabRemoved),chrome.tabs.onUpdated.addListener(this.onTabUpdate),chrome.webRequest.onHeadersReceived.addListener(this.onHeadersReceived,{urls:["<all_urls>"]},["responseHeaders"]),this.loadSettings(()=>{setTimeout(()=>{this.sendPing()},3e5),null===this.storage.lc?(this.storage.lc=Math.random()<.05,this.saveSettings(()=>this.readyHandler())):this.readyHandler()})}sendStatsInfo(e,t){t=t||{};const r={v:1,ul:navigator.language,tid:"UA-148191148-1",cid:this.getUuid(),an:"all-in-all",aid:de(),av:"1.26.0"};for(let t in r)e.hasOwnProperty(t)||(e[t]=r[t]);ce({url:"https://www.google-analytics.com/collect?z="+Date.now(),type:"POST",data:ye.stringify(e),timeout:6e4},t.cb)}sendPing(){chrome.storage.local.get(["statExpire"],e=>{const t=parseInt(Date.now()/1e3);e.statExpire>t||this.sendStatsInfo({cd:"init",t:"screenview"},{cb:r=>{r||(e.statExpire=t+86400,chrome.storage.local.set(e))}})})}getUuid(){let e=this.storage.uuid;return"string"==typeof e&&36===e.length?e:(e=this.storage.uuid=me(),this.saveSettings(),e)}};x.remote.getPreferences=()=>xe.readyPromise.then(()=>xe.storage),xe.init()}]);