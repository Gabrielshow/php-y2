!function(e){function t(t){for(var n,a,s=t[0],l=t[1],u=t[2],c=0,f=[];c<s.length;c++)a=s[c],o[a]&&f.push(o[a][0]),o[a]=0;for(n in l)Object.prototype.hasOwnProperty.call(l,n)&&(e[n]=l[n]);for(d&&d(t);f.length;)f.shift()();return i.push.apply(i,u||[]),r()}function r(){for(var e,t=0;t<i.length;t++){for(var r=i[t],n=!0,s=1;s<r.length;s++){var l=r[s];0!==o[l]&&(n=!1)}n&&(i.splice(t--,1),e=a(a.s=r[0]))}return e}var n={},o={11:0},i=[];function a(t){if(n[t])return n[t].exports;var r=n[t]={i:t,l:!1,exports:{}};return e[t].call(r.exports,r,r.exports,a),r.l=!0,r.exports}a.m=e,a.c=n,a.d=function(e,t,r){a.o(e,t)||Object.defineProperty(e,t,{enumerable:!0,get:r})},a.r=function(e){"undefined"!=typeof Symbol&&Symbol.toStringTag&&Object.defineProperty(e,Symbol.toStringTag,{value:"Module"}),Object.defineProperty(e,"__esModule",{value:!0})},a.t=function(e,t){if(1&t&&(e=a(e)),8&t)return e;if(4&t&&"object"==typeof e&&e&&e.__esModule)return e;var r=Object.create(null);if(a.r(r),Object.defineProperty(r,"default",{enumerable:!0,value:e}),2&t&&"string"!=typeof e)for(var n in e)a.d(r,n,function(t){return e[t]}.bind(null,n));return r},a.n=function(e){var t=e&&e.__esModule?function(){return e.default}:function(){return e};return a.d(t,"a",t),t},a.o=function(e,t){return Object.prototype.hasOwnProperty.call(e,t)},a.p="";var s=window.webpackJsonp=window.webpackJsonp||[],l=s.push.bind(s);s.push=t,s=s.slice();for(var u=0;u<s.length;u++)t(s[u]);var d=l;i.push([223,0]),r()}({135:function(e,t,r){(t=r(48)(!1)).push([e.i,'._1Atec--theme-twitch{position:relative;left:-30px}._1Atec--theme-twitch ._1lpo4--item-container{border-radius:0;margin-top:8px;box-shadow:none;font-size:13px;top:-9px;right:100px}._1Atec--theme-twitch ._1lpo4--item-container .aZHUa--item{color:#000;padding:4px}._1Atec--theme-twitch ._1lpo4--item-container .aZHUa--item:hover{background:#ab7fef;color:#fff}._1Atec--theme-twitch ._1lpo4--item-container .V1vfD--download-bar{background:rgba(81,129,184,.09);position:absolute;border-right:2px solid rgba(112,81,184,.72);display:none;transition:.5s;margin-top:-3px;left:0;top:2px;height:100%}.EKwtn--theme-vk ._1lpo4--item-container .aZHUa--item{margin-left:0;display:block;white-space:nowrap;position:relative;height:30px;line-height:30px;padding:0 15px;color:#2a5885;outline:none}.EKwtn--theme-vk ._1lpo4--item-container .aZHUa--item:hover{background-color:#e4eaf0}.EKwtn--theme-vk ._1lpo4--item-container .aZHUa--item ._3KbeB--tooltip{top:0;right:228px;padding:0 10px 3px 6px}.EKwtn--theme-vk ._1lpo4--item-container .aZHUa--item .V1vfD--download-bar{position:absolute;top:0;left:0}._1p0NM--theme-matchtv ._1lpo4--item-container{right:185px}._1p0NM--theme-matchtv ._1lpo4--item-container .V1vfD--download-bar{background-image:linear-gradient(90deg,rgba(8,174,234,.12),rgba(42,245,152,.73))}._1lpo4--item-container{position:absolute;background:#fff;padding:4px 0;z-index:9999;box-shadow:0 1px 3px rgba(80,80,80,.27);border:1px solid #c5d0db;border-radius:4px;font-size:12px;min-width:190px;transition:.5s;margin-left:13px}._1lpo4--item-container .aZHUa--item{position:relative;cursor:pointer;padding-top:5px;padding-bottom:5px;padding-left:9px}._1lpo4--item-container .aZHUa--item:hover{background:#e6e6e6}._1lpo4--item-container .aZHUa--item._2YfIz--item-disable{opacity:.8}._1lpo4--item-container .bmsfa--message{padding:3px}._1lpo4--item-container.rGfcJ--show{display:block}._1lpo4--item-container._139b6--hide{display:none}._1lpo4--item-container .V1vfD--download-bar{top:0;left:0;background:rgba(81,129,184,.09);height:30px;position:absolute;border-right:2px solid rgba(81,129,184,.57);display:none;transition:.5s}._1lpo4--item-container ._3KbeB--tooltip{position:absolute;right:202px;top:0;background:#000;z-index:9999;color:#fff!important;border-radius:3px;padding:3px 10px 3px 6px;width:-webkit-max-content;width:-moz-max-content;width:max-content;font-size:13px}._1lpo4--item-container ._3KbeB--tooltip:after{content:"";position:absolute;top:50%;left:100%;margin-top:-5px;border:5px solid transparent;border-left-color:#000}._1lpo4--item-container ._2dpFw--badge{background:rgba(30,30,30,.75);display:inline;float:right;color:#fff;padding-left:4px;padding-right:4px;border-radius:2px;font-size:10px;text-transform:uppercase;height:24px;margin-top:3px;line-height:26px;top:0;right:11px;position:absolute}',""]),t.locals={"theme-twitch":"_1Atec--theme-twitch",themeTwitch:"_1Atec--theme-twitch","item-container":"_1lpo4--item-container",itemContainer:"_1lpo4--item-container",item:"aZHUa--item","download-bar":"V1vfD--download-bar",downloadBar:"V1vfD--download-bar","theme-vk":"EKwtn--theme-vk",themeVk:"EKwtn--theme-vk",tooltip:"_3KbeB--tooltip","theme-matchtv":"_1p0NM--theme-matchtv",themeMatchtv:"_1p0NM--theme-matchtv","item-disable":"_2YfIz--item-disable",itemDisable:"_2YfIz--item-disable",message:"bmsfa--message",show:"rGfcJ--show",hide:"_139b6--hide",badge:"_2dpFw--badge"},e.exports=t},223:function(t,r,n){"use strict";n.r(r);var o={};n.r(o),n.d(o,"RULES",(function(){return tn})),n.d(o,"PROVIDERS",(function(){return rn})),n.d(o,"hlsProvider",(function(){return nn})),n.d(o,"m3u8Provider",(function(){return on})),n.d(o,"mapSetProvider",(function(){return an}));var i=n(0),a=n(15),s=n(17),l=n(29),u=n(20),d=n(21),c=n(63),f=n(13),p=n(39),h=n(7),m=n(14),v=n(11),b=n(46),g=n(34),_=n(22),y=n(2),w=n(1),k=n(44),S=n(5),x=n(19),R=n(10),A=n(18),P=n(9),C=n(27),E=n(40);function O(e,t){const r=t.split("?extra=")[1].split("#"),n=r[0],o=r[1],i=o?L(o):"",a=L(n);let s=(i?i.split(String.fromCharCode(9)):[])[0].split(String.fromCharCode(11)),l=s.splice(0,1,a)[0];return!!T[l]&&(t=T[l].apply(null,[...s,e]))}function q(e){return/\.m3u8\?/.test(e)}const T={s:(e,t)=>{let r=e.length;if(r){let n=function(e,t){let r=e.length,n=[];if(r){let e=r;for(t=Math.abs(t);e--;)t=(r*(e+1)^t+e)%r,n[e]=t}return n}(e,t),o=0;for(e=e.split("");++o<r;)e[o]=e.splice(n[r-1-o],1,e[o])[0];e=e.join("")}return e},i:(e,t,r)=>T.s(e,t^r)};function L(e){if(!e||e.length%4==1)return!1;for(var t,r,n=0,o=0,i="";r=e.charAt(o++);)~(r="abcdefghijklmnopqrstuvwxyzABCDEFGHIJKLMN0PQRSTUVWXYZO123456789+/=".indexOf(r))&&(t=n%4?64*t+r:r,n++%4)&&(i+=String.fromCharCode(255&t>>(-2*n&6)));return i}function M(e,t){const r=[];let n;for(;null!==(n=t.exec(e));)n.index===t.lastIndex&&t.lastIndex++,r.push(n);return r}function I(e,...t){const r=[];for(let n=0;n<e.length;n++){!r.find(r=>t.every(t=>r[t]===e[n][t]))&&r.push(e[n])}return r}const j=Object(R.a)("tools/youtube");function N(e){return new Promise((t,r)=>{i.a.sendMessage({action:"getFileSize",url:e},(function({fileSize:r}){if(0===r||!Number.isFinite(r))return t(!1);i.a.sendMessage({action:"getFileSize",url:e,requestOptions:{type:"GET",headers:{Range:`bytes=${r-8}-${r}`}}},(function({error:r}){r?j.debug(`Link ${e} don't have content`):j.debug(`Link ${e} have content`),t(!r)}))}))})}const B=e=>{const t={full:1080,hd:720,sd:480,low:360,lowest:240,mobile:144};return e.rawQuality=e.quality,e.quality=t[e.quality]?String(t[e.quality]):e.quality,e};var F=n(12);class D{constructor(e,t=null){this.master=void 0,this.secretKeyEndpoint=void 0,this.isAES_128=!1,this.master=e,t&&(this.masterEndpoint=t);const r=this.master.match(/AES-128,URI="(.*?)"/);r&&(this.isAES_128=!0,this.secretKeyEndpoint=r[1]);const n=M(e,/#EXTINF:.*?,.*?$\n(?<url>.*?)$/gms);this.urls=[];for(let e of n)e.groups&&e.groups.url?this.urls.push(e.groups.url):e[1]&&this.urls.push(e[1])}isAES128(){return this.isAES_128}fetchSecretKey(){return fetch(this.secretKeyEndpoint).then(e=>e.arrayBuffer())}mapUrls(e){this.urls=this.urls.map(e)}static async createFromURL(e){const t=await Object(_.a)(e);return new D(t.body,e)}getUrlSegments(){if(-1===this.urls[0].indexOf("https://")){const e=this.masterEndpoint.split("/").slice(0,-1).join("/");return this.urls.map(t=>t.replace(/^(.*?)\.ts$/gm,e+"/$1.ts"))}return this.urls}getChunkUrls(){return this.urls}toString(){let e="";if(!/^https?:/.test(this.master)&&this.masterEndpoint){const t=this.masterEndpoint.split("/").slice(0,-1).join("/");e=this.master.replace(/^(.*?)\.ts$/gm,t+"/$1.ts")}return e}toBlob(){return new Blob([this.toString()],{type:"application/vnd.apple.mpegurl"})}}var z="function"==typeof Symbol&&"symbol"==typeof Symbol.iterator?Symbol:function(e){return"Symbol("+e+")"};function U(){}var W=Number.isNaN||function(e){return e!=e},H=U;function V(e){return"object"==typeof e&&null!==e||"function"==typeof e}function $(e){return e.slice()}function K(e){return!1!==function(e){if("number"!=typeof e)return!1;if(W(e))return!1;if(e<0)return!1;return!0}(e)&&e!==1/0}function Y(e,t,r){if("function"!=typeof e)throw new TypeError("Argument is not a function");return Function.prototype.apply.call(e,t,r)}function J(e,t,r,n){var o=e[t];if(void 0!==o){if("function"!=typeof o)throw new TypeError(o+" is not a method");switch(r){case 0:return function(){return Z(o,e,n)};case 1:return function(t){var r=[t].concat(n);return Z(o,e,r)}}}return function(){return ae(void 0)}}function X(e,t,r){var n=e[t];if(void 0!==n)return Y(n,e,r)}function Z(e,t,r){try{return ae(Y(e,t,r))}catch(e){return se(e)}}function G(e){return e}function Q(e){if(e=Number(e),W(e)||e<0)throw new RangeError("highWaterMark property of a queuing strategy must be non-negative and non-NaN");return e}function ee(e){if(void 0===e)return function(){return 1};if("function"!=typeof e)throw new TypeError("size property of a queuing strategy must be a function");return function(t){return e(t)}}var te=Promise,re=Promise.prototype.then,ne=Promise.resolve.bind(te),oe=Promise.reject.bind(te);function ie(e){return new te(e)}function ae(e){return ne(e)}function se(e){return oe(e)}function le(e,t,r){return re.call(e,t,r)}function ue(e,t,r){le(le(e,t,r),void 0,H)}function de(e,t){ue(e,t)}function ce(e,t){ue(e,void 0,t)}function fe(e,t,r){return le(e,t,r)}function pe(e){le(e,void 0,H)}var he=function(){function e(){this._cursor=0,this._size=0,this._front={_elements:[],_next:void 0},this._back=this._front,this._cursor=0,this._size=0}return Object.defineProperty(e.prototype,"length",{get:function(){return this._size},enumerable:!0,configurable:!0}),e.prototype.push=function(e){var t=this._back,r=t;16383===t._elements.length&&(r={_elements:[],_next:void 0}),t._elements.push(e),r!==t&&(this._back=r,t._next=r),++this._size},e.prototype.shift=function(){var e=this._front,t=e,r=this._cursor,n=r+1,o=e._elements,i=o[r];return 16384===n&&(t=e._next,n=0),--this._size,this._cursor=n,e!==t&&(this._front=t),o[r]=void 0,i},e.prototype.forEach=function(e){for(var t=this._cursor,r=this._front,n=r._elements;!(t===n.length&&void 0===r._next||t===n.length&&(t=0,0===(n=(r=r._next)._elements).length));)e(n[t]),++t},e.prototype.peek=function(){var e=this._front,t=this._cursor;return e._elements[t]},e}();function me(e,t,r){var n=null;!0===r&&(n=Object.prototype);var o=Object.create(n);return o.value=e,o.done=t,o}function ve(e,t){e._forAuthorCode=!0,e._ownerReadableStream=t,t._reader=e,"readable"===t._state?ye(e):"closed"===t._state?function(e){ye(e),Se(e)}(e):we(e,t._storedError)}function be(e,t){return Pr(e._ownerReadableStream,t)}function ge(e){"readable"===e._ownerReadableStream._state?ke(e,new TypeError("Reader was released and can no longer be used to monitor the stream's closedness")):function(e,t){we(e,t)}(e,new TypeError("Reader was released and can no longer be used to monitor the stream's closedness")),e._ownerReadableStream._reader=void 0,e._ownerReadableStream=void 0}function _e(e){return new TypeError("Cannot "+e+" a stream using a released reader")}function ye(e){e._closedPromise=ie((function(t,r){e._closedPromise_resolve=t,e._closedPromise_reject=r}))}function we(e,t){ye(e),ke(e,t)}function ke(e,t){pe(e._closedPromise),e._closedPromise_reject(t),e._closedPromise_resolve=void 0,e._closedPromise_reject=void 0}function Se(e){e._closedPromise_resolve(void 0),e._closedPromise_resolve=void 0,e._closedPromise_reject=void 0}var xe=z("[[CancelSteps]]"),Re=z("[[PullSteps]]");function Ae(e,t){void 0===t&&(t=!1);var r=new Le(e);return r._forAuthorCode=t,r}function Pe(e){return ie((function(t,r){var n={_resolve:t,_reject:r};e._reader._readRequests.push(n)}))}function Ce(e,t,r){var n=e._reader;n._readRequests.shift()._resolve(me(t,r,n._forAuthorCode))}function Ee(e){return e._reader._readRequests.length}function Oe(e){var t=e._reader;return void 0!==t&&!!Me(t)}var qe,Te,Le=function(){function e(e){if(!1===Rr(e))throw new TypeError("ReadableStreamDefaultReader can only be constructed with a ReadableStream instance");if(!0===Ar(e))throw new TypeError("This stream has already been locked for exclusive reading by another reader");ve(this,e),this._readRequests=new he}return Object.defineProperty(e.prototype,"closed",{get:function(){return Me(this)?this._closedPromise:se(je("closed"))},enumerable:!0,configurable:!0}),e.prototype.cancel=function(e){return Me(this)?void 0===this._ownerReadableStream?se(_e("cancel")):be(this,e):se(je("cancel"))},e.prototype.read=function(){return Me(this)?void 0===this._ownerReadableStream?se(_e("read from")):Ie(this):se(je("read"))},e.prototype.releaseLock=function(){if(!Me(this))throw je("releaseLock");if(void 0!==this._ownerReadableStream){if(this._readRequests.length>0)throw new TypeError("Tried to release a reader lock when that reader has pending read() calls un-settled");ge(this)}},e}();function Me(e){return!!V(e)&&!!Object.prototype.hasOwnProperty.call(e,"_readRequests")}function Ie(e){var t=e._ownerReadableStream;return t._disturbed=!0,"closed"===t._state?ae(me(void 0,!0,e._forAuthorCode)):"errored"===t._state?se(t._storedError):t._readableStreamController[Re]()}function je(e){return new TypeError("ReadableStreamDefaultReader.prototype."+e+" can only be used on a ReadableStreamDefaultReader")}"symbol"==typeof z.asyncIterator&&((qe={})[z.asyncIterator]=function(){return this},Te=qe,Object.defineProperty(Te,z.asyncIterator,{enumerable:!1}));var Ne={next:function(){if(!1===Be(this))return se(Fe("next"));var e=this._asyncIteratorReader;return void 0===e._ownerReadableStream?se(_e("iterate")):fe(Ie(e),(function(t){var r=t.done;return r&&ge(e),me(t.value,r,!0)}))},return:function(e){if(!1===Be(this))return se(Fe("next"));var t=this._asyncIteratorReader;if(void 0===t._ownerReadableStream)return se(_e("finish iterating"));if(t._readRequests.length>0)return se(new TypeError("Tried to release a reader lock when that reader has pending read() calls un-settled"));if(!1===this._preventCancel){var r=be(t,e);return ge(t),fe(r,(function(){return me(e,!0,!0)}))}return ge(t),ae(me(e,!0,!0))}};function Be(e){return!!V(e)&&!!Object.prototype.hasOwnProperty.call(e,"_asyncIteratorReader")}function Fe(e){return new TypeError("ReadableStreamAsyncIterator."+e+" can only be used on a ReadableSteamAsyncIterator")}function De(e){var t=e._queue.shift();return e._queueTotalSize-=t.size,e._queueTotalSize<0&&(e._queueTotalSize=0),t.value}function ze(e,t,r){if(!K(r=Number(r)))throw new RangeError("Size must be a finite, non-NaN, non-negative number.");e._queue.push({value:t,size:r}),e._queueTotalSize+=r}function Ue(e){e._queue=new he,e._queueTotalSize=0}void 0!==Te&&Object.setPrototypeOf(Ne,Te),Object.defineProperty(Ne,"next",{enumerable:!1}),Object.defineProperty(Ne,"return",{enumerable:!1});var We=z("[[AbortSteps]]"),He=z("[[ErrorSteps]]"),Ve=function(){function e(e,t){void 0===e&&(e={}),void 0===t&&(t={}),Ke(this);var r=t.size,n=t.highWaterMark;if(void 0!==e.type)throw new RangeError("Invalid type is specified");var o=ee(r);void 0===n&&(n=1),function(e,t,r,n){var o=Object.create(ct.prototype);var i=J(t,"write",1,[o]),a=J(t,"close",0,[]),s=J(t,"abort",1,[]);ft(e,o,(function(){return X(t,"start",[o])}),i,a,s,r,n)}(this,e,n=Q(n),o)}return Object.defineProperty(e.prototype,"locked",{get:function(){if(!1===Ye(this))throw _t("locked");return Je(this)},enumerable:!0,configurable:!0}),e.prototype.abort=function(e){return!1===Ye(this)?se(_t("abort")):!0===Je(this)?se(new TypeError("Cannot abort a stream that already has a writer")):Xe(this,e)},e.prototype.close=function(){return!1===Ye(this)?se(_t("close")):!0===Je(this)?se(new TypeError("Cannot close a stream that already has a writer")):!0===tt(this)?se(new TypeError("Cannot close an already-closing stream")):Ze(this)},e.prototype.getWriter=function(){if(!1===Ye(this))throw _t("getWriter");return $e(this)},e}();function $e(e){return new ot(e)}function Ke(e){e._state="writable",e._storedError=void 0,e._writer=void 0,e._writableStreamController=void 0,e._writeRequests=new he,e._inFlightWriteRequest=void 0,e._closeRequest=void 0,e._inFlightCloseRequest=void 0,e._pendingAbortRequest=void 0,e._backpressure=!1}function Ye(e){return!!V(e)&&!!Object.prototype.hasOwnProperty.call(e,"_writableStreamController")}function Je(e){return void 0!==e._writer}function Xe(e,t){var r=e._state;if("closed"===r||"errored"===r)return ae(void 0);if(void 0!==e._pendingAbortRequest)return e._pendingAbortRequest._promise;var n=!1;"erroring"===r&&(n=!0,t=void 0);var o=ie((function(r,o){e._pendingAbortRequest={_promise:void 0,_resolve:r,_reject:o,_reason:t,_wasAlreadyErroring:n}}));return e._pendingAbortRequest._promise=o,!1===n&&Qe(e,t),o}function Ze(e){var t=e._state;if("closed"===t||"errored"===t)return se(new TypeError("The stream (in "+t+" state) is not in the writable state and cannot be closed"));var r,n=ie((function(t,r){var n={_resolve:t,_reject:r};e._closeRequest=n})),o=e._writer;return void 0!==o&&!0===e._backpressure&&"writable"===t&&Ot(o),ze(r=e._writableStreamController,"close",0),mt(r),n}function Ge(e,t){"writable"!==e._state?et(e):Qe(e,t)}function Qe(e,t){var r=e._writableStreamController;e._state="erroring",e._storedError=t;var n=e._writer;void 0!==n&&lt(n,t),!1===function(e){if(void 0===e._inFlightWriteRequest&&void 0===e._inFlightCloseRequest)return!1;return!0}(e)&&!0===r._started&&et(e)}function et(e){e._state="errored",e._writableStreamController[He]();var t=e._storedError;if(e._writeRequests.forEach((function(e){e._reject(t)})),e._writeRequests=new he,void 0!==e._pendingAbortRequest){var r=e._pendingAbortRequest;if(e._pendingAbortRequest=void 0,!0===r._wasAlreadyErroring)return r._reject(t),void rt(e);ue(e._writableStreamController[We](r._reason),(function(){r._resolve(),rt(e)}),(function(t){r._reject(t),rt(e)}))}else rt(e)}function tt(e){return void 0!==e._closeRequest||void 0!==e._inFlightCloseRequest}function rt(e){void 0!==e._closeRequest&&(e._closeRequest._reject(e._storedError),e._closeRequest=void 0);var t=e._writer;void 0!==t&&xt(t,e._storedError)}function nt(e,t){var r=e._writer;void 0!==r&&t!==e._backpressure&&(!0===t?function(e){At(e)}(r):Ot(r)),e._backpressure=t}var ot=function(){function e(e){if(!1===Ye(e))throw new TypeError("WritableStreamDefaultWriter can only be constructed with a WritableStream instance");if(!0===Je(e))throw new TypeError("This stream has already been locked for exclusive writing by another writer");this._ownerWritableStream=e,e._writer=this;var t,r=e._state;if("writable"===r)!1===tt(e)&&!0===e._backpressure?At(this):Ct(this),kt(this);else if("erroring"===r)Pt(this,e._storedError),kt(this);else if("closed"===r)Ct(this),kt(t=this),Rt(t);else{var n=e._storedError;Pt(this,n),St(this,n)}}return Object.defineProperty(e.prototype,"closed",{get:function(){return!1===it(this)?se(yt("closed")):this._closedPromise},enumerable:!0,configurable:!0}),Object.defineProperty(e.prototype,"desiredSize",{get:function(){if(!1===it(this))throw yt("desiredSize");if(void 0===this._ownerWritableStream)throw wt("desiredSize");return function(e){var t=e._ownerWritableStream,r=t._state;if("errored"===r||"erroring"===r)return null;if("closed"===r)return 0;return ht(t._writableStreamController)}(this)},enumerable:!0,configurable:!0}),Object.defineProperty(e.prototype,"ready",{get:function(){return!1===it(this)?se(yt("ready")):this._readyPromise},enumerable:!0,configurable:!0}),e.prototype.abort=function(e){return!1===it(this)?se(yt("abort")):void 0===this._ownerWritableStream?se(wt("abort")):function(e,t){return Xe(e._ownerWritableStream,t)}(this,e)},e.prototype.close=function(){if(!1===it(this))return se(yt("close"));var e=this._ownerWritableStream;return void 0===e?se(wt("close")):!0===tt(e)?se(new TypeError("Cannot close an already-closing stream")):at(this)},e.prototype.releaseLock=function(){if(!1===it(this))throw yt("releaseLock");void 0!==this._ownerWritableStream&&ut(this)},e.prototype.write=function(e){return!1===it(this)?se(yt("write")):void 0===this._ownerWritableStream?se(wt("write to")):dt(this,e)},e}();function it(e){return!!V(e)&&!!Object.prototype.hasOwnProperty.call(e,"_ownerWritableStream")}function at(e){return Ze(e._ownerWritableStream)}function st(e,t){"pending"===e._closedPromiseState?xt(e,t):function(e,t){St(e,t)}(e,t)}function lt(e,t){"pending"===e._readyPromiseState?Et(e,t):function(e,t){Pt(e,t)}(e,t)}function ut(e){var t=e._ownerWritableStream,r=new TypeError("Writer was released and can no longer be used to monitor the stream's closedness");lt(e,r),st(e,r),t._writer=void 0,e._ownerWritableStream=void 0}function dt(e,t){var r=e._ownerWritableStream,n=r._writableStreamController,o=function(e,t){try{return e._strategySizeAlgorithm(t)}catch(t){return vt(e,t),1}}(n,t);if(r!==e._ownerWritableStream)return se(wt("write to"));var i=r._state;if("errored"===i)return se(r._storedError);if(!0===tt(r)||"closed"===i)return se(new TypeError("The stream is closing or closed and cannot be written to"));if("erroring"===i)return se(r._storedError);var a=function(e){return ie((function(t,r){var n={_resolve:t,_reject:r};e._writeRequests.push(n)}))}(r);return function(e,t,r){var n={chunk:t};try{ze(e,n,r)}catch(t){return void vt(e,t)}var o=e._controlledWritableStream;if(!1===tt(o)&&"writable"===o._state){var i=bt(e);nt(o,i)}mt(e)}(n,t,o),a}var ct=function(){function e(){throw new TypeError("WritableStreamDefaultController cannot be constructed explicitly")}return e.prototype.error=function(e){if(!1===function(e){if(!V(e))return!1;if(!Object.prototype.hasOwnProperty.call(e,"_controlledWritableStream"))return!1;return!0}(this))throw new TypeError("WritableStreamDefaultController.prototype.error can only be used on a WritableStreamDefaultController");"writable"===this._controlledWritableStream._state&&gt(this,e)},e.prototype[We]=function(e){var t=this._abortAlgorithm(e);return pt(this),t},e.prototype[He]=function(){Ue(this)},e}();function ft(e,t,r,n,o,i,a,s){t._controlledWritableStream=e,e._writableStreamController=t,t._queue=void 0,t._queueTotalSize=void 0,Ue(t),t._started=!1,t._strategySizeAlgorithm=s,t._strategyHWM=a,t._writeAlgorithm=n,t._closeAlgorithm=o,t._abortAlgorithm=i;var l=bt(t);nt(e,l),ue(ae(r()),(function(){t._started=!0,mt(t)}),(function(r){t._started=!0,Ge(e,r)}))}function pt(e){e._writeAlgorithm=void 0,e._closeAlgorithm=void 0,e._abortAlgorithm=void 0,e._strategySizeAlgorithm=void 0}function ht(e){return e._strategyHWM-e._queueTotalSize}function mt(e){var t=e._controlledWritableStream;if(!1!==e._started&&void 0===t._inFlightWriteRequest)if("erroring"!==t._state){if(0!==e._queue.length){var r=e._queue.peek().value;"close"===r?function(e){var t=e._controlledWritableStream;(function(e){e._inFlightCloseRequest=e._closeRequest,e._closeRequest=void 0})(t),De(e);var r=e._closeAlgorithm();pt(e),ue(r,(function(){!function(e){e._inFlightCloseRequest._resolve(void 0),e._inFlightCloseRequest=void 0,"erroring"===e._state&&(e._storedError=void 0,void 0!==e._pendingAbortRequest&&(e._pendingAbortRequest._resolve(),e._pendingAbortRequest=void 0)),e._state="closed";var t=e._writer;void 0!==t&&Rt(t)}(t)}),(function(e){!function(e,t){e._inFlightCloseRequest._reject(t),e._inFlightCloseRequest=void 0,void 0!==e._pendingAbortRequest&&(e._pendingAbortRequest._reject(t),e._pendingAbortRequest=void 0),Ge(e,t)}(t,e)}))}(e):function(e,t){var r=e._controlledWritableStream;(function(e){e._inFlightWriteRequest=e._writeRequests.shift()})(r),ue(e._writeAlgorithm(t),(function(){!function(e){e._inFlightWriteRequest._resolve(void 0),e._inFlightWriteRequest=void 0}(r);var t=r._state;if(De(e),!1===tt(r)&&"writable"===t){var n=bt(e);nt(r,n)}mt(e)}),(function(t){"writable"===r._state&&pt(e),function(e,t){e._inFlightWriteRequest._reject(t),e._inFlightWriteRequest=void 0,Ge(e,t)}(r,t)}))}(e,r.chunk)}}else et(t)}function vt(e,t){"writable"===e._controlledWritableStream._state&&gt(e,t)}function bt(e){return ht(e)<=0}function gt(e,t){var r=e._controlledWritableStream;pt(e),Qe(r,t)}function _t(e){return new TypeError("WritableStream.prototype."+e+" can only be used on a WritableStream")}function yt(e){return new TypeError("WritableStreamDefaultWriter.prototype."+e+" can only be used on a WritableStreamDefaultWriter")}function wt(e){return new TypeError("Cannot "+e+" a stream using a released writer")}function kt(e){e._closedPromise=ie((function(t,r){e._closedPromise_resolve=t,e._closedPromise_reject=r,e._closedPromiseState="pending"}))}function St(e,t){kt(e),xt(e,t)}function xt(e,t){pe(e._closedPromise),e._closedPromise_reject(t),e._closedPromise_resolve=void 0,e._closedPromise_reject=void 0,e._closedPromiseState="rejected"}function Rt(e){e._closedPromise_resolve(void 0),e._closedPromise_resolve=void 0,e._closedPromise_reject=void 0,e._closedPromiseState="resolved"}function At(e){e._readyPromise=ie((function(t,r){e._readyPromise_resolve=t,e._readyPromise_reject=r})),e._readyPromiseState="pending"}function Pt(e,t){At(e),Et(e,t)}function Ct(e){At(e),Ot(e)}function Et(e,t){pe(e._readyPromise),e._readyPromise_reject(t),e._readyPromise_resolve=void 0,e._readyPromise_reject=void 0,e._readyPromiseState="rejected"}function Ot(e){e._readyPromise_resolve(void 0),e._readyPromise_resolve=void 0,e._readyPromise_reject=void 0,e._readyPromiseState="fulfilled"}function qt(e){if("object"!=typeof e||null===e)return!1;try{return"boolean"==typeof e.aborted}catch(e){return!1}}var Tt="undefined"!=typeof DOMException?DOMException:void 0;var Lt,Mt=function(e){if("function"!=typeof e&&"object"!=typeof e)return!1;try{return new e,!0}catch(e){return!1}}(Tt)?Tt:((Lt=function(e,t){this.message=e||"",this.name=t||"Error",Error.captureStackTrace&&Error.captureStackTrace(this,this.constructor)}).prototype=Object.create(Error.prototype),Object.defineProperty(Lt.prototype,"constructor",{value:Lt,writable:!0,configurable:!0}),Lt);function It(e,t,r,n,o,i){var a=Ae(e),s=$e(t);e._disturbed=!0;var l=!1,u=ae(void 0);return ie((function(d,c){var f,p,h,m;if(void 0!==i){if(f=function(){var r=new Mt("Aborted","AbortError"),i=[];!1===n&&i.push((function(){return"writable"===t._state?Xe(t,r):ae(void 0)})),!1===o&&i.push((function(){return"readable"===e._state?Pr(e,r):ae(void 0)})),_((function(){return Promise.all(i.map((function(e){return e()})))}),!0,r)},!0===i.aborted)return void f();i.addEventListener("abort",f)}if(g(e,a._closedPromise,(function(e){!1===n?_((function(){return Xe(t,e)}),!0,e):y(!0,e)})),g(t,s._closedPromise,(function(t){!1===o?_((function(){return Pr(e,t)}),!0,t):y(!0,t)})),p=e,h=a._closedPromise,m=function(){!1===r?_((function(){return function(e){var t=e._ownerWritableStream,r=t._state;return!0===tt(t)||"closed"===r?ae(void 0):"errored"===r?se(t._storedError):at(e)}(s)})):y()},"closed"===p._state?m():de(h,m),!0===tt(t)||"closed"===t._state){var v=new TypeError("the destination writable stream closed before all data could be piped to it");!1===o?_((function(){return Pr(e,v)}),!0,v):y(!0,v)}function b(){var e=u;return le(u,(function(){return e!==u?b():void 0}))}function g(e,t,r){"errored"===e._state?r(e._storedError):ce(t,r)}function _(e,r,n){function o(){ue(e(),(function(){return w(r,n)}),(function(e){return w(!0,e)}))}!0!==l&&(l=!0,"writable"===t._state&&!1===tt(t)?de(b(),o):o())}function y(e,r){!0!==l&&(l=!0,"writable"===t._state&&!1===tt(t)?de(b(),(function(){return w(e,r)})):w(e,r))}function w(e,t){ut(s),ge(a),void 0!==i&&i.removeEventListener("abort",f),e?c(t):d(void 0)}pe(ie((function(e,t){!function r(n){n?e():le(!0===l?ae(!0):le(s._readyPromise,(function(){return le(Ie(a),(function(e){return!0===e.done||(u=le(dt(s,e.value),void 0,U),!1)}))})),r,t)}(!1)})))}))}var jt=function(){function e(){throw new TypeError}return Object.defineProperty(e.prototype,"desiredSize",{get:function(){if(!1===Nt(this))throw Kt("desiredSize");return Ht(this)},enumerable:!0,configurable:!0}),e.prototype.close=function(){if(!1===Nt(this))throw Kt("close");if(!1===Vt(this))throw new TypeError("The stream is not in a state that permits close");zt(this)},e.prototype.enqueue=function(e){if(!1===Nt(this))throw Kt("enqueue");if(!1===Vt(this))throw new TypeError("The stream is not in a state that permits enqueue");return Ut(this,e)},e.prototype.error=function(e){if(!1===Nt(this))throw Kt("error");Wt(this,e)},e.prototype[xe]=function(e){Ue(this);var t=this._cancelAlgorithm(e);return Dt(this),t},e.prototype[Re]=function(){var e=this._controlledReadableStream;if(this._queue.length>0){var t=De(this);return!0===this._closeRequested&&0===this._queue.length?(Dt(this),Cr(e)):Bt(this),ae(me(t,!1,e._reader._forAuthorCode))}var r=Pe(e);return Bt(this),r},e}();function Nt(e){return!!V(e)&&!!Object.prototype.hasOwnProperty.call(e,"_controlledReadableStream")}function Bt(e){!1!==Ft(e)&&(!0!==e._pulling?(e._pulling=!0,ue(e._pullAlgorithm(),(function(){e._pulling=!1,!0===e._pullAgain&&(e._pullAgain=!1,Bt(e))}),(function(t){Wt(e,t)}))):e._pullAgain=!0)}function Ft(e){var t=e._controlledReadableStream;return!1!==Vt(e)&&(!1!==e._started&&(!0===Ar(t)&&Ee(t)>0||Ht(e)>0))}function Dt(e){e._pullAlgorithm=void 0,e._cancelAlgorithm=void 0,e._strategySizeAlgorithm=void 0}function zt(e){var t=e._controlledReadableStream;e._closeRequested=!0,0===e._queue.length&&(Dt(e),Cr(t))}function Ut(e,t){var r=e._controlledReadableStream;if(!0===Ar(r)&&Ee(r)>0)Ce(r,t,!1);else{var n=void 0;try{n=e._strategySizeAlgorithm(t)}catch(t){throw Wt(e,t),t}try{ze(e,t,n)}catch(t){throw Wt(e,t),t}}Bt(e)}function Wt(e,t){var r=e._controlledReadableStream;"readable"===r._state&&(Ue(e),Dt(e),Er(r,t))}function Ht(e){var t=e._controlledReadableStream._state;return"errored"===t?null:"closed"===t?0:e._strategyHWM-e._queueTotalSize}function Vt(e){var t=e._controlledReadableStream._state;return!1===e._closeRequested&&"readable"===t}function $t(e,t,r,n,o,i,a){t._controlledReadableStream=e,t._queue=void 0,t._queueTotalSize=void 0,Ue(t),t._started=!1,t._closeRequested=!1,t._pullAgain=!1,t._pulling=!1,t._strategySizeAlgorithm=a,t._strategyHWM=i,t._pullAlgorithm=n,t._cancelAlgorithm=o,e._readableStreamController=t,ue(ae(r()),(function(){t._started=!0,Bt(t)}),(function(e){Wt(t,e)}))}function Kt(e){return new TypeError("ReadableStreamDefaultController.prototype."+e+" can only be used on a ReadableStreamDefaultController")}var Yt=Number.isInteger||function(e){return"number"==typeof e&&isFinite(e)&&Math.floor(e)===e},Jt=function(){function e(){throw new TypeError("ReadableStreamBYOBRequest cannot be used directly")}return Object.defineProperty(e.prototype,"view",{get:function(){if(!1===Gt(this))throw hr("view");return this._view},enumerable:!0,configurable:!0}),e.prototype.respond=function(e){if(!1===Gt(this))throw hr("respond");if(void 0===this._associatedReadableByteStreamController)throw new TypeError("This BYOB request has been invalidated");this._view.buffer,function(e,t){if(!1===K(t=Number(t)))throw new RangeError("bytesWritten must be a finite");lr(e,t)}(this._associatedReadableByteStreamController,e)},e.prototype.respondWithNewView=function(e){if(!1===Gt(this))throw hr("respond");if(void 0===this._associatedReadableByteStreamController)throw new TypeError("This BYOB request has been invalidated");if(!ArrayBuffer.isView(e))throw new TypeError("You can only respond with array buffer views");e.buffer,function(e,t){var r=e._pendingPullIntos.peek();if(r.byteOffset+r.bytesFilled!==t.byteOffset)throw new RangeError("The region specified by view does not match byobRequest");if(r.byteLength!==t.byteLength)throw new RangeError("The buffer of view has different capacity than byobRequest");r.buffer=t.buffer,lr(e,t.byteLength)}(this._associatedReadableByteStreamController,e)},e}(),Xt=function(){function e(){throw new TypeError("ReadableByteStreamController constructor cannot be used directly")}return Object.defineProperty(e.prototype,"byobRequest",{get:function(){if(!1===Zt(this))throw mr("byobRequest");if(void 0===this._byobRequest&&this._pendingPullIntos.length>0){var e=this._pendingPullIntos.peek(),t=new Uint8Array(e.buffer,e.byteOffset+e.bytesFilled,e.byteLength-e.bytesFilled),r=Object.create(Jt.prototype);!function(e,t,r){e._associatedReadableByteStreamController=t,e._view=r}(r,this,t),this._byobRequest=r}return this._byobRequest},enumerable:!0,configurable:!0}),Object.defineProperty(e.prototype,"desiredSize",{get:function(){if(!1===Zt(this))throw mr("desiredSize");return fr(this)},enumerable:!0,configurable:!0}),e.prototype.close=function(){if(!1===Zt(this))throw mr("close");if(!0===this._closeRequested)throw new TypeError("The stream has already been closed; do not close it again!");var e=this._controlledReadableByteStream._state;if("readable"!==e)throw new TypeError("The stream (in "+e+" state) is not in the readable state and cannot be closed");!function(e){var t=e._controlledReadableByteStream;if(e._queueTotalSize>0)return void(e._closeRequested=!0);if(e._pendingPullIntos.length>0){if(e._pendingPullIntos.peek().bytesFilled>0){var r=new TypeError("Insufficient bytes to fill elements in the given buffer");throw cr(e,r),r}}dr(e),Cr(t)}(this)},e.prototype.enqueue=function(e){if(!1===Zt(this))throw mr("enqueue");if(!0===this._closeRequested)throw new TypeError("stream is closed or draining");var t=this._controlledReadableByteStream._state;if("readable"!==t)throw new TypeError("The stream (in "+t+" state) is not in the readable state and cannot be enqueued to");if(!ArrayBuffer.isView(e))throw new TypeError("You can only enqueue array buffer views when using a ReadableByteStreamController");e.buffer,function(e,t){var r=e._controlledReadableByteStream,n=t.buffer,o=t.byteOffset,i=t.byteLength,a=G(n);if(!0===Oe(r))if(0===Ee(r))rr(e,a,o,i);else{var s=new Uint8Array(a,o,i);Ce(r,s,!1)}else!0===gr(r)?(rr(e,a,o,i),sr(e)):rr(e,a,o,i);Qt(e)}(this,e)},e.prototype.error=function(e){if(!1===Zt(this))throw mr("error");cr(this,e)},e.prototype[xe]=function(e){this._pendingPullIntos.length>0&&(this._pendingPullIntos.peek().bytesFilled=0);Ue(this);var t=this._cancelAlgorithm(e);return dr(this),t},e.prototype[Re]=function(){var e=this._controlledReadableByteStream;if(this._queueTotalSize>0){var t=this._queue.shift();this._queueTotalSize-=t.byteLength,ir(this);var r=void 0;try{r=new Uint8Array(t.buffer,t.byteOffset,t.byteLength)}catch(e){return se(e)}return ae(me(r,!1,e._reader._forAuthorCode))}var n=this._autoAllocateChunkSize;if(void 0!==n){var o=void 0;try{o=new ArrayBuffer(n)}catch(e){return se(e)}var i={buffer:o,byteOffset:0,byteLength:n,bytesFilled:0,elementSize:1,ctor:Uint8Array,readerType:"default"};this._pendingPullIntos.push(i)}var a=Pe(e);return Qt(this),a},e}();function Zt(e){return!!V(e)&&!!Object.prototype.hasOwnProperty.call(e,"_controlledReadableByteStream")}function Gt(e){return!!V(e)&&!!Object.prototype.hasOwnProperty.call(e,"_associatedReadableByteStreamController")}function Qt(e){!1!==function(e){var t=e._controlledReadableByteStream;if("readable"!==t._state)return!1;if(!0===e._closeRequested)return!1;if(!1===e._started)return!1;if(!0===Oe(t)&&Ee(t)>0)return!0;if(!0===gr(t)&&br(t)>0)return!0;if(fr(e)>0)return!0;return!1}(e)&&(!0!==e._pulling?(e._pulling=!0,ue(e._pullAlgorithm(),(function(){e._pulling=!1,!0===e._pullAgain&&(e._pullAgain=!1,Qt(e))}),(function(t){cr(e,t)}))):e._pullAgain=!0)}function er(e,t){var r=!1;"closed"===e._state&&(r=!0);var n=tr(t);"default"===t.readerType?Ce(e,n,r):function(e,t,r){var n=e._reader;n._readIntoRequests.shift()._resolve(me(t,r,n._forAuthorCode))}(e,n,r)}function tr(e){var t=e.bytesFilled,r=e.elementSize;return new e.ctor(e.buffer,e.byteOffset,t/r)}function rr(e,t,r,n){e._queue.push({buffer:t,byteOffset:r,byteLength:n}),e._queueTotalSize+=n}function nr(e,t){var r=t.elementSize,n=t.bytesFilled-t.bytesFilled%r,o=Math.min(e._queueTotalSize,t.byteLength-t.bytesFilled),i=t.bytesFilled+o,a=i-i%r,s=o,l=!1;a>n&&(s=a-t.bytesFilled,l=!0);for(var u,d,c,f,p,h=e._queue;s>0;){var m=h.peek(),v=Math.min(s,m.byteLength),b=t.byteOffset+t.bytesFilled;u=t.buffer,d=b,c=m.buffer,f=m.byteOffset,p=v,new Uint8Array(u).set(new Uint8Array(c,f,p),d),m.byteLength===v?h.shift():(m.byteOffset+=v,m.byteLength-=v),e._queueTotalSize-=v,or(e,v,t),s-=v}return l}function or(e,t,r){ar(e),r.bytesFilled+=t}function ir(e){0===e._queueTotalSize&&!0===e._closeRequested?(dr(e),Cr(e._controlledReadableByteStream)):Qt(e)}function ar(e){void 0!==e._byobRequest&&(e._byobRequest._associatedReadableByteStreamController=void 0,e._byobRequest._view=void 0,e._byobRequest=void 0)}function sr(e){for(;e._pendingPullIntos.length>0;){if(0===e._queueTotalSize)return;var t=e._pendingPullIntos.peek();!0===nr(e,t)&&(ur(e),er(e._controlledReadableByteStream,t))}}function lr(e,t){var r=e._pendingPullIntos.peek();if("closed"===e._controlledReadableByteStream._state){if(0!==t)throw new TypeError("bytesWritten must be 0 when calling respond() on a closed stream");!function(e,t){t.buffer=G(t.buffer);var r=e._controlledReadableByteStream;if(!0===gr(r))for(;br(r)>0;){er(r,ur(e))}}(e,r)}else!function(e,t,r){if(r.bytesFilled+t>r.byteLength)throw new RangeError("bytesWritten out of range");if(or(e,t,r),!(r.bytesFilled<r.elementSize)){ur(e);var n=r.bytesFilled%r.elementSize;if(n>0){var o=r.byteOffset+r.bytesFilled,i=r.buffer.slice(o-n,o);rr(e,i,0,i.byteLength)}r.buffer=G(r.buffer),r.bytesFilled-=n,er(e._controlledReadableByteStream,r),sr(e)}}(e,t,r);Qt(e)}function ur(e){var t=e._pendingPullIntos.shift();return ar(e),t}function dr(e){e._pullAlgorithm=void 0,e._cancelAlgorithm=void 0}function cr(e,t){var r=e._controlledReadableByteStream;"readable"===r._state&&(!function(e){ar(e),e._pendingPullIntos=new he}(e),Ue(e),dr(e),Er(r,t))}function fr(e){var t=e._controlledReadableByteStream._state;return"errored"===t?null:"closed"===t?0:e._strategyHWM-e._queueTotalSize}function pr(e,t,r){var n=Object.create(Xt.prototype);var o=J(t,"pull",0,[n]),i=J(t,"cancel",1,[]),a=t.autoAllocateChunkSize;if(void 0!==a&&(a=Number(a),!1===Yt(a)||a<=0))throw new RangeError("autoAllocateChunkSize must be a positive integer");!function(e,t,r,n,o,i,a){t._controlledReadableByteStream=e,t._pullAgain=!1,t._pulling=!1,t._byobRequest=void 0,t._queue=t._queueTotalSize=void 0,Ue(t),t._closeRequested=!1,t._started=!1,t._strategyHWM=Q(i),t._pullAlgorithm=n,t._cancelAlgorithm=o,t._autoAllocateChunkSize=a,t._pendingPullIntos=new he,e._readableStreamController=t,ue(ae(r()),(function(){t._started=!0,Qt(t)}),(function(e){cr(t,e)}))}(e,n,(function(){return X(t,"start",[n])}),o,i,r,a)}function hr(e){return new TypeError("ReadableStreamBYOBRequest.prototype."+e+" can only be used on a ReadableStreamBYOBRequest")}function mr(e){return new TypeError("ReadableByteStreamController.prototype."+e+" can only be used on a ReadableByteStreamController")}function vr(e){return ie((function(t,r){var n={_resolve:t,_reject:r};e._reader._readIntoRequests.push(n)}))}function br(e){return e._reader._readIntoRequests.length}function gr(e){var t=e._reader;return void 0!==t&&!!yr(t)}var _r=function(){function e(e){if(!Rr(e))throw new TypeError("ReadableStreamBYOBReader can only be constructed with a ReadableStream instance given a byte source");if(!1===Zt(e._readableStreamController))throw new TypeError("Cannot construct a ReadableStreamBYOBReader for a stream not constructed with a byte source");if(Ar(e))throw new TypeError("This stream has already been locked for exclusive reading by another reader");ve(this,e),this._readIntoRequests=new he}return Object.defineProperty(e.prototype,"closed",{get:function(){return yr(this)?this._closedPromise:se(wr("closed"))},enumerable:!0,configurable:!0}),e.prototype.cancel=function(e){return yr(this)?void 0===this._ownerReadableStream?se(_e("cancel")):be(this,e):se(wr("cancel"))},e.prototype.read=function(e){return yr(this)?void 0===this._ownerReadableStream?se(_e("read from")):ArrayBuffer.isView(e)?(e.buffer,0===e.byteLength?se(new TypeError("view must have non-zero byteLength")):function(e,t){var r=e._ownerReadableStream;if(r._disturbed=!0,"errored"===r._state)return se(r._storedError);return function(e,t){var r=e._controlledReadableByteStream,n=1;t.constructor!==DataView&&(n=t.constructor.BYTES_PER_ELEMENT);var o=t.constructor,i={buffer:G(t.buffer),byteOffset:t.byteOffset,byteLength:t.byteLength,bytesFilled:0,elementSize:n,ctor:o,readerType:"byob"};if(e._pendingPullIntos.length>0)return e._pendingPullIntos.push(i),vr(r);if("closed"===r._state)return ae(me(new o(i.buffer,i.byteOffset,0),!0,r._reader._forAuthorCode));if(e._queueTotalSize>0){if(!0===nr(e,i)){var a=tr(i);return ir(e),ae(me(a,!1,r._reader._forAuthorCode))}if(!0===e._closeRequested){var s=new TypeError("Insufficient bytes to fill elements in the given buffer");return cr(e,s),se(s)}}e._pendingPullIntos.push(i);var l=vr(r);return Qt(e),l}(r._readableStreamController,t)}(this,e)):se(new TypeError("view must be an array buffer view")):se(wr("read"))},e.prototype.releaseLock=function(){if(!yr(this))throw wr("releaseLock");if(void 0!==this._ownerReadableStream){if(this._readIntoRequests.length>0)throw new TypeError("Tried to release a reader lock when that reader has pending read() calls un-settled");ge(this)}},e}();function yr(e){return!!V(e)&&!!Object.prototype.hasOwnProperty.call(e,"_readIntoRequests")}function wr(e){return new TypeError("ReadableStreamBYOBReader.prototype."+e+" can only be used on a ReadableStreamBYOBReader")}var kr=function(){function e(e,t){void 0===e&&(e={}),void 0===t&&(t={}),xr(this);var r=t.size,n=t.highWaterMark,o=e.type;if("bytes"===String(o)){if(void 0!==r)throw new RangeError("The strategy for a byte stream cannot have a size function");void 0===n&&(n=0),pr(this,e,n=Q(n))}else{if(void 0!==o)throw new RangeError("Invalid type is specified");var i=ee(r);void 0===n&&(n=1),function(e,t,r,n){var o=Object.create(jt.prototype),i=J(t,"pull",0,[o]),a=J(t,"cancel",1,[]);$t(e,o,(function(){return X(t,"start",[o])}),i,a,r,n)}(this,e,n=Q(n),i)}}return Object.defineProperty(e.prototype,"locked",{get:function(){if(!1===Rr(this))throw Or("locked");return Ar(this)},enumerable:!0,configurable:!0}),e.prototype.cancel=function(e){return!1===Rr(this)?se(Or("cancel")):!0===Ar(this)?se(new TypeError("Cannot cancel a stream that already has a reader")):Pr(this,e)},e.prototype.getReader=function(e){var t=(void 0===e?{}:e).mode;if(!1===Rr(this))throw Or("getReader");if(void 0===t)return Ae(this,!0);if("byob"===(t=String(t)))return function(e,t){void 0===t&&(t=!1);var r=new _r(e);return r._forAuthorCode=t,r}(this,!0);throw new RangeError("Invalid mode is specified")},e.prototype.pipeThrough=function(e,t){var r=e.writable,n=e.readable,o=void 0===t?{}:t,i=o.preventClose,a=o.preventAbort,s=o.preventCancel,l=o.signal;if(!1===Rr(this))throw Or("pipeThrough");if(!1===Ye(r))throw new TypeError("writable argument to pipeThrough must be a WritableStream");if(!1===Rr(n))throw new TypeError("readable argument to pipeThrough must be a ReadableStream");if(i=Boolean(i),a=Boolean(a),s=Boolean(s),void 0!==l&&!qt(l))throw new TypeError("ReadableStream.prototype.pipeThrough's signal option must be an AbortSignal");if(!0===Ar(this))throw new TypeError("ReadableStream.prototype.pipeThrough cannot be used on a locked ReadableStream");if(!0===Je(r))throw new TypeError("ReadableStream.prototype.pipeThrough cannot be used on a locked WritableStream");return pe(It(this,r,i,a,s,l)),n},e.prototype.pipeTo=function(e,t){var r=void 0===t?{}:t,n=r.preventClose,o=r.preventAbort,i=r.preventCancel,a=r.signal;return!1===Rr(this)?se(Or("pipeTo")):!1===Ye(e)?se(new TypeError("ReadableStream.prototype.pipeTo's first argument must be a WritableStream")):(n=Boolean(n),o=Boolean(o),i=Boolean(i),void 0===a||qt(a)?!0===Ar(this)?se(new TypeError("ReadableStream.prototype.pipeTo cannot be used on a locked ReadableStream")):!0===Je(e)?se(new TypeError("ReadableStream.prototype.pipeTo cannot be used on a locked WritableStream")):It(this,e,n,o,i,a):se(new TypeError("ReadableStream.prototype.pipeTo's signal option must be an AbortSignal")))},e.prototype.tee=function(){if(!1===Rr(this))throw Or("tee");var e=function(e,t){var r,n,o,i,a,s=Ae(e),l=!1,u=!1,d=!1,c=ie((function(e){a=e}));function f(){return!0===l?ae(void 0):(l=!0,pe(fe(Ie(s),(function(e){if(l=!1,!0===e.done)return!1===u&&zt(o._readableStreamController),void(!1===d&&zt(i._readableStreamController));var t=e.value,r=t,n=t;!1===u&&Ut(o._readableStreamController,r),!1===d&&Ut(i._readableStreamController,n)}))),ae(void 0))}function p(){}return o=Sr(p,f,(function(t){if(u=!0,r=t,!0===d){var o=$([r,n]),i=Pr(e,o);a(i)}return c})),i=Sr(p,f,(function(t){if(d=!0,n=t,!0===u){var o=$([r,n]),i=Pr(e,o);a(i)}return c})),ce(s._closedPromise,(function(e){Wt(o._readableStreamController,e),Wt(i._readableStreamController,e)})),[o,i]}(this);return $(e)},e.prototype.getIterator=function(e){var t=(void 0===e?{}:e).preventCancel,r=void 0!==t&&t;if(!1===Rr(this))throw Or("getIterator");return function(e,t){void 0===t&&(t=!1);var r=Ae(e),n=Object.create(Ne);return n._asyncIteratorReader=r,n._preventCancel=Boolean(t),n}(this,r)},e}();function Sr(e,t,r,n,o){void 0===n&&(n=1),void 0===o&&(o=function(){return 1});var i=Object.create(kr.prototype);return xr(i),$t(i,Object.create(jt.prototype),e,t,r,n,o),i}function xr(e){e._state="readable",e._reader=void 0,e._storedError=void 0,e._disturbed=!1}function Rr(e){return!!V(e)&&!!Object.prototype.hasOwnProperty.call(e,"_readableStreamController")}function Ar(e){return void 0!==e._reader}function Pr(e,t){return e._disturbed=!0,"closed"===e._state?ae(void 0):"errored"===e._state?se(e._storedError):(Cr(e),fe(e._readableStreamController[xe](t),U))}function Cr(e){e._state="closed";var t=e._reader;void 0!==t&&(Me(t)&&(t._readRequests.forEach((function(e){e._resolve(me(void 0,!0,t._forAuthorCode))})),t._readRequests=new he),Se(t))}function Er(e,t){e._state="errored",e._storedError=t;var r=e._reader;void 0!==r&&(Me(r)?(r._readRequests.forEach((function(e){e._reject(t)})),r._readRequests=new he):(r._readIntoRequests.forEach((function(e){e._reject(t)})),r._readIntoRequests=new he),ke(r,t))}function Or(e){return new TypeError("ReadableStream.prototype."+e+" can only be used on a ReadableStream")}"symbol"==typeof z.asyncIterator&&Object.defineProperty(kr.prototype,z.asyncIterator,{value:kr.prototype.getIterator,enumerable:!1,writable:!0,configurable:!0});(function(){function e(e){var t=e.highWaterMark;this.highWaterMark=t}e.prototype.size=function(e){return e.byteLength}})(),function(){function e(e){var t=e.highWaterMark;this.highWaterMark=t}e.prototype.size=function(){return 1}}(),function(){function e(e,t,r){void 0===e&&(e={}),void 0===t&&(t={}),void 0===r&&(r={});var n=t.size,o=t.highWaterMark,i=r.size,a=r.highWaterMark;if(void 0!==e.writableType)throw new RangeError("Invalid writable type specified");var s=ee(n);if(void 0===o&&(o=1),o=Q(o),void 0!==e.readableType)throw new RangeError("Invalid readable type specified");var l,u=ee(i);void 0===a&&(a=0),a=Q(a),function(e,t,r,n,o,i){function a(){return t}e._writable=function(e,t,r,n,o,i){void 0===o&&(o=1),void 0===i&&(i=function(){return 1});var a=Object.create(Ve.prototype);return Ke(a),ft(a,Object.create(ct.prototype),e,t,r,n,o,i),a}(a,(function(t){return function(e,t){var r=e._transformStreamController;if(!0===e._backpressure){return fe(e._backpressureChangePromise,(function(){var n=e._writable;if("erroring"===n._state)throw n._storedError;return Fr(r,t)}))}return Fr(r,t)}(e,t)}),(function(){return function(e){var t=e._readable,r=e._transformStreamController,n=r._flushAlgorithm();return Nr(r),fe(n,(function(){if("errored"===t._state)throw t._storedError;var e=t._readableStreamController;!0===Vt(e)&&zt(e)}),(function(r){throw Tr(e,r),t._storedError}))}(e)}),(function(t){return function(e,t){return Tr(e,t),ae(void 0)}(e,t)}),r,n),e._readable=Sr(a,(function(){return function(e){return Mr(e,!1),e._backpressureChangePromise}(e)}),(function(t){return Lr(e,t),ae(void 0)}),o,i),e._backpressure=void 0,e._backpressureChangePromise=void 0,e._backpressureChangePromise_resolve=void 0,Mr(e,!0),e._transformStreamController=void 0}(this,ie((function(e){l=e})),o,s,a,u),function(e,t){var r=Object.create(Ir.prototype),n=function(e){try{return Br(r,e),ae(void 0)}catch(e){return se(e)}},o=t.transform;if(void 0!==o){if("function"!=typeof o)throw new TypeError("transform is not a method");n=function(e){return Z(o,t,[e,r])}}var i=J(t,"flush",0,[r]);!function(e,t,r,n){t._controlledTransformStream=e,e._transformStreamController=t,t._transformAlgorithm=r,t._flushAlgorithm=n}(e,r,n,i)}(this,e);var d=X(e,"start",[this._transformStreamController]);l(d)}Object.defineProperty(e.prototype,"readable",{get:function(){if(!1===qr(this))throw zr("readable");return this._readable},enumerable:!0,configurable:!0}),Object.defineProperty(e.prototype,"writable",{get:function(){if(!1===qr(this))throw zr("writable");return this._writable},enumerable:!0,configurable:!0})}();function qr(e){return!!V(e)&&!!Object.prototype.hasOwnProperty.call(e,"_transformStreamController")}function Tr(e,t){Wt(e._readable._readableStreamController,t),Lr(e,t)}function Lr(e,t){Nr(e._transformStreamController),vt(e._writable._writableStreamController,t),!0===e._backpressure&&Mr(e,!1)}function Mr(e,t){void 0!==e._backpressureChangePromise&&e._backpressureChangePromise_resolve(),e._backpressureChangePromise=ie((function(t){e._backpressureChangePromise_resolve=t})),e._backpressure=t}var Ir=function(){function e(){throw new TypeError("TransformStreamDefaultController instances cannot be created directly")}return Object.defineProperty(e.prototype,"desiredSize",{get:function(){if(!1===jr(this))throw Dr("desiredSize");return Ht(this._controlledTransformStream._readable._readableStreamController)},enumerable:!0,configurable:!0}),e.prototype.enqueue=function(e){if(!1===jr(this))throw Dr("enqueue");Br(this,e)},e.prototype.error=function(e){if(!1===jr(this))throw Dr("error");!function(e,t){Tr(e._controlledTransformStream,t)}(this,e)},e.prototype.terminate=function(){if(!1===jr(this))throw Dr("terminate");!function(e){var t=e._controlledTransformStream,r=t._readable._readableStreamController;!0===Vt(r)&&zt(r);var n=new TypeError("TransformStream terminated");Lr(t,n)}(this)},e}();function jr(e){return!!V(e)&&!!Object.prototype.hasOwnProperty.call(e,"_controlledTransformStream")}function Nr(e){e._transformAlgorithm=void 0,e._flushAlgorithm=void 0}function Br(e,t){var r=e._controlledTransformStream,n=r._readable._readableStreamController;if(!1===Vt(n))throw new TypeError("Readable side is not in a state that permits enqueue");try{Ut(n,t)}catch(e){throw Lr(r,e),r._readable._storedError}(function(e){return!0!==Ft(e)})(n)!==r._backpressure&&Mr(r,!0)}function Fr(e,t){return fe(e._transformAlgorithm(t),void 0,(function(t){throw Tr(e._controlledTransformStream,t),t}))}function Dr(e){return new TypeError("TransformStreamDefaultController.prototype."+e+" can only be used on a TransformStreamDefaultController")}function zr(e){return new TypeError("TransformStream.prototype."+e+" can only be used on a TransformStream")}let Ur=null,Wr=!1;const Hr=window.isSecureContext;let Vr=/constructor/i.test(window.HTMLElement)||!!window.safari;const $r=Hr||"MozAppearance"in document.documentElement.style?"iframe":"navigate",Kr={createWriteStream:function(e,t,r){let n={size:null,pathname:null,writableStrategy:void 0,readableStrategy:void 0},o=0,i=null,a=null,s=null;Number.isFinite(t)?([r,t]=[t,r],n.size=r,n.writableStrategy=t):t&&t.highWaterMark?(n.size=r,n.writableStrategy=t):n=t||{};if(!Vr){Ur||(Ur=Hr?Yr(Kr.mitm):function(e){const t=document.createDocumentFragment(),r={frame:window.open(e,"popup","width=200,height=100"),loaded:!1,isIframe:!1,isPopup:!0,remove(){r.frame.close()},addEventListener(...e){t.addEventListener(...e)},dispatchEvent(...e){t.dispatchEvent(...e)},removeEventListener(...e){t.removeEventListener(...e)},postMessage(...e){r.frame.postMessage(...e)}},n=e=>{e.source===r.frame&&(r.loaded=!0,window.removeEventListener("message",n),r.dispatchEvent(new Event("load")))};return window.addEventListener("message",n),r}(Kr.mitm)),a=new MessageChannel,e=encodeURIComponent(e.replace(/\//g,":")).replace(/['()]/g,escape).replace(/\*/g,"%2A");const t={transferringReadable:Wr,pathname:n.pathname||Math.random().toString().slice(-6)+"/"+e,headers:{"Content-Type":"application/octet-stream; charset=utf-8","Content-Disposition":"attachment; filename*=UTF-8''"+e}};n.size&&(t.headers["Content-Length"]=n.size);const r=[t,"*",[a.port2]];if(Wr){const e="iframe"===$r?void 0:{transform(e,t){o+=e.length,t.enqueue(e),i&&(location.href=i,i=null)},flush(){i&&(location.href=i)}},t=(s=new Kr.TransformStream(e,n.writableStrategy,n.readableStrategy)).readable;a.port1.postMessage({readableStream:t},[t])}a.port1.onmessage=e=>{e.data.download&&("navigate"===$r?(Ur.remove(),Ur=null,o?location.href=e.data.download:i=e.data.download):(Ur.isPopup&&(Ur.remove(),"iframe"===$r&&Yr(Kr.mitm)),Yr(e.data.download)))},Ur.loaded?Ur.postMessage(...r):Ur.addEventListener("load",()=>{Ur.postMessage(...r)},{once:!0})}let l=[];return!Vr&&s&&s.writable||new Kr.WritableStream({write(e){Vr?l.push(e):(a.port1.postMessage(e),o+=e.length,i&&(location.href=i,i=null))},close(){if(Vr){const t=new Blob(l,{type:"application/octet-stream; charset=utf-8"}),r=document.createElement("a");r.href=URL.createObjectURL(t),r.download=e,document.body.appendChild(r),r.click()}else a.port1.postMessage("end")},abort(){l=[],a.port1.postMessage("abort"),a.port1.onmessage=null,a.port1.close(),a.port2.close(),a=null}},n.writableStrategy)},WritableStream:window.WritableStream?window.WritableStream:Ve,createReadableStream:function(e){return window.ReadableStream&&window.ReadableStream.prototype.pipeTo?new window.ReadableStream(e):new kr(e)},checkSupport:function(){try{!Hr||"serviceWorker"in navigator||(Vr=!0)}catch(e){Vr=!0}return!Vr},supported:!0,version:{full:"2.0.0",major:2,minor:0,dot:0},mitm:"https://sf-helper.com/static/streamSaver/mitm.html?version=2.0.0"};function Yr(e){if(!e)throw new Error("meh");const t=document.createElement("iframe");return t.hidden=!0,t.src=e,t.loaded=!1,t.name="iframe",t.isIframe=!0,t.postMessage=(...e)=>t.contentWindow.postMessage(...e),t.addEventListener("load",()=>{t.loaded=!0},{once:!0}),document.body.appendChild(t),t}try{!Hr||"serviceWorker"in navigator||(Vr=!0)}catch(e){Vr=!0}(e=>{try{e()}catch(e){}})(()=>{const{readable:e}=new TransformStream,t=new MessageChannel;t.port1.postMessage(e,[e]),t.port1.close(),t.port2.close(),Wr=!0,Object.defineProperty(Kr,"TransformStream",{configurable:!1,writable:!1,value:TransformStream})});const Jr="downloading",Xr="downloaded",Zr="error";class Gr{getUniqID(){return this.id?this.id:(this.id=Math.round(100*Math.random()),this.id)}_emit(e,t){const r=new CustomEvent(`download-stream-${e}.${this.getUniqID()}`,{detail:t});document.dispatchEvent(r)}on(e,t){document.addEventListener(`download-stream-${e}.${this.getUniqID()}`,t)}request(t,r=0){return new Promise((e,r)=>fetch(t).then(e=>(e.ok||r("Fetch chunk error"),e)).then(t=>e(t.arrayBuffer()))).catch(async n=>{if(r>=5)throw e;return await new Promise(e=>setTimeout(e,5e3)),r++,this.request(t,r)})}}class Qr extends Gr{constructor(e=[],t){super(),this.decryptInfo={iv:void 0,secret:null},this.chunkURLs=[],this.countUrls=0,this.currChunk=0,this.iv=void 0,this.secret=void 0,this.chunkURLs=e,this.countUrls=e.length,this.decryptInfo=t}async start(e){this.secret=await crypto.subtle.importKey("raw",this.decryptInfo.secret,"AES-CBC",!1,["decrypt"])}async pull(e){try{const t=this.chunkURLs.shift();if(!t)return this._emit(Xr),e.close();const r=await this.request(t),n=await this.decrypt(this.currChunk,r);e.enqueue(new Uint8Array(n,0,n.byteLength));const o=this.countUrls/100,i=this.currChunk/o;this._emit(Jr,{progress:i}),this.currChunk++}catch(t){throw this._emit(Zr,t),e.close(),t}}decrypt(e,t){return window.crypto.subtle.decrypt({name:"AES-CBC",iv:this.createIvOfIndex(e)},this.secret,t)}createIvOfIndex(e){return new Uint8Array([e,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0])}}class en extends Gr{constructor(e=[]){super(),this.chunkURLs=[],this.countUrls=0,this.completedChunks=0,this.chunkURLs=e,this.countUrls=e.length}start(e){}async pull(e){const t=this.chunkURLs.shift(),r=this.countUrls/100,n=this.completedChunks/r;if(!t)return this._emit(Xr),e.close();this._emit(Jr,{progress:n});const o=await this.request(t);e.enqueue(new Uint8Array(o,0,o.byteLength)),this.completedChunks++}}const tn={dontCloseMessage:"dontCloseMessage",progressShow:"progressShow"},rn={hlsProvider:"hlsProvider",m3u8Provider:"m3u8Provider"};async function nn(e,t){const r=await D.createFromURL(t),n=r.getUrlSegments();let o={};r.isAES128()&&(o.secret=await r.fetchSecretKey(),o.iv=void 0);const i=r.isAES128()?new Qr(n,o):new en(n),a=Kr.createWriteStream(e+".mp4");return Kr.createReadableStream(i).pipeTo(a),{behavior:i,rules:[tn.dontCloseMessage,tn.progressShow]}}async function on(e,t){const r=await D.createFromURL(t),n=document.createElement("a");return n.href=URL.createObjectURL(r.toBlob()),n.download=(e||document.title)+".m3u8",document.body.appendChild(n),n.click(),n.remove(),{behavior:null,rules:[]}}function an(e,t){return e.map(e=>({...e,provider:t}))}var sn=n(3),ln=n(65),un=n.n(ln);const dn=(e,t)=>{dn.timer||(dn.timer=setTimeout(()=>{t(),dn.timer=null},e))};var cn=n(28),fn=n.n(cn),pn=n(32);const hn=sn.c.memo(({disable:e,title:t,badge:r,filename:n,provider:a,endpoint:s,onDownloading:l,onDownloaded:u})=>{const[d,c]=sn.c.useState(!1),[f,p]=sn.c.useState(0),[h,m]=sn.c.useState(""),[v,b]=sn.c.useState(""),[g,_]=sn.c.useState(""),y=Object(pn.a)(un.a),w=sn.c.useCallback(()=>{if(e)return;const t=o[a];if(void 0===t)throw new Error("Download provider "+a+" not found.");t(n,s).then(({behavior:e=null})=>{e&&(c(!0),S(" "+i.a.i18n.getMessage("doNotClosePage"),1e4),l(),e.on(Jr,({detail:e})=>dn(500,()=>p(e.progress))),e.on(Xr,k))})},[]),k=sn.c.useCallback(()=>{u(),p(0),c(!1),S(" "+i.a.i18n.getMessage("completed")+"",3e3)},[]),S=sn.c.useCallback((e,t)=>{m(t),_(!0),b(e)},[]),x=sn.c.useCallback(()=>_(!1),[]);return sn.c.createElement("div",{onClick:w,className:fn()(y.item,e&&y.itemDisable)},sn.c.createElement("div",null,t),r&&sn.c.createElement("div",{className:y.badge},r),sn.c.createElement(mn,{show:g,className:y.tooltip,text:v,onHide:x,liveTime:h}),d&&sn.c.createElement("div",{className:y.downloadBar,style:{display:"block",width:f+"%"}}))}),mn=({liveTime:e,text:t,onHide:r,show:n,className:o})=>{if(sn.c.useMemo(()=>setTimeout(r,e),[t]),n)return sn.c.createElement("div",{className:o},t)},vn=sn.c.memo(({items:e=[],theme:t,children:r})=>{const n=Object(pn.a)(un.a),[o,a]=sn.c.useState(!1),[s,l]=sn.c.useState(!1),u=sn.c.useRef(),d=sn.c.useRef(),c=sn.c.useRef(),f=sn.c.useMemo(()=>{return{twitch:n.themeTwitch,vk:n.themeVk,matchtv:n.themeMatchtv}[t]},[t]),p=sn.c.useCallback(()=>{a(e=>!e)},[]),h=sn.c.useCallback(()=>{l(!0)},[]),m=sn.c.useCallback(()=>{l(!1)},[]);return sn.c.useEffect(()=>{const e=e=>{let t=e.target===u.current||u.current.contains(e.target),r=e.target===d.current;t||r||!c.current.classList.contains(n.show)||p()};return document.addEventListener("click",e),()=>{document.removeEventListener("click",e)}},[]),sn.c.createElement("div",{ref:u,className:f},sn.c.createElement("div",{ref:d,onClick:p},r),sn.c.createElement("div",{ref:c,className:fn()(n.itemContainer,o?n.show:n.hide)},!e.length&&sn.c.createElement("div",{className:n.message},i.a.i18n.getMessage("noLinksFound")),e.map(e=>sn.c.createElement(hn,{disable:s,filename:e.filename,badge:e.badge,endpoint:e.endpoint,title:e.title,provider:e.provider,onDownloading:h,onDownloaded:m}))))}),bn=e=>sn.c.createElement("div",null,e.children);var gn=n(4);var _n=({playlists:e,icon:t,downloadText:r,container:n})=>{const o=sn.c.createElement(vn,{items:e,theme:"vk"},sn.c.createElement(bn,null,sn.c.createElement("div",{className:"like_btn",style:{marginLeft:"14px"}},sn.c.createElement("img",{src:t,style:{opacity:.5},alt:""}),sn.c.createElement("div",{className:"like_button_label"},r))));Object(gn.j)(o,n)},yn=n(38),wn=n(66),kn=n(67);const Sn=n(49),xn=Object(R.a)("vkontakte_ru");A.a.isSingle()&&Object(s.b)("vk",(function(e,t){const r=Object(a.a)(t);var n=t.preferences,o=n.moduleVkontakte?1:0,s=i.a.isChrome||i.a.isFirefox||i.a.isGM&&i.a.isTM,R=Object(l.a)(),A=!1;if(R)if(/\/video_ext\.php\?.+/.test(location.href))A=!0;else{if(!/\/widget_comments\.php\?.+/.test(location.href))return;R=!1}i.a.onMessage.addListener((function(t,r,i){if("getModuleInfo"===t.action){if(t.url!==location.href)return;return i({state:o,moduleName:e})}if("changeState"===t.action){if(e!==t.moduleName)return;return j.changeState(t.state)}"updatePreferences"!==t.action?o&&("updateLinks"===t.action&&D(),"downloadMP3Files"===t.action&&(s?V.downloadMP3Files():V.showListOfAudioFiles(!1)),"downloadPlaylist"===t.action&&V.showListOfAudioFiles(!0),"downloadPhotos"===t.action&&Y.downloadPhoto()):Object.assign(n,t.preferences)})),o&&setTimeout((function(){j.run()}));const T=[],L={};var j={contextMenu:null,isMutation:!1,run:function(){if(o=1,/m\.vk\.com/.test(location.hostname))return J.run();A?$.addFrameBtn():(Y.injectStyle(),P.a.isAvailable()&&(j.isMutation=!0,V.addCustomStyle(),j.mutationMode.enable()))},changeState:function(e){R||(o=e,z(),V.hideLinks(),K.off(),j.hideMenu(),Y.rmCurrentPhotoBtn(),V.rmBitrate(),Y.rmPhotoAlbumDlBtn(),j.mutationMode.stop(),e&&j.run())},hideMenu:function(){j.contextMenu&&(j.contextMenu.hide(),j.contextMenu=null)},mutationMode:{observer:null,stop:function(){this.observer&&this.observer.stop(),["sfSkip"].forEach((function(e){for(var t,r=Object(f.a)(e),n=document.querySelectorAll("["+r+"]"),o=0;t=n[o];o++)t.removeAttribute(r)}))},wrapNewAudioOnMouseOver:function(){o&&V.onNewMouseOver.apply(this,arguments)},wrapNewVoiceOnMouseOver:function(){const e=Object(v.a)(this,".im-mess");if(e&&e.querySelector(".sf-voice-btn")||!o)return;let t=w.a.create("a",{href:this.getAttribute("data-mp3")||"#sf-preload",class:[V.className,"sf-audio-btn","sf-voice-btn"],download:S.a.modify(this.getAttribute("data-mp3"))||"",style:{width:"3px",height:"3px",padding:"0px 9px 9px"},on:[["click",r.downloadOnClick]]});e.querySelector(".im-mess--actions").appendChild(t),e.addEventListener("mouseleave",()=>t.style.display="none"),e.addEventListener("mouseenter",()=>t.style.display="inline"),r.addStyleRules(`.${V.className}.sf-voice-btn`,{"background-size":"12px !important"})},wrapVideoFeedOnMouseOver:function(){o&&K.onLinkHover.apply(this,arguments)},onVideoInsert:function(e){Object(F.a)("function(){return window.mvcur&&window.mvcur.mvData&&window.mvcur.mvData.is_active_live}").then(t=>{var n=r.getParentById(e,"mv_box"),o=$.getPlayerNode(n);o&&!t?$.getLinksFromPlayer(n,o,$.newAppendButton.bind($)):e.dataset.sfSkip=0})},onVideoChange:async function(e){if(!await Object(F.a)("function(){return window.mvcur&&window.mvcur.mvData&&window.mvcur.mvData.is_active_live}")){var t,n=this;if(/video_box_wrap-?\d+_-?\d+/.test(e.id))if(e.sfWatch)n.onVideoInsert(e);else{e.sfWatch=!0;const t=new E.a({attrs:[{name:"id",callback(){n.onVideoInsert(e)}}],target:e});t.trigger(),y.a.onRemoveEvent(e,(function(){t.stop(),e.sfWatch=!1,e.dataset.sfSkip=0}))}else n.onVideoInsert(e);if(document.querySelector('iframe[src*="showjet"]')){let e=document.querySelector('iframe[src*="showjet"]');const n=document.createElement("div"),o=document.querySelector(".like_btns");o.insertBefore(n,o.querySelector(".ui_actions_menu_wrap._ui_menu_wrap"));const a=r.svg.getSrc("download","#4986cc","20px"),s=i.a.i18n.getMessage("download");let l=await(t=e.src,Object(x.a)({action:"showjetFetchMovie",iframeVideoURL:t}));Kr.checkSupport()||(l=l.slice(0,2)),(l=an(l,rn.hlsProvider)).push({...l[l.length-1],provider:rn.m3u8Provider,badge:"m3u8"}),_n({playlists:l,icon:a,downloadText:s,container:n})}}},enable:function(){var e=this;if(this.observer)return this.observer.start();const t=e=>{for(let t,r=0;t=e.added[r];r++)t.dataset.sfSkip>0||(t.dataset.sfSkip="1",y.a.one(t,"mouseenter",j.mutationMode.wrapNewAudioOnMouseOver))};this.observer=new P.a({queries:[{css:".post_video_desc a.lnk",is:"added",callback:e=>{for(let t,r=0;t=e.added[r];r++)t.dataset.sfSkip>0||(t.dataset.sfSkip="1",y.a.one(t,"mouseenter",j.mutationMode.wrapVideoFeedOnMouseOver))}},{css:"#mv_box #mv_player_box > .video_box_wrap",is:"added",callback:t=>{for(let r,n=0;r=t.added[n];n++)r.dataset.sfSkip>0||(r.dataset.sfSkip="1",e.onVideoChange(r))}},{css:"#mv_box #mv_player_box > .video_box_wrap > #video_player",is:"added",callback:t=>{for(let r,n=0;r=t.added[n];n++)(r=r.parentNode).dataset.sfSkip>0||(r.dataset.sfSkip="1",e.onVideoChange(r))}},{css:"#photos_all_block",is:"added",callback:e=>{for(let t,r=0;t=e.added[r];r++)t.dataset.sfSkip>0||(t.dataset.sfSkip="1",Y.addNewPhotoAlbumDlBtn(t))}},{css:".pv_photo_wrap .pv_img_area_wrap",is:"added",callback:e=>{for(let t,r=0;t=e.added[r];r++)t.dataset.sfSkip>0||(t.dataset.sfSkip="1",Y.addNewDlCurrentPhotoBtn(t))}},{css:".audio_row",is:"added",callback:t},{css:".top_audio_player .top_audio_player_title",is:"added",callback:t},{css:".audio_page_player .audio_page_player_title_performer",is:"added",callback:t},{css:".audio-msg-track",is:"added",callback:e=>{for(let t,r=0;t=e.added[r];r++)t.dataset.sfSkip>0||(t.dataset.sfSkip="1",y.a.one(t,"mouseenter",j.mutationMode.wrapNewVoiceOnMouseOver))}},{css:"."+y.a.onRemoveClassName,is:"removed",callback:e=>{for(let t,r=0;t=e.removed[r];r++)y.a.onRemoveListener(t)}}]})}}},D=function(){j.changeState(0),j.changeState(1)},z=function(){V.lastRow=null;for(var e=document.querySelectorAll("a.savefrom_vk_download,div.savefrom_vk_download,span.savefrom_vk_download"),t=e.length-1;t>=0;t--)V.elIsHidden(e[t])&&e[t].parentNode.removeChild(e[t])},U=function(){var e=document.title,t=e.indexOf("|");return-1!==t&&(e=e.substr(0,t-1)),S.a.modify(e)},W=function(e){try{const t=JSON.parse(e).payload[1];return[null,null,null,null,null,t[0],t[1],null,t[3]]}catch(e){}for(var t=function(e){return!0===e?1:parseInt(e)||0},r=function(e){return!0===e?1:parseFloat(e)||0},n=e.split("<!>"),o=n.length-1;o>=0;--o){var i=n[o];if("<!"==i.substr(0,2)){var a=i.indexOf(">"),s=i.substr(2,a-2);switch(i=i.substr(a+1),s){case"json":var l=null;try{l=JSON.parse(i)}catch(e){}n[o]=l;break;case"int":n[o]=t(i);break;case"float":n[o]=r(i);break;case"bool":n[o]=!!t(i);break;case"null":n[o]=null;break;case"pageview_candidate":n.pop();break;case"debug":n.pop()}}}return n},H=function(e){return/<em>.*<\/em>/.test(e)&&(e=e.replace(/<\/?em>/g,"")),e},V={audioElClassList:["audio","audioRow","audioRowWall"],lastRow:null,className:"savefrom_vk_download",cache:{},lastValidRequest:null,waitUntilUnblock:function(e){var t=this,r=10;if(!t.lastValidRequest)return Promise.reject(new Error("Last valid request is empty!"));var n=function(){return new Promise((function(e){setTimeout(e,15e3)})).then((function(){if(e.abort)throw new Error("Abort");return Object(_.a)(t.lastValidRequest).then((function(e){if(r--,!W(e.body)[5]){if(r>0)return n();throw new Error("Can't request data")}}))}))};return n().then((function(){return new Promise((function(e){setTimeout(e,250)}))}))},needUnmask:function(e){var t=/audio_api_unavailable/;return e.some((function(e){if(t.test(e[2]))return!0}))},unmaskUrlViaUtil:function(e){return V.needUnmask(e)?Object(F.a)([],"function(){return vk.id}").then(t=>{const r=e.map(e=>{try{return Array.isArray(e)&&e[2]?(e[2]=O(t,e[2]),e):null}catch(e){return xn.debug("track decode error: ",e),null}});return Promise.all(r).then(e=>e.filter(e=>null!==e))}):Promise.resolve(e)},unmaskUrl:function(e){return V.needUnmask(e)?Object(F.a)([e],'function(idsArr){var aFail=false;var bFail=false;var cFail=false;var unmaskUrl=function unmaskUrl(url){var _url="";if(!aFail&&window.sfUnmaskUrl){try{_url=window.sfUnmaskUrl(url)}catch(err){aFail=true}}if(!cFail&&!_url&&window.AudioPlayerHTML5){try{var res=null;var r={_isHlsUrl:function _isHlsUrl(url){res=url;return true},_initHls:function _initHls(){}};window.AudioPlayerHTML5.prototype._setAudioNodeUrl.apply(r,[null,url]);_url=res}catch(err){cFail=true}}if(!bFail&&!_url&&window.AudioPlayerFlash){try{var r={};window.AudioPlayerFlash.prototype.setUrl.apply(r,[url]);_url=r._url}catch(err){bFail=true}}if(typeof _url!=="string"){_url=""}return _url};idsArr.forEach(function(item){var url=unmaskUrl(item[2]);if(url){item[2]=url}});return idsArr}').then((function(t){return t||e})):Promise.resolve(e)},_getNewTrackListByIdsWithActionHash(e,t={}){let r=0;const n={},o=this.cache,i=e.filter(e=>{const t=e.fullId;return!o[t]||(n[t]=o[t],r++,!1)}),a=[];for(;i.length;)a.push(i.splice(0,9));const s=e.length;let l=Promise.resolve();a.forEach(e=>{l=l.then(()=>{const i=()=>{if(t.abort)throw new Error("Abort");const i=e.filter(e=>e.fullId&&e.actionHash&&e.urlHash).map(e=>e.fullId+"_"+e.actionHash+"_"+e.urlHash),a={type:"POST",headers:{"Content-Type":"application/x-www-form-urlencoded","X-Requested-With":"XMLHttpRequest"},data:Sn.stringify({act:"reload_audio",al:1,ids:i.join(",")}),url:"/al_audio.php",localXHR:!0};return Object(_.a)(a).then(e=>{const i=W(e.body)[5];if(!i||!Array.isArray(i))throw new Error("Track list is not found!");return this.lastValidRequest=a,i.forEach(e=>{const t=e[1]+"_"+e[0];o[t]=e,n[t]=e,r++}),t.onProgress&&t.onProgress(r,s),new Promise(e=>{setTimeout(e,250)})})};let a=2;const l=()=>i().catch(e=>{if("Track list is not found!"===e.message&&!t.withoutUnblock){if(this.lastValidRequest)return this.waitUntilUnblock(t).then(i);if(a-- >0)return new Promise(e=>setTimeout(e,15e3)).then(()=>l())}throw e});return l().catch(e=>{"Abort"!==e.message&&xn.debug("requestIds error!",e)})})}),l=l.then((function(){Object.keys(o).slice(1e3).forEach((function(e){delete o[e]}));const t=[];return e.forEach(e=>{const r=e.fullId,o=n[r];o&&t.push(o)}),t}));return l=l.then(e=>V.unmaskUrlViaUtil(e)).then(e=>{const t=Object(kn.a)(5),r=e.map(e=>t(()=>{const t=e[2],r=(e=>{if(V.isHlsLink(e)){const t=(e=e.replace("/index.m3u8",".mp3")).split("/"),r=-1!==e.indexOf("audios")?1:0;return t.splice(t.length-(2+r),1),t.join("/")}return e})(t);return V.isHlsLink(t)?Object(_.a)({method:"HEAD",url:r}).then(()=>(e[2]=r,e),t=>(xn.warn("getNewTrackListByIdsWithActionHash: mp3 file not available. ",t),e)):e}));return Promise.all(r)})},_getAlbumIdFromUrl:function(e){var t=this,r=[e],n=Object(d.a)(e);n.z&&r.unshift(n.z);var o=null;return r.some((function(e){if(o=t._getAlbumId(e))return!0})),o},_getAlbumId:function(e){if(/[?&]q=/.test(e))return null;var t={url:"/al_audio.php",data:{}},r=/audio_playlist(-?\d+)_(-?\d+)(?:\/(\w+))?/.exec(e);if(r&&(t.data.access_hash=r[3]||"",t.data.act="load_section",t.data.al=1,t.data.claim=0,t.data.owner_id=r[1],t.data.playlist_id=r[2],t.data.type="playlist",t.data.offset=0),!t.data.act){var n=/audios(-?\d+)/.exec(e);if(n){var o=/[?&]section=(\w+)/.exec(e),i=o&&o[1];if(i&&-1===["playlists","all"].indexOf(i))return null;t.data.access_hash="",t.data.act="load_section",t.data.al=1,t.data.claim=0,t.data.owner_id=n[1],t.data.playlist_id=-1,t.data.type="playlist",t.data.offset=0}}return t.data.act?t:null},getNewNodeTrackInfo:async function(e){const t=this.readNewDataAudio(e.dataset.audio),r=this.getNewTrackInfo(t);if(!r||!r.fullId)throw new Error("Track info is not found");return r.url?V.unmaskUrlViaUtil([[null,null,r.url]]).then(e=>(r.url=e[0][2],r)):r},_getAlbumTrackViaApi:function(e,t){if(!e.url)throw xn.debug("Page is not exists!",e),new Error("Page is not exists!");var r=JSON.parse(JSON.stringify(e.data)),n=function(){return t.abort?Promise.reject(new Error("Abort")):Object(_.a)({type:"POST",headers:{"Content-Type":"application/x-www-form-urlencoded","X-Requested-With":"XMLHttpRequest"},url:e.url,data:r,timeout:6e4,localXHR:!0}).then((function(e){const t=W(e.body)[5];if(!t)throw new Error("Album data is empty!");return new Promise((function(e){setTimeout(e,250)})).then((function(){return t}))}))};return n().then((function(e){var t=20,o=function(i){return!i||t<0?e:(t--,r.offset=i,n().then((function(t){return t.list.length?(e.list.push.apply(e.list,t.list),t.hasMore?o(t.nextOffset):e):e}),(function(t){return"Abort"!==t.message&&xn.debug("getOffset error!",t),e})))};return e.hasMore?o(e.nextOffset):e}))},_getAllTrackViaDom:function(e,t){var r=this;t=t||{};var n=[];return[].slice.call(e.querySelectorAll(".audio_row")).forEach((function(e){if((!t.fromPage||!r.elIsHidden(e))&&(t.grabReply||!Y.isReply(e))){var o=null;try{o=JSON.parse(e.dataset.audio)}catch(e){}o&&n.push(o)}})),{list:n}},_getNewAudioLinks:function(e,t){var r=this;t=t||{};var n=(e=e||document)===document,o=Y.getPopup("","audio",(function(){t.abort=!0}));o.onPrepare(i.a.i18n.getMessage("download")+" ...");var a=function(){return Promise.resolve().then((function(){return r._getAllTrackViaDom(e,{fromPage:n,grabReply:!1})}))};t.onProgress=function(e,t){o.onProgress(e,t)};var s=Promise.resolve();return s=(s=(s=(s=n?s.then((function(){return Promise.resolve().then((function(){var e=r._getAlbumIdFromUrl(location.href);if(!e)throw new Error("Album is not found");return r._getAlbumTrackViaApi(e,t)}))})).catch((function(e){throw"Album is not found"!==e.message&&xn.debug("findAlbumLinks error!",e),e})).catch((function(){return a()})):s.then(a)).then((function(e){var t=e.list;if(!t.length)throw new Error("Audio is not found");return o.onProgress(0,t.length),e}))).then((function(e){var n=[],o="";"string"==typeof e.title&&(o=S.a.modify(e.title));const i=[];return e.list.forEach((function(e){const t=e[1]+"_"+e[0],r=V.getTrackActionHash(e),o=V.getTrackUrlHash(e);-1===i.indexOf(t)&&(i.push(t),n.push({fullId:t,actionHash:r,urlHash:o}))})),r._getNewTrackListByIdsWithActionHash(n,t).then((function(e){var t={},n=[];return e.forEach((function(e){var o=r.getNewTrackInfo(e);if(o&&o.url){var i=r.getNewAudioFilename(o),a=r.getNewAudioFullTitle(o);t[o.fullId]=o.url,n.push({url:o.url,title:a,filename:i})}})),{linkList:t,trackList:n,title:o}}))}))).then((function(e){return o.onReady(),e}),(function(e){throw o.onReady(),e}))},tooltip:{tooltip:void 0,updatePos:function(e,t){var n=r.getPosition(e),o=r.getSize(this.tooltip);this.tooltip.style.top=n.top+t.top-o.height+"px";var i=n.left+parseInt(t.width/2)-parseInt(o.width/2),a=document.body.clientWidth+document.body.scrollLeft;a<i+o.width&&(i=a-o.width),this.tooltip.style.left=i+"px"},show:function(e,t){var r=this;return void 0!==this.tooltip?this.hide():(this.tooltip=w.a.create("div",{class:"sf-tooltip",style:Object.assign({position:"absolute",display:"none",zIndex:9999,opacity:0,transition:"opacity 0.2s",whiteSpace:"nowrap"},t.style),on:["mouseenter",function(e){r.hide()}]}),document.body.appendChild(this.tooltip)),this.tooltip.style.display="block",setTimeout((function(){r.updatePos(e,t),r.tooltip.style.opacity=1}),0),this.tooltip},hide:function(){this.tooltip&&(this.tooltip.style.opacity=0,this.tooltip.style.display="none")}},rmBitrate:function(){void 0===V.rmBitrate.style&&document.body.appendChild(V.rmBitrate.style=w.a.create("style",{text:".sf-bitrate-value {display: none;}"}));for(var e,t=document.querySelectorAll(".sf-bitrate-value"),r=0;e=t[r];r++)e.parentNode.removeChild(e)},insertNewBitrate:function(e,t){if(e&&t&&t.classList.contains("audio_row__info")){var r=t.querySelector(".audio_row__duration");if(r&&(void 0!==V.rmBitrate.style&&(V.rmBitrate.style.parentNode.removeChild(V.rmBitrate.style),V.rmBitrate.style=void 0),!r.querySelector(".sf-bitrate-value"))){var n=w.a.create("span",{text:" "+e,class:"sf-bitrate-value",style:{position:"absolute",textAlign:"right",right:0,opacity:"0.8",top:"14px",fontSize:"11px",whiteSpace:"nowrap"}});r.appendChild(n)}}},onDlBtnLeave:function(){V.tooltip.hide()},onDlBtnOver:function(){var e=V,t=e.tooltip,r=this,n=r.dataset.fullId,o=r.parentNode&&r.parentNode.parentNode,a=-6;r.dataset.bitrateOffsetTop&&(a=parseInt(r.dataset.bitrateOffsetTop));var s={top:a,width:24,style:{backgroundColor:"#fff",border:"1px solid #ccc",color:"rgb(48, 48, 48)"}},l=t.show(r,s);l.dataset.fullId=n;var u=function(){var t=r.dataset.bitrate,n=r.dataset.size,a="";e.isHlsLink(r.href)?a=i.a.i18n.getMessage("download"):n?t?(e.insertNewBitrate(t,o),a=n+" ~ "+t):a=n:a=i.a.i18n.getMessage("getFileSizeFailTitle"),l.style.padding="2px 5px 3px",l.textContent=a};r.dataset.size||e.isHlsLink(r.href)?u():(l.style.padding="2px 2px 0 2px",l.textContent="",l.appendChild(w.a.create("img",{src:"/images/upload.gif",height:8,width:32,style:{marginTop:"2px",marginBottom:"1px"}})),r.dataset.preloadOver||(r.dataset.preloadOver=1,e._preloadNewTrackUrl(r).then((function(i){if(r.dataset.preloadOver=2,r.href=i,!e.isHlsLink(i))return e._onOverInsertBitrate(r,o).then((function(){l.dataset.fullId===n&&(u(),t.updatePos(r,s))}));u(),t.updatePos(r,s)})).catch((function(e){xn.error("_preloadNewTrackUrl error",e),r.dataset.preloadOver="",l.dataset.fullId===n&&(u(),t.updatePos(r,s))}))))},preloadIdPromiseMap:{},_preloadNewTrackUrl:function(e){var t=this,r=t.preloadIdPromiseMap,n=e.dataset.fullId,o=e.dataset.actionHash,i=e.dataset.urlHash,a=r[n];return a||(a=r[n]=t._getNewTrackListByIdsWithActionHash([{fullId:n,actionHash:o,urlHash:i}],{withoutUnblock:!0}).then((function(e){delete r[n];var o=null;e.some((function(e){if(e[1]+"_"+e[0]===n)return o=e,!0}));var i=o&&t.getNewTrackInfo(o);if(!i||!i.url)throw new Error("Track is not found");return i.url}),(function(e){throw delete r[n],e})).then(e=>V.unmaskUrl([e])).then(e=>e[0])),a},isHlsLink:function(e){return/\.m3u8\?/.test(e)},onNewDlBtnClick:function(e){V.isHlsLink(this.href)?(e.preventDefault(),Object(yn.a)(Object(gn.f)(wn.a,{sources:[{url:this.href,format:"hls"}],filename:this.download,format:"mp3",convertType:"hlsToMp3"}),document.body)):r.downloadOnClick(e);for(var t,n=document.querySelectorAll("._audio_row_"+this.dataset.fullId),o=0;t=n[o];o++)t.style.backgroundColor="#f4f7fc"},_onNewDlBtnClickWrapper:function(e){var t=V,r=this;e.stopPropagation(),(r.dataset.preloadOver>1||r.dataset.preloadBitrate>1)&&(r.dataset.preloadDl=2),r.dataset.preloadDl?r.dataset.preloadDl>1?V.onNewDlBtnClick.call(r,e):e.preventDefault():(e.preventDefault(),r.dataset.preloadDl=1,t._preloadNewTrackUrl(r).then((function(t){r.dataset.preloadDl=2,r.href=t,V.onNewDlBtnClick.call(r,e)}),(function(e){xn.error("_preloadNewTrackUrl error",e),r.dataset.preloadDl=""})))},getNewDlBtn:function(e,t){var r={href:e.url||"#sf-preload",class:[V.className,"sf-audio-btn"],download:S.a.modify(t)||"",data:{duration:e.duration||"",fullId:e.fullId,actionHash:e.actionHash,urlHash:e.urlHash},style:{width:"16px",height:"16px"},on:[["mouseenter",this.onDlBtnOver],["mouseleave",this.onDlBtnLeave],["click",this._onNewDlBtnClickWrapper],["mousedown",function(e){e.stopPropagation()}]]};return(i.a.isGM||i.a.isSafari)&&(r.title=i.a.i18n.getMessage("downloadTitle")),w.a.create("a",r)},preloadSizePromiseMap:{},_onOverInsertBitrate:function(e,t){var n=this,o=n.preloadSizePromiseMap,a=e.dataset.fullId,s=o[a];return s||(s=o[a]=(e=>{let t=L[e];if(t){const t=T.indexOf(e);-1!==t&&(T.splice(t,1),T.unshift(e))}else if(t=L[e]=Object(x.a)({action:"getFileSize",url:e}).then(t=>(t&&!t.error||delete L[e],t)).catch(t=>{throw delete L[e],t}),T.unshift(e),T.length>100){const e=T.pop();delete L[e]}return t})(e.href).then((function(s){if(delete o[a],!s)throw new Error("Response is empty");if(!s.fileSize)throw delete n.cache[a],new Error("File size is empty");var l=r.sizeHuman(s.fileSize,2),u="";e.dataset.duration&&(u=Math.floor(s.fileSize/e.dataset.duration/125)+" "+i.a.i18n.getMessage("kbps")),e.dataset.bitrate=u,e.dataset.size=l,V.insertNewBitrate(u,t)}),(function(e){throw delete o[a],e}))),s},getNewAudioFullTitle:function(e){var t=[];return e.title&&t.push(e.title),e.performer&&(t.length&&t.unshift(" - "),t.unshift(e.performer)),t.join("")},getNewAudioFilename:function(e){var t=this.getNewAudioFullTitle(e);return t&&(t+=".mp3"),t},handleNewCurrentAudioRow:function(e,t,n){if(!e.querySelector("."+V.className)){var o=this.getNewAudioFilename(t),i=this.getNewDlBtn(t,o),a="#6C8CAC";1===n&&(a="#C4D1DE"),i.classList.remove("sf-audio-btn"),w.a.create(i,{style:{background:"url("+r.svg.getSrc("download",a)+") center no-repeat",backgroundSize:"12px",width:"12px",height:"12px",padding:0,margin:0,cssFloat:"left",marginRight:"3px",marginTop:"1px",marginBottom:"-2px"}});var s=null;if(y.a.onRemoveEvent(i,(function(){y.a.one(e,"mouseenter",j.mutationMode.wrapNewAudioOnMouseOver),s&&s.stop()})),2===n){var l=Object(v.a)(e,".audio_page_player");l&&(s=new E.a({target:l,attrs:[{name:"data-full-id",callback(){i.parentNode&&i.parentNode.removeChild(i),s&&s.stop()}}]})).trigger()}1===n&&(i.dataset.bitrateOffsetTop=1),e.insertBefore(i,e.firstChild)}},handleNewAudioRow:function(e,t,r){if(!e.querySelector("."+V.className)){var o=this,i=this.getNewAudioFilename(r),a=this.getNewDlBtn(r,i),s=t.parentNode;w.a.create(a,{class:["audio_row__action"],style:{width:"24px",height:"24px",cssFloat:"left"}});var l=t.firstChild;l?t.insertBefore(a,l):t.appendChild(a),1===n.vkShowBitrate&&(a.dataset.preloadBitrate||(a.dataset.preloadBitrate=1,o._preloadNewTrackUrl(a).then((function(e){return a.dataset.preloadBitrate=2,a.href=e,o._onOverInsertBitrate(a,s)})).catch((function(e){xn.error("_preloadNewTrackUrl error",e)}))))}},addNewDlTrackBtn:function(e){var t=this,r=function(){a.disconnect()},n=null,i=function(o){n||(n=t.getNewNodeTrackInfo(e)),n.then(r=>(function(r,n){t.handleNewAudioRow(e,r,n)})(o,r)).catch(e=>{xn.error("Fetch track info error: "+e.message),r()})},a=new(Object(C.a)())((function(e){if(o){for(var t=null,n=null,a=0;t=e.shift();)if("childList"===t.type&&t.addedNodes.length&&t.target.classList.contains("audio_row__info"))for(a=0,t.addedNodes;n=t.addedNodes[a];a++)if(n.classList.contains("audio_row__actions"))return void i(n)}else r()}));a.observe(e,{childList:!0,subtree:!0});var s=e.querySelector(".audio_row__actions");s&&(i(s),s=null)},getNewTrackInfo:function(e){if(!e)return null;var t={};return"string"==typeof e[2]&&(t.url=e[2]),t.title=e[3],t.title&&(t.title=S.a.decodeSpecialChars(H(t.title))),t.performer=e[4],t.performer&&(t.performer=S.a.decodeSpecialChars(H(t.performer))),t.duration=parseInt(e[5]),t.actionHash=V.getTrackActionHash(e),t.urlHash=V.getTrackUrlHash(e),e[1]&&e[0]&&(t.fullId=e[1]+"_"+e[0]),t.id=e[0],t.ownerId=e[1],t},getTrackActionHash:e=>{return(e[13]||"").split("/")[2]||""},getTrackUrlHash:e=>{return(e[13]||"").split("/")[5]||""},readNewDataAudio:function(e){try{return JSON.parse(e)}catch(e){return null}},addNewDlCurrentTrackBtn:function(e,t){return Object(F.a)(()=>{let e=null;if("undefined"!=typeof ap&&ap._currentAudio&&(e=ap._currentAudio),!e&&"undefined"!=typeof cur&&cur.audioPage&&cur.audioPage._readyAudio&&(e=cur.audioPage._readyAudio),!e)try{e=JSON.parse(localStorage.audio_v9_track)}catch(e){}return e}).then(r=>{if(!r){let e=document.querySelector(".audio_page_player[data-audio]");r=e&&_this.readNewDataAudio(e.dataset.audio)}let n=r&&this.getNewTrackInfo(r);n&&(n.url?this.handleNewCurrentAudioRow(e,n,t):n.fullId&&this.handleNewCurrentAudioRow(e,n,t))})},onNewMouseOver:function(e){var t=V;if(this&&!this.querySelector("."+V.className)){var r=null;this.classList.contains("top_audio_player_title")&&(r=1),this.classList.contains("audio_page_player_title_performer")&&(r=2),r?t.addNewDlCurrentTrackBtn(this,r):t.addNewDlTrackBtn(this)}},addCustomStyle:function(){if(1!==this.addCustomStyle.hasStyle){this.addCustomStyle.hasStyle=1;var e=document.querySelector("#savefrom-styles.sf-audio");e&&e.parentNode.removeChild(e),r.addStyleRules(".savefrom_vk_download.sf-audio-btn",{background:"url("+r.svg.getSrc("download","#5f7fa2")+") center no-repeat !important",opacity:"0.4"},"sf-audio")}},hideLinks:function(){if(this.addCustomStyle.hasStyle){this.addCustomStyle.hasStyle=0;var e=document.querySelector("#savefrom-styles.sf-audio");e&&e.parentNode.removeChild(e),r.addStyleRules(".savefrom_vk_download",{display:"none"},"sf-audio")}V.tooltip.tooltip&&(V.tooltip.tooltip.parentNode.removeChild(V.tooltip.tooltip),V.tooltip.tooltip=void 0),V.cache={}},elIsHidden:function(e){return null===e.offsetParent},downloadMP3Files:function(){var e=Y.getLayer()||document;V._getNewAudioLinks(e).then((function(e){e.linkList;var t=e.trackList,n=e.title||U(),o=t;if(0===o.length)return alert(i.a.i18n.getMessage("vkMp3LinksNotFound"));r.downloadList.showBeforeDownloadPopup(o,{type:"audio",folderName:n})}),(function(e){"Abort"!==e.message&&(xn.debug("_getNewAudioLinks error!",e),alert(i.a.i18n.getMessage("vkMp3LinksNotFound")))}))},showListOfAudioFiles:function(e){var t=Y.getLayer()||document;V._getNewAudioLinks(t).then((function(t){var n=t.linkList,o=t.trackList,a=t.title||U(),s=null;if(e){if(0!==(s=o).length)return r.playlist.popupPlaylist(s,a,!0)}else{for(var l in s=[],n)s.push({url:n[l]});if(0!==s.length)return r.playlist.popupFilelist(s)}alert(i.a.i18n.getMessage("vkMp3LinksNotFound"))}),(function(e){"Abort"!==e.message&&(xn.debug("_getNewAudioLinks error!",e),alert(i.a.i18n.getMessage("vkMp3LinksNotFound")))}))},requestReloadAudio:function(e,t,r){const n={act:"reload_audio",ids:`${e}_${t}_${r}`};return Object(_.a)({type:"POST",url:"/audio",json:!0,data:n}).then(e=>{const{data:t}=e.body;return V.getNewTrackInfo(t[0][0])})}},$={panelId:"savefrom__vk_video_links",videoAttr:"data-savefrom-video",hiddenAttr:"data-savefrom-hidden",btnBoxId:"sf-iframe-dl-btn",btnBox:null,style:{fontSize:"10pt",margin:"15px 0",padding:"0"},getLinksFormUrl:function(e){if(e){if("//"===e.substr(0,2)&&(e="http:"+e),n.showUmmyItem&&this.isRutubeLink(e))return $.getRutubeLinks(e);if(this.isPladformLink(e))return $.getPladformLinks(e);var t,o=r.embedDownloader.hostings;for(var i in o){for(var a,s=o[i],l=0;a=s.re[l];l++){var u=e.match(a);if(u){t={hosting:i,action:s.action,extVideoId:u[1]};break}}if(t)break}if(t)return{request:t}}},getLinksFromFlashVars:function(e){var t=Object(d.a)(e,{params:!0});return $.getLinksFromHtml5MetaData(t)},getLinksFromHtml5MetaData:function(e){if(!e)return;var t=e.md_title;if(void 0===t)return;let r=Object.keys(e).some(e=>e.match(/cache([0-9]+)/))?/cache([0-9]+)/:/url([0-9]+)/;var n={},o=!1;for(var i in e){var a=null;if("extra_data"!==i||"52"!==e.extra){if(null!==(a=i.match(r))){var s=e[i],l=s.indexOf("?");-1!==l&&(s=s.substr(0,l)),o=!0,n[a[1]]=s}}else n[a=e.hd?"HD":"SD"]=e[i],o=!0}return o?{title:t,links:n}:void 0},getRutubeLinks:function(e){if(/rutube[^\/]+\/(?:play|video)\/embed\/(\d+)/.test(e)||/video\.rutube\./.test(e))return{isUmmy:!0,links:r.popupMenu.prepareLinks.rutube(e)}},isRutubeLink:function(e){return/\/\/.*rutube\..*/.test(e)},getPladformLinks:function(e){if(e){var t=Object(d.a)(e);return{request:{action:"getPladformVideo",extVideoId:{playerId:t.pl,videoId:t.videoid}}}}},isPladformLink:function(e){return/\/\/.*pladform\..*/.test(e)},getLinksVideoEl:function(e,t){var r=t.querySelector(".vv_summary");if(!r)return null;r=r.textContent;for(var n,o,i={},a=e.querySelectorAll("source"),s=0;o=a[s];s++){var l=o.src||"",u=l.indexOf("?");-1!==u&&(l=l.substr(0,u));var d=l.match(/\.(\d+)\.[^\/]+$/);null!==d&&(i[d[1]]=l,n=!0)}return n?{title:r,links:i}:void 0},getPlayerNode:function(e){var t=null;return["iframe.video_yt_player","#html5_player","#flash_video_obj","#playerObj","#player",".video_box_wrap > #video_player"].some((function(r){if(t=e.querySelector(r))return!0})),t},getLinksFromMv:function(e,t,r){return Object(F.a)([t,e],(e,t)=>{const n=window.mvcur;if(n&&n.player&&n.player.vars){var o=n.player.vars;return o.vid!==e||o.oid!==t?r():{vars:n.player.vars}}}).then(e=>e?$.getLinksFromHtml5MetaData(e.vars):null)},getLinksFromFrame:function(e){var t=document.body.innerHTML,r=Object(d.a)(location.href),n=parseInt(r.oid),o=parseInt(r.id);if(n&&o){var i=null;if(Object(p.a)(t,[/"vid":/,/"oid":/,/"md_title":/]).some((function(e){return i=e,!0})),i&&i.vid===o&&i.oid===n)return e(null,{request:{hosting:"vk",action:"getVkLinksFromJsonMsg",json:i}});var a=document.body,s=$.getPlayerNode(a);if(s)return $.getLinksFromPlayer(a,s,(function(t){t&&e(null,t)}))}return e("ERROR")},getLinksFromPlayer:function(e,t,n){if(t){var o,i;if("OBJECT"===t.tagName)(i=t.querySelector('param[name="flashvars"]'))&&(i=i.getAttribute("value"),o=$.getLinksFromFlashVars(i));else if("IFRAME"===t.tagName){var a=t.getAttribute("src");o||(o=$.getLinksFormUrl(a))}else if("EMBED"===t.tagName){var s=t.getAttribute("src");o||(i=t.getAttribute("flashvars"))&&(o=$.getLinksFromFlashVars(i)),o||(o=$.getLinksFormUrl(s))}if(o)return n(o,e);if("DIV"===t.tagName&&"video_player"===t.id){var l=t.parentNode.id,u=l&&l.match(/video_box_wrap(-?\d+)_(-?\d+)/);if(u)return u.shift(),u=u.map((function(e){return parseInt(e)})),Object(F.a)(u,(e,t)=>{let r=window.mvcur;if(!r)return n();var o="video"+e+"_"+t;return r.listId&&(o+="?list="+r.listId),{path:o}}).then(t=>{if(t)return n({request:{hosting:"vk",action:"getVKLinks",extVideoId:t.path,oidVid:u}},e)})}if("html5_player"===t.id)return Object(F.a)(()=>window.html5video&&window.html5video.vars?window.html5video.vars:n()).then(t=>{var r=$.getLinksFromHtml5MetaData(t);if(r)return n(r,e)});if("A"===t.tagName){var c=t.href,f=Object(d.a)(c);if(f.to)return o=r.embedDownloader.checkUrl(f.to),n(o?{request:o}:null,e)}return n(null,e)}},preparePladformLinks:function(e){e&&"getRutubeLinks"===e.action&&(e.links=null);var t=e&&e.links,r="noname",n={};if(t)for(var o,i=0;o=t[i];i++)r=o.title,n[o.quality]&&(o.quality=0),n[o.quality.toUpperCase()]=o.url;return{title:r,links:n}},prepareLinks:function(e){var t=e.title,r=[];for(var n in e.links){var o=e.links[n],i=o.match(/[\w]+\.(mp4|flv)(?:\?|$)/i),a=(i=i?i[1]:"flv").toUpperCase();r.push({href:o,quality:n,title:t,ext:i,format:a,forceDownload:!0})}return r},getVideoLinksAsAjax:function(e){var t=/video(-?\d+_-?\d+)/.exec(e);t=t&&t[1];var r=Object(d.a)(e).list;return Y._getModuleName().then((function(e){return new Promise((function(n){K.getLinkAsAjax([t,r],(function(e,t){n({hosting:t,response:e})}),e)}))}))},async prepareVideoLinks(e){let t=[];if(e&&e.oidVid){const[r,n]=e.oidVid;let o=await $.getLinksFromMv(r,n);o&&t.push(...$.prepareLinks(o))}const o=await Object(x.a)(e);if(o)if("getPladformVideo"===e.action)n.showUmmyItem&&"getRutubeLinks"===o.action?t.push(...r.popupMenu.prepareLinks.rutube(o.links)):t.push(...$.prepareLinks($.preparePladformLinks(o)));else if(o.links){const e=r.embedDownloader.reMapHosting(o.action);e&&t.push(...r.popupMenu.prepareLinks[e](o.links,o.title))}if(!t.length&&"getVKLinks"===e.action){const{hosting:n,response:o}=await $.getVideoLinksAsAjax(e.extVideoId);o&&o.links&&(o.isUmmy?t.push(...o.links):t.push(...r.popupMenu.prepareLinks[n](o.links,o.title)))}if((t.filter(e=>-1!==e.href.indexOf("mycdn.me/")).length||t.length<=2)&&e.extVideoId){let r={},n=document.querySelector('a[href*="'+e.extVideoId+'"]');if(n&&n.dataset.length){let e=n.closest('[id*="post"]');e&&(r.post_id=e.dataset.postId),r.list=n.dataset.list,r.paylist_id="wall_"+n.dataset.video.split("_")[0]}r.video=e.extVideoId.split("?")[0].replace("video","");const o=location.href.match(/pl_(wall_.\d+)/);o&&o[1]&&(r.playlist_id=o[1]);const i=document.querySelector(`a[data-video="${r.video}"]`);i&&i.dataset.list&&(r.list=i.dataset.list);const a=await Object(_.a)({type:"POST",url:"https://vk.com/al_video.php?act=show",data:{act:"show",al:1,autoplay:1,module:"groups",...r}}),{hls:s,mp4:l}=await async function(e){let t=M(e,/:"(https:\\\/\\\/[a-z0-9\-]{3,15}\.vkuservideo\.net.*?\.(\d+)\.mp4.*?)",/gm).filter(e=>e[1]).map(e=>{const[t,r,n]=e;return{href:r,quality:n,format:"MP4"}}),r=M(e,/RESOLUTION=(.*?)\\n(http.*?)\\n/gm).filter(e=>e[1]).map(e=>{const[t,r,n]=e;return{quality:r.split("x").length>1?r.split("x")[1]:r,href:n,format:"HLS",downloadProvider:"ffmpeg_hls_downloader",noSize:!0}}),n=M(e,/hls":"(.*?)",/gm).filter(e=>e[1]).map(e=>e[1]).pop(),o=M(await Object(_.a)(n).then(e=>e.body),/QUALITY=(.*?),RESOLUTION=(.*?)\n(.*?)\n/gm);return r.push(...o.filter(e=>e[1]).map(e=>{const[t,r,n,o]=e;return{quality:r.split("x").length>1?r.split("x")[1]:r,href:o,format:"MP4",downloadProvider:"ffmpeg_hls_downloader",noSize:!0}})),{hls:I(r=r.map(B),"href"),mp4:I(t,"href"),dash:[]}}(a.body);t.push(...l,...s),t=I(t,"href")}return t=t.map(e=>("HLS"===e.format&&(e.format="MP4"),e)),t=(t=await async function(e,t){const r=[];for(let n=0;n<e.length;n++)if(t&&t(e[n]))r.push(e[n]);else if(-1!==e[n].href.indexOf("http")){await N(e[n].href)&&r.push(e[n])}else r.push(e[n]);return r}(I(t,"quality","itag"),e=>!1)).map(e=>(e.title="."===e.title?"video-"+e.quality:e.title,e))},newAppendButton:function(e,t){if(!e)return;var n=t.querySelector("#mv_info"),o=n&&n.querySelector(".mv_actions_block .like_cont .like_btns");n=null;const a=e=>e?e.querySelector("#mv_top_controls, #VideoLayerInfo__topControls"):null;var s=a(t);if(s||(s=a(t.closest("#mv_container"))),o&&V.elIsHidden(o)&&(o=null),o||s){for(var l,u=!(o||!s),d=t.querySelectorAll(".savefrom_vk_download"),c=0;l=d[c];c++)l.parentNode.removeChild(l);l=null,d=null;var f=w.a.create("div",{class:["savefrom_vk_download","sf-under-video"],style:{cursor:"pointer"},on:[["click",async function(n){if(n.stopPropagation(),y.a.onRemoveEvent(this,j.hideMenu),j.contextMenu&&j.contextMenu.isShow)return void j.hideMenu();var o=j.contextMenu=r.popupMenu.quickInsert(this,i.a.i18n.getMessage("download")+"...","sf-single-video-menu",{parent:t});if(e.isUmmy)return void o.update(e.links);let a=await $.prepareVideoLinks(e.request);return a=a.map(e=>("MP4"===e.format&&(e.forceDownload=!0),e)),o.update(a)}],["mousedown",function(e){e.stopPropagation()}],["keydown",function(e){e.stopPropagation()}]]});if(o){w.a.create(f,{class:["like_btn"],append:[w.a.create("div",{class:["like_button_icon"],append:[w.a.create("img",{src:r.svg.getSrc("download","#828a99"),width:16,height:16,style:{margin:"4px"}})]}),w.a.create("div",{class:["like_button_label"],text:i.a.i18n.getMessage("download")})]});var p=o.querySelector(".ui_actions_menu_wrap");p?p.parentNode.insertBefore(f,p):o.appendChild(f)}else if(u){w.a.create(f,{class:["mv_top_button"],style:{textAlign:"center"},append:[w.a.create("img",{class:["mv_small_close_icon"],style:{backgroundImage:"none",width:"20px",height:"20px"},src:r.svg.getSrc("download","#FFFFFF"),width:20,height:20})]});var h=s.firstChild;if(h)if(V.elIsHidden(s.lastChild)){for(;h.nextElementSibling&&!V.elIsHidden(h.nextElementSibling);)h=h.nextElementSibling;h.parentNode.insertBefore(f,h)}else s.appendChild(f);else s.appendChild(f)}}},appendNewFrameBtn:function(e,t){var o=this;if(!t.querySelector(".savefrom_vk_download")){var a=r.frameMenu.getBtn({singleBtn:!0,btnId:o.btnBoxId,containerStyle:{top:"10px",right:"10px"},on:[["click",function(t){if(t.preventDefault(),t.stopPropagation(),j.contextMenu&&j.contextMenu.isShow)j.hideMenu();else{var s=j.contextMenu=r.frameMenu.getMenu(this,i.a.i18n.getMessage("download")+"...","sf-frame-menu",{container:a.container,onShow:function(){a.node.classList.add("sf-over")},onHide:function(){j.contextMenu=null,a.node.classList.remove("sf-over")}});if(e.request){var l=function(t){var a=i.a.i18n.getMessage("noLinksFound");if(t&&"getPladformVideo"===e.request.action)a=n.showUmmyItem&&"getRutubeLinks"===t.action?r.popupMenu.prepareLinks.rutube(t.links):o.prepareLinks(o.preparePladformLinks(t));else if(t&&t.links){var l=r.embedDownloader.reMapHosting(t.action);l&&(a=r.popupMenu.prepareLinks[l](t.links,t.title))}s.update(a)};try{i.a.sendMessage(e.request,l)}catch(t){l()}}else s.update(o.prepareLinks(e));!1}}],["mousedown",function(e){e.stopPropagation(),2===e.button&&(j.hideMenu(),a.container.parentNode&&a.container.parentNode.removeChild(a.container))}]]});a.container=w.a.create("div",{class:"sf-btn-ctr",append:a.node}),a.node.appendChild(w.a.create("style",{text:Object(h.a)([{selector:["body:hover .sf-btn-ctr #"+o.btnBoxId,"body:hover .sf-btn-ctr .sf-frame-menu"],style:{display:"block"}}])})),document.body.appendChild(a.container)}},addFrameBtn:function(){var e=document.getElementById("page_wrap");e&&$.getLinksFromFrame((function(t,r){t||$.appendNewFrameBtn(r,e)}))}},K={linkDataAttr:"savefromHasBtn",getLinkAsAjaxRequest:function(e,t){t=t||0;var r=Object.assign({},e),n=function(){if(t<1)return K.getLinkAsAjaxRequest(e,++t);e.error&&e.error()},o=r.data;0===t?o.act="show_inline":1===t&&(o.act="show"),Object(g.a)(r,(function(t,r,o){return t||!o?n():-1!==o.indexOf('href="/join"')?n():void e.success(o)}))},getVideoDataFromLink:function(e){var t=e.getAttribute("onclick"),r=/showVideo\(['"]{1}([^'"]+)['"]{1},.?['"]{1}([^'"]+)['"]{1},.*\)/.exec(t);return r&&r.shift(),r},getLinkAsAjax:function(e,t,o){K.getLinkAsAjaxRequest({localXHR:1,type:"POST",url:"/al_video.php",data:{list:e[1],video:e[0],act:"show_inline",module:o,al:1},success:function(e){if(!e)return t();var o=e.match(/<iframe[^>]+src=['"]{1}([^'">]+)['"]{1}[^>]+>/i);if(o||(o=e.match(/var\s+opts\s+=\s+({[^}]*})/im))&&(o=o[1].match(/url:\s+['"]{1}([^'"]+)['"]{1}/i))&&0!==o[1].indexOf("//")&&0!==o[1].indexOf("http")&&(o=null),o){var a=o[1];if(n.showUmmyItem&&$.isRutubeLink(a))return t($.getRutubeLinks(a));if(0===a.indexOf("//")&&(a="http:"+a),0!==a.indexOf("http"))return t();var s=r.embedDownloader.checkUrl(a);if(!s)return t();var l={action:s.action,extVideoId:s.extVideoId};i.a.sendMessage(l,(function(e){var n=s.hosting;return e.action!==l.action&&(n=r.embedDownloader.reMapHosting(e.action)),t(e,n)}))}else Object(x.a)({action:"getVkLinksFromData",data:e}).then((function(e){return t(e,"vk")})).catch((function(){return t({},"vk")}))},error:function(){t()}})},addDownloadBtn:function(e){var t=e.href;const n={display:"inline-block",width:"16px",height:"16px",marginLeft:"5px",backgroundImage:"url("+r.svg.getSrc("download","#78A2CC")+")",backgroundRepeat:"no-repeat",marginBottom:"-4px"};var o=w.a.create("a",{href:"http://savefrom.net/?url="+encodeURIComponent(t),style:n,on:["click",function(e){if(i.a.isFirefox){e.preventDefault();const t=this.closest(".lnk"),{video:r,list:n}=t.dataset;Object(F.a)([r,n],(function(e,t){showVideo(e,t,{autoplay:0,queue:1}),setTimeout(()=>{document.querySelector(".savefrom_vk_download.sf-under-video").click(),document.querySelector("#sf-single-video-menu").scrollIntoView()},500)}))}else{if(e.preventDefault(),y.a.onRemoveEvent(a,j.hideMenu),j.contextMenu&&j.contextMenu.isShow)j.hideMenu();else{var t=document.querySelector("#wk_box");t&&t.contains(this)||(t=null);var n={parent:t},s=this.getAttribute(r.embedDownloader.dataAttr),l=r.embedDownloader.checkUrl(s);if(l){var u={action:l.action,extVideoId:l.extVideoId},d=j.contextMenu=r.popupMenu.quickInsert(o,i.a.i18n.getMessage("download")+" ...","sf-popupMenu",n);$.prepareVideoLinks(u).then(e=>{e.map(e=>("MP4"===e.format&&(e.forceDownload=!0),e)),d.update(e)})}else j.contextMenu=r.popupMenu.quickInsert(o,i.a.i18n.getMessage("noLinksFound"),"sf-popupMenu",n)}}}]});o.setAttribute(r.embedDownloader.dataAttr,t);var a=w.a.create("span",{class:"sf-video-feed-container",on:["click",function(e){e.stopPropagation()}],append:[o]}),s=e.querySelector(".post_video_title");s?s.appendChild(a):e.appendChild(a)},onLinkHover:function(){if("A"===this.tagName){var e=this.href||"";0===this.id.indexOf("post_media_lnk")&&-1!==e.indexOf("/video")&&(j.contextMenu&&j.contextMenu.isShow&&j.hideMenu(),this.dataset[K.linkDataAttr]||(this.dataset[K.linkDataAttr]=1,K.addDownloadBtn(this)))}},off:function(){for(var e,t=document.querySelectorAll(".sf-video-feed-container"),r=0;e=t[r];r++)e.parentNode.removeChild(e);var n=Object(f.a)(K.linkDataAttr),o=document.querySelectorAll("*["+n+"]");for(r=0;e=o[r];r++)e.removeAttribute(n)}},Y={photoCache:{},getAlbumId:function(e){if(!/(\?|&|#)act=edit/i.test(e)){var t=[];t.push(e);var r=Object(d.a)(e);r.w&&t.push(r.w),r.z&&t.push.apply(t,r.z.split("/")),/#/.test(e)&&(t.push(e.substr(e.indexOf("#")+1)),t.push(decodeURIComponent(e.substr(e.indexOf("#")+1)))),t.reverse();var n=null,o=null;return t.some((function(e){if(o=e.match(/(?:\/|#|=|^)(albums?|tag|photos|feed(?:\d+)?_|wall)(-?\d+)(?:_(\d+))?/i))return o[3]?n=/^(feed|wall)/.test(o[1])?o[1]+o[2]+"_"+o[3]:"album"+o[2]+"_"+o[3]:("albums"==o[1]&&(o[1]="photos"),n=o[1]+o[2]),!0})),n}},getModuleName:function(e){var t=w.a.create("script",{text:"("+'function(){if(window.cur&&window.cur.module&&typeof window.cur.module==="string"){document.body.dataset["{dataArg}"]=window.cur.module}}'.replace("{dataArg}","sfModule")+")();"});document.body.appendChild(t),setTimeout((function(){t.parentNode.removeChild(t),e(document.body.dataset.sfModule)}),0)},isReply:function(e){return Object(m.a)(e,".replies "+e.tagName)||Object(m.a)(e,".wl_replies "+e.tagName)},getWallPostContent:function(){var e=location.href.match(/wall(-?\d+_\d+)/);if(e=e&&e[1])return document.getElementById("post"+e)||document.getElementById("wpt"+e)},getPopup:function(e,t,n){var o,a=r.playlist.getInfoPopupTemplate();w.a.create(a.textContainer,{append:[w.a.create("p",{text:e,style:{color:"#0D0D0D",fontSize:"20px",marginBottom:"11px",marginTop:"13px"}}),o=w.a.create("p",{text:"",style:{color:"#868686",fontSize:"14px",lineHeight:"24px"}})]});var s=r.popupDiv(a.body,"sf_progress_popup",void 0,void 0,n),l=function(e){l.state!==e&&(l.state=e,a.buttonContainer.style.display="none",o.style.display="none",i.a.sendMessage({action:"getWarningIcon",type:t,color:"#77D1FA"},(function(e){a.icon.style.backgroundImage="url("+e+")"})),"progress"===e&&(o.style.display="block"),"error"===e&&(i.a.sendMessage({action:"getWarningIcon",type:t,color:"#AAAAAA"},(function(e){a.icon.style.backgroundImage="url("+e+")"})),o.style.display="block"))};return{onPrepare:function(e){l("progress"),o.textContent=e},onProgress:function(e,t){o.textContent=i.a.i18n.getMessage("vkFoundFiles").replace("%d",e)+" "+i.a.i18n.getMessage("vkFoundOf")+" "+t},onReady:function(){y.a.trigger(s,"kill")},onError:function(e){l("error"),o.textContent=e}}},getLayer:function(){var e=document.getElementById("layer_wrap");return null!==e&&"none"!==e.style.display&&0!==e.textContent.length||(e=null),null===e&&(null!==(e=document.getElementById("wk_layer_wrap"))&&"none"!==e.style.display&&0!==e.textContent.length||(e=null)),e},_getAlbumLinks:function(e,t){var r=this,n=r.photoCache,o="";/albums|tags|photos/.test(location.href)&&(o=U());var i={},a=[],s=0,l=0,u=0,d=0,f=function(){return function(o){if(t.abort)return Promise.reject(new Error("Abort"));var a={act:"show",al:1,list:e};return o&&(a.offset=o),Object(_.a)({type:"POST",headers:{"Content-Type":"application/x-www-form-urlencoded","X-Requested-With":"XMLHttpRequest"},url:"/al_photos.php",data:a,localXHR:!0,timeout:6e4}).then((function(e){var t=W(e.body),o=t[6],a=t[8];s||(s=a.length),l=o,u||(u=Math.ceil(o/s));var d=[],f="";return a.forEach((function(e){if(!i[e.id]){i[e.id]=1;var t=r.getMaxPhotoSize(e);t&&(!f&&e.album&&(f=S.a.decodeSpecialChars(Object(c.a)(e.album.replace(/<[^>]+>/g,"")))),t.id=e.id,n[e.id]=t,d.push(t))}})),new Promise((function(e){setTimeout(e,250)})).then((function(){return{title:f,list:d}}))}))}(d*s).then((function(e){if(u--,d++,a.push.apply(a,e.list),t.onProgress&&t.onProgress(a.length,l),o||(o=e.title),u>0)return f()}))};return f().then((function(){if(Object.keys(n).slice(1e3).forEach((function(e){delete n[e]})),!a.length)throw new Error("Album is empty");return o||(o=U()),{title:o,list:a}}),(function(e){throw"Abort"!==e.message&&xn.debug("Get photo page error!",e),e}))},_getPhotoLinks:function(e,t,r){var n=this;return n._getModuleName().then((function(o){return function(o){if(r.abort)return Promise.reject(new Error("Abort"));var i={act:"show",al:1,list:t,module:o,photo:e};return Object(_.a)({type:"POST",headers:{"Content-Type":"application/x-www-form-urlencoded","X-Requested-With":"XMLHttpRequest"},url:"/al_photos.php",data:i,localXHR:!0,timeout:6e4}).then((function(t){var r=W(t.body)[8],o=null;if(r.some((function(t){if(t.id===e)return o=n.getMaxPhotoSize(t),!0})),!o)throw new Error("Photo is is not found!");return new Promise((function(e){setTimeout(e,250)})).then((function(){return o}))}))}(o)})).catch((function(e){throw"Abort"!==e.message&&xn.debug("Get photo error!",e),e}))},_getModuleName:function(){return new Promise((function(e,t){var r=w.a.create("script",{text:'(function(dataArg){if(window.cur&&window.cur.module&&typeof window.cur.module==="string"){document.body.dataset[dataArg]=window.cur.module}})('+JSON.stringify("sfModule")+");"});document.body.appendChild(r),setTimeout((function(){r.parentNode.removeChild(r),e(document.body.dataset.sfModule)}),0)}))},_getAlbumLinksViaDom:function(e,t){var r=this,n=r.photoCache;if(t.abort)return Promise.reject(new Error("Abort"));var o=/showPhoto\s*\(\s*["']([-\d_]+)["']\s*,\s*["']([\w\-]+)["']/i,i=/\{["']?temp["']?\s*:\s*(\{.+?\})/i,a=/(\{|,)\s*(\w+)\s*:/gi,s={},l=[],u=function(e){if(!Y.isReply(e)&&!V.elIsHidden(e)){var t=e.getAttribute("onclick"),n=o.exec(t);if(n){var u=n[1];if(!s[u]){s[u]=1;var d=n[2],c=null,f=i.exec(t);if(f){f=f[1].replace(a,'$1"$2":');var p=null;try{p=JSON.parse(f)}catch(e){}c=p&&r.getMaxPhotoSize(p)}c||(c={}),c.id=u,c.listId=d,l.push(c)}}}};if([].slice.call(e.querySelectorAll("a[onclick]")).forEach(u),0===l.length&&e!==document){var d=r.getWallPostContent();d&&[].slice.call(d.querySelectorAll("a[onclick]")).forEach(u)}return function(e){var o=Promise.resolve(),i=[],a=e.filter((function(e){var t=n[e.id];return!t||(i.push(t),!1)}));return t.onProgress&&t.onProgress(i.length,e.length),a.forEach((function(a){o=o.then((function(){return r._getPhotoLinks(a.id,a.listId,t).then((function(r){n[a.id]=r,i.push(r),t.onProgress&&t.onProgress(i.length,e.length)}),(function(r){if("Abort"===r.message)throw r;a.url&&(i.push(a),t.onProgress&&t.onProgress(i.length,e.length),xn.debug("Photo link from dom",r))}))}))})),o=o.then((function(){if(Object.keys(n).slice(1e3).forEach((function(e){delete n[e]})),!i.length)throw new Error("Photos is not found");return{list:i}}))}(l)},_getLinks:function(e,t){var n=this,o=Promise.resolve(),a={},l=n.getPopup(U(),"photo",(function(){a.abort=!0}));a.onProgress=function(e,t){l.onProgress(e,t)},l.onPrepare(i.a.i18n.getMessage("download")+" ...");var u=function(){if((e=e||document)===document){var t=n.getLayer();t&&(e=t)}return n._getAlbumLinksViaDom(e,a)};return o=(o=t?o.then((function(){return n._getAlbumLinks(t,a)})).catch((function(e){throw"Album is empty"!==e.message&&"Abort"!==e.message&&xn.debug("findAlbumLinks error",e),e})).catch((function(){return u()})):o.then(u)).then((function(e){var t=e.title,o=function(e){var t=[];e.forEach((function(e){var r=e.url,o=n.getFilenameFromUrl(r);o||(o="unknown.jpg"),t.push({filename:o,url:r})}));var r=String(t.length).length;return t.forEach((function(e,t){for(var n=String(t+1);n.length<r;)n="0"+n;e.filename=n+"-"+e.filename})),t}(e.list);l.onReady(),t||(t=U()),s?r.downloadList.showBeforeDownloadPopup(o,{count:o.length,folderName:t,type:"photo",onShowList:function(){n.showListOfLinks(t,o,!0)}}):n.showListOfLinks(t,o,!0)}),(function(e){"Abort"!==e.message&&xn.debug("_getLinks error",e),l.onError(i.a.i18n.getMessage("noLinksFound"))}))},rmPhotoAlbumDlBtn:function(){for(var e,t=document.querySelectorAll([".sf-dl-ablum-btn-divide",".sf-dl-ablum-btn"]),r=0;e=t[r];r++)e.parentNode.removeChild(e)},addNewPhotoAlbumDlBtn:function(e){var t=this,r=e.querySelector(".photos_album_intro_info"),n=e.querySelector(".page_block_header_extra"),o=r||n;if(o&&!o.querySelector(".sf-dl-ablum-btn")){var a=w.a.create("a",{text:i.a.i18n.getMessage("vkDownloadPhotoAlbum"),href:"#",class:"sf-dl-ablum-btn",on:["click",function(r){r.preventDefault();var n=Y.getAlbumId(location.href);t._getLinks(e,n)}]}),s=w.a.create("span",{append:a});r?(s.classList.add("photos_album_info"),s=w.a.create(document.createDocumentFragment(),{append:[w.a.create("span",{class:"divide sf-dl-ablum-btn-divide",text:"|"}),s]})):n&&(s.classList.add("photos_comments_link"),s.style.margin="0 15px"),o.appendChild(s)}},getContainer:function(){var e=document.getElementById("photos_albums_container");return e||(e=document.getElementById("photos_container")),e},getFilenameFromUrl:function(e){var t=/\/([\w\-]+\.[a-z0-9]{3,4})(?:\?|$)/i.exec(e);return t=t&&t[1]||""},rmCurrentPhotoBtn:function(e){for(var t,r=void 0,n=document.querySelectorAll(".sf-dl-current-photo-btn"),o=0;t=n[o];o++)e&&e.contains(t)?r=t:t.parentNode.removeChild(t);return r},style:null,injectStyle:function(){this.style?this.style.parentNode||document.head.appendChild(this.style):(this.style=w.a.create("style",{text:Object(h.a)({"div > .sf-dl-current-photo-btn":{display:"none",border:"1px solid #F8F8F8",width:"20px",height:"20px",padding:0,position:"absolute",background:"url("+r.svg.getSrc("download","#777777")+") center no-repeat #F8F8F8",backgroundSize:"12px",top:"20px",left:"30px",zIndex:10,cursor:"pointer"},"div > .sf-dl-current-photo-btn.sf-style-black":{border:0,background:"url("+r.svg.getSrc("download","#FFF")+") center no-repeat #000",backgroundSize:"14px",padding:"2px 4px",borderRadius:"2px",opacity:.4,transition:"opacity 100ms linear"},"div > .sf-dl-current-photo-btn:hover":{background:"url("+r.svg.getSrc("download","#00B75A")+") center no-repeat #F8F8F8",backgroundSize:"12px",opacity:.8},"div > .sf-dl-current-photo-btn.sf-style-black:hover":{background:"url("+r.svg.getSrc("download","#00B75A")+") center no-repeat #000",backgroundSize:"14px"},"div > .sf-dl-current-photo-btn:active":{outline:0,boxShadow:"inset 0 3px 5px rgba(0, 0, 0, 0.125)"},"div:hover > .sf-dl-current-photo-btn":{display:"block"}})}),document.head.appendChild(this.style))},getMaxPhotoSize:function(e){var t=null,r=null;["w","z","y","x"].some((function(n){return!!(t=e[n+"_"])||(!!(r=e[n+"_src"])||void 0)})),t||(t=[r]);var n,o;return t[0]?{url:(n=e.base,o=t[0],o.match(/https?:\/\//i)?((o=new URL(o)).pathname.match(/\.[a-z]{3}$/i)||(o+=".jpg"),o.toString()):(o.match(/\.[a-z]{3}$/i)||(o+=".jpg"),(n||"").replace(/\/[a-z0-9_:\.]*$/i,"")+"/"+o)),width:t[2]&&t[1],height:t[1]&&t[2]}:null},getNewCurrentPhotoLink:function(e,t){return e?Object(F.a)([e],e=>{let t={};return"undefined"!=typeof cur&&cur.pvCurPhoto&&cur.pvCurPhoto.id===e&&(t=cur.pvCurPhoto),t}).then(e=>{if(!e||!e.id)return t("ID is not found");let r=this.getMaxPhotoSize(e);return r?t(null,r):t("URL is not found!")}):t("ID is empty!")},addNewDlCurrentPhotoBtn:function(e){var t=e;if(!this.rmCurrentPhotoBtn(t)){var n=this,o=e.closest(".pv_photo_wrap");if(o){var a=w.a.create("a",{class:["sf-dl-current-photo-btn","sf-style-black"],href:"#",title:i.a.i18n.getMessage("download"),on:[["click",function(e){if(e.stopPropagation(),e.preventDefault(),y.a.onRemoveEvent(this,j.hideMenu),j.contextMenu&&j.contextMenu.isShow)return void j.hideMenu();var a=j.contextMenu=r.popupMenu.quickInsert(this,i.a.i18n.getMessage("download")+" ...","photoDlMenu",{parent:t});const s=o.querySelector(".like_wrap").classList;let l=null;return s.forEach(e=>{const t=e.match(/photo(-?\d+_\d+)/);l=t&&t[1]}),n.getNewCurrentPhotoLink(l,(function(e,t){if(e)return a.update(i.a.i18n.getMessage("noLinksFound"));var r=S.a.modify(n.getFilenameFromUrl(t.url)),o=r.lastIndexOf("."),s=r.substr(o+1),l=r.substr(0,o),u=[];u.push({href:t.url,title:l,quality:i.a.i18n.getMessage("download"),format:" ",ext:s,forceDownload:!0,isOther:!0,isBlank:!0,func:function(){a.hide()}}),u.push({href:"#getAlbum",title:"",quality:i.a.i18n.getMessage("vkDownloadPhotoAlbum"),format:" ",ext:"",noSize:!0,isOther:!0,func:function(e){e.preventDefault(),Y.downloadPhoto(),a.hide()}}),a.update(u)}))}],["mousedown",function(e){e.stopPropagation()}]]});new P.a({queries:[{css:"#pv_photo img",is:"added",callback:()=>{j.contextMenu&&j.contextMenu.isShow&&(j.hideMenu(),a.click())}}]}),t.appendChild(a)}}},downloadPhoto:function(){const e=this.getContainer();let t=this.getAlbumId(location.href);if(!t){const e=document.querySelector(".pv_album_name a");e&&!V.elIsHidden(e)&&(t=this.getAlbumId(e.href))}this._getLinks(e,t)},showListOfPhotosContent:function(e,t){var r;return"<!DOCTYPE html><html>"+w.a.create("html",{append:[w.a.create("head",{append:[w.a.create("meta",{attr:{charset:"utf-8"}}),w.a.create("style",{text:"a,img{display:block;margin-bottom:5px;}p{width: 640px}"})]}),w.a.create("body",{append:[e,w.a.create("p",{text:i.a.i18n.getMessage("vkListOfPhotosInstruction")}),w.a.create("br"),w.a.create("br"),(r=document.createDocumentFragment(),t.forEach((function(e){var t=e.url,n=e.filename||"",o=w.a.create("img",{src:t,alt:"photo"});n&&(o=w.a.create("a",{href:t,download:n,append:o})),r.appendChild(o)})),r)]})]}).innerHTML+"</html>"},showListOfLinks:function(e,t,n){var o;o=n?w.a.create(document.createDocumentFragment(),{append:[w.a.create("p",{append:[w.a.create("a",{text:i.a.i18n.getMessage("vkListOfPhotos"),href:"#",class:"sf__hidden",style:{fontWeight:"bolder",border:"none",textDecoration:"underline"},on:["click",function(r){r.preventDefault();var n=Y.showListOfPhotosContent(e,t),o="";i.a.isChrome||i.a.isTM?(o=Object(b.a)(n,"text/html",!0),i.a.sendMessage({action:"openTab",url:o})):(o=Object(b.a)(n,"text/html"),window.open(o,"_blank"))}]})]})]}):"";for(var a,s,l="",u=0;a=t[u];u++)l+=a.url+"\r\n";var d=w.a.create(document.createDocumentFragment(),{append:[w.a.create("p",{text:e,style:{color:"#0D0D0D",fontSize:"20px",marginBottom:"11px",marginTop:"5px"}}),w.a.create("p",{append:Object(k.a)(i.a.i18n.getMessage("vkListOfLinksInstruction"))}),o,s=w.a.create("textarea",{text:l,cols:60,rows:10,style:{width:"100%"}}),i.a.isChrome||i.a.isFirefox?w.a.create("button",{text:i.a.i18n.getMessage("copy"),style:{height:"27px",backgroundColor:"#ffffff",border:"1px solid #9e9e9e",marginTop:"6px",paddingLeft:"10px",paddingRight:"10px",borderRadius:"5px",fontSize:"14px",cursor:"pointer",cssFloat:"right"},on:["click",function(e){var t=this;t.disabled=!0,i.a.isFirefox?(s.select(),document.execCommand("copy")):i.a.sendMessage({action:"addToClipboard",text:l}),setTimeout((function(){t.disabled=!1}),1e3)}],append:w.a.create("style",{text:Object(h.a)({"#savefrom_popup_box button:hover:not(:disabled)":{backgroundColor:"#597A9E !important",borderColor:"#597A9E !important",color:"#fff"},"#savefrom_popup_box button:active":{opacity:.9}})})}):void 0]});r.popupDiv(d)}},J={mobileMenu:null,observer:null,styleEl:null,run:function(){var e=this;if(!P.a.isAvailable())return;if(e.observer)return e.observer.start();e.observer=new P.a({queries:[{css:"div.audio_item",is:"added",callback:t=>{for(let r,n=0;r=t.added[n];n++)r.dataset.sfSkip>0||(r.dataset.sfSkip="1",e.insertAudioBtn(r))}},{css:"div.VideoPage",is:"added",callback:t=>{for(let r,n=0;r=t.added[n];n++)r.dataset.sfSkip>0||(r.dataset.sfSkip="1",e.insertVideoBtn(r))}},{css:"."+y.a.onRemoveClassName,is:"removed",callback:e=>{for(let t,r=0;t=e.removed[r];r++)y.a.onRemoveListener(t)}}]}),e.insertStyle()},hideMenu:function(){J.mobileMenu&&(J.mobileMenu.hide(),J.mobileMenu=null)},insertStyle:function(){this.styleEl?this.styleEl.parentNode||document.head.appendChild(this.styleEl):(this.styleEl=w.a.create("style",{class:"sf-style",text:Object(h.a)([{selector:".savefrom_vk_download.sf-audio",style:{display:"block",float:"right",borderRadius:"3px",width:"22px",height:"22px",marginTop:"1px",marginLeft:"3px",marginRight:"3px",background:"url("+r.svg.getSrc("download","#ffffff")+") center no-repeat",backgroundSize:"12px",backgroundColor:"#5E80AA"}},{selector:".audio_item .savefrom_vk_download.sf-audio",style:{position:"absolute",right:"32px",top:0,bottom:0,margin:"auto"}},{selector:".audio_item.ai_current .savefrom_vk_download.sf-audio",style:{bottom:"auto",top:"6px"}}])}),document.head.appendChild(this.styleEl))},getAudioUrlFromNode:async function(e){const t=await V.getNewNodeTrackInfo(e);if(!t.fullId||!t.actionHash||!t.urlHash)throw new Error("Track info not valid for fetch audio link");const r=V.requestReloadAudio(t.fullId,t.actionHash,t.urlHash),n=Object(F.a)([],"function(){return vk.id}");return Promise.all([r,n]).then(([e,t])=>{let r=O(t,e.url);return q(r)?function(e){if(q(e)){const t=(e=e.replace("/index.m3u8",".mp3")).split("/"),r=-1!==e.indexOf("audios")?1:0;return t.splice(t.length-(2+r),1),t.join("/")}return null}(r):r})},onAudioBtnClick:function(e){if(e.preventDefault(),e.stopPropagation(),e.target.href)return r.downloadOnClick(e);const t=e.target.closest(".audio_item");t&&this.getAudioUrlFromNode(t).then(t=>{e.target.href=t,r.downloadOnClick(e)}).catch(e=>{xn.error("getAudioUrlFromNode error: "+e.message)})},getAudioDlBtnNode:function(e){return w.a.create("a",{class:["savefrom_vk_download","sf-audio"],download:S.a.modify(e),target:"_blank",on:["click",this.onAudioBtnClick.bind(this)],title:i.a.i18n.getMessage("download")})},insertAudioBtn:function(e){let t=null;const r=e.querySelector(".ai_label");if(r){const e=r.textContent.trim(),n=r.querySelector(".ai_title"),o=r.querySelector(".ai_artist"),i=n&&n.textContent.trim(),a=o&&o.textContent.trim();t=i&&a?`${a.trim()}  ${i.trim()}`:e}t=`${t||"unknown"}.mp3`;const n=e.querySelector(".ai_dur");if(!n)return;const o=n.parentNode,i=this.getAudioDlBtnNode(t),a=o.querySelector(".savefrom_vk_download");if(a)a.parentNode.replaceChild(i,a);else{const e=n.nextElementSibling;if(!e)return;o.insertBefore(i,e)}},onVideoBtnClick:function(e,t){t.preventDefault(),t.stopPropagation(),J.hideMenu();var n=J.mobileMenu=r.mobileLightBox.show(i.a.i18n.getMessage("download")+" ..."),o=i.a.i18n.getMessage("noLinksFound");if(e.request){var a=function(t){if(t&&"getPladformVideo"===e.request.action)o=$.prepareLinks($.preparePladformLinks(t));else{var i=r.embedDownloader.reMapHosting(t.action);i&&t&&t.links&&(o=r.popupMenu.prepareLinks[i](t.links,t.title))}if(!o.length){const e=Array.from(document.body.querySelectorAll('.vv_inline_video source[type="video/mp4"]'));o=e.map(e=>{let t=document.querySelector(".VideoPageInfoRow__title"),r=e.src.match(/.(\d+)\.mp4/);return{title:t?t.textContent:"video",href:e.src,forceDownload:!0,ext:"mp4",format:"MP4",quality:r?r[1]:""}})}n.update(o)};try{i.a.sendMessage(e.request,a)}catch(t){a()}}else o=$.prepareLinks(e),n.update(o)},appendVideoBtn:function(e,t){var n=t.querySelector(".VideoPageInfoRow__title");const o=r.svg.getSvg("download","#4986cc","20px");o.style.marginLeft="17px",o.style.marginTop="6px",o.style.float="right",o.style.cursor="pointer",o.addEventListener("click",this.onVideoBtnClick.bind(this,e)),n&&n.appendChild(o),y.a.onRemoveEvent(o,J.hideMenu)},insertVideoBtn:function(e){var t=this,r=e.querySelectorAll("iframe, video, a")[0],n=Object(u.a)(e,"VideoPage"),o=function(){var e=/video(-?\d+)_(-?\d+)/.exec(location.href);return e&&{request:{hosting:"vk",action:"getVKLinks",extVideoId:"video"+e[1]+"_"+e[2]}}};r?$.getLinksFromPlayer(n,r,(function(e,r){e||(e=o()),e&&t.appendVideoBtn(e,r)})):e.querySelector(".vv_not_support")&&o()&&t.appendVideoBtn(o(),n)}}}))},65:function(e,t,r){var n=r(47),o=r(135);"string"==typeof(o=o.__esModule?o.default:o)&&(o=[[e.i,o,""]]);var i,a=0,s={injectType:"lazyStyleTag",insert:"head",singleton:!1},l={};o.locals&&(l.locals=o.locals),l.use=function(){return a++||(i=n(o,s)),l},l.unuse=function(){a>0&&!--a&&(i(),i=null)},e.exports=l}});